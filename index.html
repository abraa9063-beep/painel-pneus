O c√≥digo completo do arquivo `pneus.txt` est√° aqui, conforme solicitado. Ele cont√©m a estrutura HTML, estilos CSS e todo o c√≥digo JavaScript para o sistema de gest√£o de pneus (Dashboard, Estoque, Fogos, Performance e Movimenta√ß√£o de Pneus):

```html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Transportes Canarinho - Sistema de Pneus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --accent: #38bdf8;
      --accent-dark: #0ea5e9;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --danger: #f43f5e;
      --warn: #f97316;
      --success: #10b981;
      --purple: #8b5cf6;
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    * {
      box-sizing: border-box;
      font-family: "Segoe UI", system-ui, sans-serif;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 70px;
      overflow-x: hidden;
    }
    
    header {
      padding: 16px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.12);
      background: rgba(2, 6, 23, 0.95);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    header h1 {
      margin: 0;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    /* Navega√ß√£o por tabs */
    .tabs-container {
      position: sticky;
      top: 60px;
      background: var(--bg);
      z-index: 90;
      padding: 10px 0;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }
    
    .tabs-scroll {
      display: flex;
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding: 0 15px;
      gap: 8px;
    }
    
    .tabs-scroll::-webkit-scrollbar {
      display: none;
    }
    
    .tab-btn {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.2);
      color: var(--text);
      padding: 12px 20px;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      flex-shrink: 0;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .tab-btn.active {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color: white;
      border-color: var(--accent);
      box-shadow: var(--shadow);
    }
    
    .hidden {
      display: none !important;
    }
    
    /* Layout principal de relat√≥rios */
    .reports-container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .report-title {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .controls-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .date-range {
      display: flex;
      gap: 10px;
      align-items: center;
      background: rgba(15, 23, 42, 0.6);
      padding: 12px 16px;
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    
    .input, select, button {
      padding: 12px 16px;
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(15, 23, 42, 0.8);
      color: var(--text);
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }
    
    .input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
    }
    
    button {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow);
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, var(--warn), #ea580c);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #dc2626);
    }
    
    .btn-purple {
      background: linear-gradient(135deg, var(--purple), #7c3aed);
    }
    
    .btn-xs {
      padding: 8px 12px;
      font-size: 0.8rem;
      background: rgba(15, 23, 42, 0.4);
      color: var(--text);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 6px;
      cursor: pointer;
    }
    
    /* Cards de m√©tricas */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .metric-card {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.6));
      padding: 25px;
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.1);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--purple));
    }
    
    .metric-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }
    
    .metric-value {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--text), var(--muted));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .metric-label {
      color: var(--muted);
      font-size: 0.9rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .metric-change {
      font-size: 0.8rem;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .positive {
      color: var(--success);
    }
    
    .negative {
      color: var(--danger);
    }
    
    /* Grid de gr√°ficos */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .chart-card {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: var(--radius);
      padding: 25px;
      backdrop-filter: blur(10px);
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .chart-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text);
    }
    
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }
    
    /* Tabelas de relat√≥rios */
    .table-card {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: var(--radius);
      overflow: hidden;
      backdrop-filter: blur(10px);
      margin-bottom: 25px;
    }
    
    .table-header {
      padding: 20px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .table-title {
      font-size: 1.3rem;
      font-weight: 600;
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .data-table th {
      background: rgba(30, 41, 59, 0.8);
      padding: 15px 12px;
      text-align: left;
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }
    
    .data-table td {
      padding: 15px 12px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.05);
      font-size: 0.9rem;
    }
    
    .data-table tr:hover {
      background: rgba(56, 189, 248, 0.05);
    }
    
    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .status-novo { background: rgba(16, 185, 129, 0.2); color: #10b981; }
    .status-usado { background: rgba(249, 115, 22, 0.2); color: #f97316; }
    .status-reformado { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
    .status-alta { background: rgba(244, 63, 94, 0.2); color: #f43f5e; }
    .status-media { background: rgba(249, 115, 22, 0.2); color: #f97316; }
    .status-baixa { background: rgba(16, 185, 129, 0.2); color: #10b981; }
    
    /* Cards de exporta√ß√£o */
    .export-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .export-card {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.6));
      padding: 25px;
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.1);
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .export-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      border-color: var(--accent);
    }
    
    .export-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }
    
    .export-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 10px;
    }
    
    .export-desc {
      color: var(--muted);
      font-size: 0.9rem;
      line-height: 1.5;
    }
    
    /* Barra de navega√ß√£o inferior */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(2, 6, 23, 0.95);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(148, 163, 184, 0.1);
      display: flex;
      padding: 10px 15px;
      z-index: 99;
    }
    
    .nav-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      background: none;
      border: none;
      color: var(--muted);
      padding: 8px 0;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .nav-btn.active {
      color: var(--accent);
    }
    
    .nav-icon {
      font-size: 1.2rem;
    }
    
    /* Loading e estados vazios */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
      color: var(--muted);
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }
    
    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    /* Notifica√ß√µes */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      border-radius: var(--radius);
      color: white;
      z-index: 1001;
      animation: slideIn 0.3s ease;
      text-align: center;
      min-width: 300px;
    }
    .notification.success { background: var(--success); }
    .notification.error { background: var(--danger); }
    .notification.warning { background: var(--warn); }
    @keyframes slideIn {
      from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }

    /* Modais */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(2, 6, 23, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 15px;
    }
    .modal {
      background: var(--bg);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: var(--radius);
      padding: 20px;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal h2 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.3rem;
    }
    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 15px;
    }
    .field-row {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 10px;
    }
    .field-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    label {
      color: var(--muted);
      font-size: 0.9rem;
    }

    /* Estilos para controles de quantidade */
    .quantity-control {
      display: flex;
      gap: 3px;
      align-items: center;
    }

    .quantity-input {
      width: 50px;
      padding: 4px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 4px;
      color: var(--text);
      font-size: 0.8rem;
      text-align: center;
    }

    .quantity-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.1);
    }

    .action-buttons {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      align-items: center;
    }
    
    /* NOVOS ESTILOS PARA TABS DE CONTAINER - MODIFICADOS */
    .container-tabs {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      justify-content: center;
    }

    .container-tab {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.6));
      padding: 25px;
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.1);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      text-align: center;
      min-width: 200px;
      flex: 1;
      max-width: 300px;
    }

    .container-tab::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent), var(--purple));
    }

    .container-tab:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    .container-tab.active {
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(139, 92, 246, 0.2));
      border-color: var(--accent);
      box-shadow: 0 8px 25px rgba(56, 189, 248, 0.3);
    }

    .container-tab-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--text), var(--muted));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .container-tab-subtitle {
      color: var(--muted);
      font-size: 0.9rem;
      font-weight: 500;
    }

    .container-content {
      display: none;
    }

    .container-content.active {
      display: block;
    }

    .container-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(15, 23, 42, 0.4);
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.1);
    }

    .container-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--accent);
    }

    .container-stats {
      display: flex;
      gap: 20px;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--text);
      display: block;
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--muted);
    }

    /* Ajustes para tabelas por container */
    .container-table {
      margin-top: 15px;
    }

    /* Remover filtros antigos */
    .old-filters {
      display: none;
    }

    /* Responsividade */
    @media (max-width: 768px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
      
      .metrics-grid {
        grid-template-columns: 1fr;
      }
      
      .report-header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .controls-row {
        justify-content: center;
      }
      
      .date-range {
        flex-direction: column;
      }

      .quantity-control {
        flex-direction: column;
      }
      
      .quantity-input {
        width: 100%;
      }

      .action-buttons {
        flex-direction: column;
        align-items: stretch;
      }

      .container-tabs {
        flex-direction: column;
        gap: 15px;
      }
      
      .container-tab {
        min-width: auto;
        max-width: none;
      }
      
      .container-stats {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .stat-item {
        flex: 1;
        min-width: 80px;
      }
    }

    /* Estilos espec√≠ficos para fogos */
    .fogo-item {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: var(--radius);
      padding: 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .fogo-info {
      flex: 1;
    }
    
    .fogo-number {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--accent);
    }
    
    .fogo-details {
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    .fogo-actions {
      display: flex;
      gap: 8px;
    }

    /* ============================================= */
    /* NOVOS ESTILOS PARA MOVIMENTA√á√ÉO DE PNEUS */
    /* ============================================= */
    
    .movement-container {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
      height: calc(100vh - 200px);
      min-height: 600px;
    }
    
    .vehicles-panel {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: var(--radius);
      padding: 20px;
      overflow-y: auto;
    }
    
    .vehicle-item {
      background: rgba(30, 41, 59, 0.8);
      padding: 15px;
      border-radius: var(--radius);
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    
    .vehicle-item:hover {
      background: rgba(56, 189, 248, 0.1);
    }
    
    .vehicle-item.active {
      border-color: var(--accent);
      background: rgba(56, 189, 248, 0.15);
    }
    
    .vehicle-plate {
      font-weight: bold;
      font-size: 1.1rem;
      color: var(--accent);
    }
    
    .vehicle-model {
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    .visualization-panel {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: var(--radius);
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    
    .vehicle-display {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    
    .truck-diagram {
      width: 100%;
      max-width: 600px;
      height: 300px;
      position: relative;
      background: rgba(30, 41, 59, 0.3);
      border-radius: var(--radius);
      border: 2px solid rgba(148, 163, 184, 0.2);
    }
    
    /* Desenho do caminh√£o */
    .truck-cabin {
      position: absolute;
      left: 10%;
      top: 30%;
      width: 25%;
      height: 40%;
      background: #4a5568;
      border-radius: 10px 0 0 10px;
    }
    
    .truck-chassis {
      position: absolute;
      left: 35%;
      top: 40%;
      width: 60%;
      height: 20%;
      background: #2d3748;
      border-radius: 5px;
    }
    
    /* Posi√ß√µes dos eixos */
    .axle {
      position: absolute;
      width: 80px;
      height: 30px;
      background: rgba(74, 85, 104, 0.7);
      border-radius: 5px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .axle:hover {
      background: rgba(56, 189, 248, 0.3);
    }
    
    .axle-front {
      left: 40%;
      top: 35%;
    }
    
    .axle-rear-left {
      left: 60%;
      top: 35%;
    }
    
    .axle-rear-right {
      left: 75%;
      top: 35%;
    }
    
    .tire-slot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #4b5563;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
      cursor: grab;
      border: 2px solid transparent;
      transition: all 0.2s;
    }
    
    .tire-slot.filled {
      background: var(--success);
      cursor: pointer;
    }

    .tire-slot.filled:hover {
        background: var(--danger);
        transform: scale(1.1);
    }
    
    .position-indicator {
      z-index: 10;
    }

    .tire-item {
        background: rgba(56, 189, 248, 0.2);
        border: 1px solid var(--accent);
        padding: 10px;
        border-radius: var(--radius);
        margin-bottom: 8px;
        cursor: grab;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.2s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .tire-item:hover {
        background: rgba(56, 189, 248, 0.3);
        transform: translateY(-1px);
    }

    .tire-number {
        font-weight: bold;
        color: var(--text);
    }

    .tire-details {
        font-size: 0.8rem;
        color: var(--muted);
        text-align: right;
    }

    .tire-item.em-uso {
        opacity: 0.6;
        cursor: not-allowed;
        background: rgba(74, 85, 104, 0.5);
        border-color: var(--muted);
    }
    
    /* Painel de pneus dispon√≠veis */
    .available-tires-panel {
        background: rgba(15, 23, 42, 0.6);
        border: 1px solid rgba(148, 163, 184, 0.1);
        border-radius: var(--radius);
        padding: 20px;
        overflow-y: auto;
        margin-top: 20px;
    }

    .montagem-info {
        background: rgba(139, 92, 246, 0.1);
        border: 1px solid var(--purple);
        padding: 15px;
        border-radius: var(--radius);
        margin-bottom: 20px;
    }

    .montagem-status {
        display: flex;
        gap: 20px;
        justify-content: space-around;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid rgba(148, 163, 184, 0.1);
    }

    .status-item {
        text-align: center;
    }

    .status-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--accent);
    }

    .status-label {
        font-size: 0.8rem;
        color: var(--muted);
    }

    @media (max-width: 768px) {
        .movement-container {
            grid-template-columns: 1fr;
            height: auto;
            min-height: auto;
        }

        .vehicles-panel {
            height: 200px;
        }
        
        .visualization-panel {
            min-height: 400px;
        }
    }

    /* Estilos para PDF */
    .pdf-container {
        font-family: Arial, sans-serif;
        padding: 20px;
        color: #333;
    }
    .pdf-header {
        text-align: center;
        margin-bottom: 20px;
    }
    .pdf-header h1 {
        color: #0f172a;
        font-size: 24px;
        margin: 0;
    }
    .pdf-header p {
        color: #666;
        font-size: 14px;
    }
    .section {
        margin-bottom: 30px;
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 8px;
    }
    .section h2 {
        color: #38bdf8;
        border-bottom: 2px solid #38bdf8;
        padding-bottom: 5px;
        margin-top: 0;
        margin-bottom: 15px;
    }
    .metrics-pdf {
        display: flex;
        justify-content: space-around;
        text-align: center;
        margin-bottom: 20px;
    }
    .metrica {
        padding: 10px;
        border-radius: 6px;
        background: #f4f4f4;
        width: 30%;
    }
    .metrica h3 {
        font-size: 14px;
        color: #666;
        margin: 0 0 5px 0;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
        color: #0f172a;
    }
    .status-badge-pdf {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: bold;
        text-transform: uppercase;
        display: inline-block;
    }
    .status-novo-pdf { background: #d1fae5; color: #059669; }
    .status-usado-pdf { background: #fef3c7; color: #d97706; }
    .status-reformado-pdf { background: #ede9fe; color: #7c3aed; }
    .alert-item {
        margin-bottom: 10px;
        padding: 8px;
        background: #fee2e2;
        border: 1px solid #f87171;
        color: #b91c1c;
        border-radius: 4px;
        font-size: 12px;
    }
  </style>
</head>
<body>

  <div id="notification-area"></div>

  <header>
    <h1><span style="color: var(--accent);">üöõ</span> Transportes Canarinho - Gest√£o de Pneus</h1>
  </header>

  <div class="tabs-container">
    <div class="tabs-scroll">
      <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
      <button class="tab-btn" data-tab="estoque">Estoque</button>
      <button class="tab-btn" data-tab="movimento-pneus">Movimento</button>
      <button class="tab-btn" data-tab="fogos">Fogos</button>
      <button class="tab-btn" data-tab="performance">Performance</button>
      <button class="tab-btn" data-tab="alertas">Alertas</button>
      <button class="tab-btn" data-tab="exportar">Exportar</button>
      <button class="tab-btn btn-danger" onclick="resetData()">Resetar Dados</button>
    </div>
  </div>

  <main>
    
    <div id="tab-dashboard" class="tab-content">
      <div class="reports-container">
        <div class="report-header">
          <h2 class="report-title">Dashboard de Pneus</h2>
          <div class="controls-row">
            <div class="date-range">
              <label for="startDate">De:</label>
              <input type="date" id="startDate" class="input">
              <label for="endDate">At√©:</label>
              <input type="date" id="endDate" class="input">
            </div>
            <button onclick="renderDashboard()">Atualizar</button>
          </div>
        </div>

        <div class="metrics-grid" id="dashboardMetrics">
          </div>

        <div class="charts-grid">
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">Estoque por Status</h3>
              <span class="status-indicator" style="color: var(--muted); font-size: 0.9rem;">Itens</span>
            </div>
            <div class="chart-container">
              <canvas id="statusChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">Valor em Estoque por Marca</h3>
              <span class="status-indicator" style="color: var(--muted); font-size: 0.9rem;">R$</span>
            </div>
            <div class="chart-container">
              <canvas id="brandValueChart"></canvas>
            </div>
          </div>
        </div>

        <div class="table-card">
          <div class="table-header">
            <h3 class="table-title">Movimenta√ß√µes Recentes (√öltimos 7 dias)</h3>
          </div>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Fogo</th>
                  <th>Ve√≠culo</th>
                  <th>Posi√ß√£o</th>
                  <th>Data</th>
                  <th>Tipo</th>
                </tr>
              </thead>
              <tbody id="movimentacoesRecentesBody">
                </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div id="tab-estoque" class="tab-content hidden">
      <div class="reports-container">
        <div class="report-header">
          <h2 class="report-title">Relat√≥rio de Estoque por Container</h2>
          <div class="controls-row">
            <button onclick="openAddPneuModal()" class="btn-success">
                Adicionar Pneu ao Estoque
            </button>
            <button onclick="exportStockToExcel()" class="btn-success">
                Exportar Excel
            </button>
          </div>
        </div>
        
        <div class="container-tabs">
            <div class="container-tab active" data-container="container1">
                <div class="container-tab-title">Container 1</div>
                <div class="container-tab-subtitle">Pneus novos sem fogo</div>
            </div>
            <div class="container-tab" data-container="container2">
                <div class="container-tab-title">Container 2</div>
                <div class="container-tab-subtitle">Pneus usados</div>
            </div>
            <div class="container-tab" data-container="container3">
                <div class="container-tab-title">Container 3</div>
                <div class="container-tab-subtitle">Pneus reformados</div>
            </div>
        </div>

        <div id="container1-content" class="container-content active">
            <div class="container-header">
                <div>
                    <h3 class="container-title">Container 1</h3>
                    <p style="color: var(--muted); margin-top: 5px;">Pneus novos sem fogo</p>
                </div>
                <div class="container-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="container1-total">0</span>
                        <span class="stat-label">Total Itens</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="container1-valor">R$ 0</span>
                        <span class="stat-label">Valor Total</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="container1-novos">0</span>
                        <span class="stat-label">Novos</span>
                    </div>
                </div>
            </div>
            
            <div class="table-card container-table">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Medida</th>
                                <th>Marca/Modelo</th>
                                <th>Status</th>
                                <th>QTD</th>
                                <th>Valor Unit (R$)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="container1-table-body">
                            </tbody>
                    </table>
                </div>
            </div>
            
            <div class="empty-state hidden" id="container1-empty">
                <div class="empty-state-icon">üì¶</div>
                <p>Nenhum item encontrado no Container 1.</p>
            </div>
        </div>

        <div id="container2-content" class="container-content">
            <div class="container-header">
                <div>
                    <h3 class="container-title">Container 2</h3>
                    <p style="color: var(--muted); margin-top: 5px;">Pneus usados</p>
                </div>
                <div class="container-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="container2-total">0</span>
                        <span class="stat-label">Total Itens</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="container2-valor">R$ 0</span>
                        <span class="stat-label">Valor Total</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="container2-usados">0</span>
                        <span class="stat-label">Usados</span>
                    </div>
                </div>
            </div>
            
            <div class="table-card container-table">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Medida</th>
                                <th>Marca/Modelo</th>
                                <th>Status</th>
                                <th>QTD</th>
                                <th>Valor Unit (R$)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="container2-table-body">
                            </tbody>
                    </table>
                </div>
            </div>
            
            <div class="empty-state hidden" id="container2-empty">
                <div class="empty-state-icon">üì¶</div>
                <p>Nenhum item encontrado no Container 2.</p>
            </div>
        </div>
        
        <div id="container3-content" class="container-content">
            <div class="container-header">
                <div>
                    <h3 class="container-title">Container 3</h3>
                    <p style="color: var(--muted); margin-top: 5px;">Pneus reformados</p>
                </div>
                <div class="container-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="container3-total">0</span>
                        <span class="stat-label">Total Itens</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="container3-valor">R$ 0</span>
                        <span class="stat-label">Valor Total</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="container3-reformados">0</span>
                        <span class="stat-label">Reformados</span>
                    </div>
                </div>
            </div>
            
            <div class="table-card container-table">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Medida</th>
                                <th>Marca/Modelo</th>
                                <th>Status</th>
                                <th>QTD</th>
                                <th>Valor Unit (R$)</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="container3-table-body">
                            </tbody>
                    </table>
                </div>
            </div>
            
            <div class="empty-state hidden" id="container3-empty">
                <div class="empty-state-icon">üì¶</div>
                <p>Nenhum item encontrado no Container 3.</p>
            </div>
        </div>
      </div>
    </div>

    <div id="tab-movimento-pneus" class="tab-content hidden">
        <div class="reports-container">
            <div class="report-header">
                <h2 class="report-title">Montagem de Ve√≠culos</h2>
                <div class="controls-row">
                    <button onclick="openAddVeiculoModal()" class="btn-success"> ‚ûï Adicionar Ve√≠culo </button>
                    <button onclick="iniciarMontagem()" class="btn-success" id="btnIniciarMontagem"> üîß Iniciar Montagem </button>
                    <button onclick="finalizarMontagem()" class="btn-success" id="btnFinalizarMontagem" style="display: none;"> ‚úÖ Finalizar Montagem </button>
                    <button onclick="saveTirePositions()" class="btn-success"> üíæ Salvar Posi√ß√µes </button>
                    <button onclick="resetTirePositions()" class="btn-warning"> üîÑ Resetar </button>
                </div>
            </div>
            
            <div class="montagem-info" id="montagemInfo" style="display: none;">
                <h3 style="color: var(--accent); margin-bottom: 10px;">üîß Modo Montagem Ativo</h3>
                <p style="margin-bottom: 10px;">Arraste os pneus dispon√≠veis para as posi√ß√µes desejadas no caminh√£o. Clique em "Finalizar Montagem" quando terminar.</p>
                <div class="montagem-status">
                    <div class="status-item">
                        <div class="status-value" id="statusPneusMontados">0</div>
                        <div class="status-label">Pneus Montados</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="statusPosicoesVazias">0</div>
                        <div class="status-label">Posi√ß√µes Vazias</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="statusPneusDisponiveis">0</div>
                        <div class="status-label">Pneus Dispon√≠veis</div>
                    </div>
                </div>
            </div>

            <div class="movement-container">
                <div class="vehicles-panel">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="font-size: 1.1rem;">Lista de Ve√≠culos</h3>
                        <span style="font-size: 0.9rem; color: var(--muted);" id="veiculosCount">0 Ve√≠culos</span>
                    </div>
                    <div id="vehiclesList">
                        </div>
                </div>
                
                <div class="visualization-panel">
                    <div style="width: 100%; text-align: center; margin-bottom: 15px;">
                        <h2 id="currentVehicle" style="color: var(--text); margin-bottom: 5px;">Selecione um Ve√≠culo</h2>
                        <p id="vehicleDetails" style="color: var(--muted); font-size: 0.9rem;">Detalhes</p>
                    </div>

                    <div class="vehicle-display">
                        <div class="truck-diagram" id="truckDiagram">
                            </div>
                    </div>
                    
                    <div class="available-tires-panel">
                        <h3 style="font-size: 1.1rem; margin-bottom: 15px;">Pneus Dispon√≠veis para Montagem</h3>
                        <div id="availableTiresList">
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="tab-performance" class="tab-content hidden">
      <div class="reports-container">
        <div class="report-header">
          <h2 class="report-title">Performance por Ve√≠culo</h2>
          <div class="controls-row">
            <select id="veiculoFilter" class="input">
              <option value="">Todos Ve√≠culos</option>
              <option value="VOLVO FH-540">VOLVO FH-540</option>
              <option value="SCANIA R450">SCANIA R450</option>
              <option value="MERCEDES AXOR">MERCEDES AXOR</option>
              <option value="VOLKSWAGER 8.160">VOLKSWAGER 8.160</option>
            </select>
            <select id="periodoFilter" class="input">
              <option value="30">√öltimos 30 dias</option>
              <option value="90">√öltimos 90 dias</option>
              <option value="180">√öltimos 6 meses</option>
              <option value="365">√öltimo ano</option>
            </select>
            <button onclick="generatePerformanceReport()">
              Gerar Relat√≥rio
            </button>
            <button onclick="exportPerformanceToExcel()" class="btn-purple">
              Exportar Excel
            </button>
          </div>
        </div>

        <div class="metrics-grid" id="performanceMetrics">
          </div>

        <div class="charts-grid">
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">Custo por KM por Ve√≠culo</h3>
            </div>
            <div class="chart-container">
              <canvas id="custoKmChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">Durabilidade dos Pneus</h3>
            </div>
            <div class="chart-container">
              <canvas id="durabilidadeChart"></canvas>
            </div>
          </div>
        </div>

        <div class="table-card">
          <div class="table-header">
            <h3 class="table-title">Performance Detalhada por Ve√≠culo</h3>
          </div>
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ve√≠culo</th>
                  <th>Total KM</th>
                  <th>Pneus Trocados</th>
                  <th>Custo Total (R$)</th>
                  <th>Custo/KM (R$)</th>
                  <th>M√©dia Durabilidade (KM)</th>
                </tr>
              </thead>
              <tbody id="performanceTableBody">
                </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <div id="tab-fogos" class="tab-content hidden">
      <div class="reports-container">
        <div class="report-header">
          <h2 class="report-title">Gest√£o de Pneus com Fogo (Serial)</h2>
          <div class="controls-row">
            <button onclick="openAddFogoModal()" class="btn-success">
              ‚ûï Adicionar Fogo
            </button>
            <button onclick="exportFogosToExcel()" class="btn-purple">
              Exportar Excel
            </button>
          </div>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="totalFogosMetric">0</div>
                <div class="metric-label">Total de Fogos</div>
                <div class="metric-change positive">Em uso + Estoque Fogo</div>
            </div>
            <div class="metric-card" style="--accent: var(--warn);">
                <div class="metric-value" id="emVeiculosMetric">0</div>
                <div class="metric-label">Em Ve√≠culos</div>
                <div class="metric-change positive">Pneus montados em frota</div>
            </div>
            <div class="metric-card" style="--accent: var(--success);">
                <div class="metric-value" id="emEstoqueMetric">0</div>
                <div class="metric-label">Em Estoque Fogo</div>
                <div class="metric-change positive">Prontos para montagem</div>
            </div>
        </div>

        <div class="table-card">
          <div class="table-header">
            <h3 class="table-title">Lista de Pneus com Fogo</h3>
            <div style="color: var(--muted); font-size: 0.9rem;">
                <span id="fogosCount">0</span> fogos ativos
            </div>
          </div>
          <div class="table-container">
            <div id="fogosList" style="padding: 20px;">
              </div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="tab-alertas" class="tab-content hidden">
        <div class="reports-container">
            <div class="report-header">
                <h2 class="report-title">Alertas do Sistema</h2>
                <div class="controls-row">
                    <button onclick="openAddAlertaModal()" class="btn-danger">
                        ‚ûï Criar Alerta Manual
                    </button>
                    <button onclick="exportAlertsToExcel()" class="btn-warning">
                        Exportar Excel
                    </button>
                </div>
            </div>

            <div class="metrics-grid">
                <div class="metric-card" style="--accent: var(--danger);">
                    <div class="metric-value" id="alertasPendentesMetric">0</div>
                    <div class="metric-label">Pendentes</div>
                    <div class="metric-change negative">Aten√ß√£o Imediata</div>
                </div>
                <div class="metric-card" style="--accent: var(--success);">
                    <div class="metric-value" id="alertasResolvidosMetric">0</div>
                    <div class="metric-label">Resolvidos (30 dias)</div>
                    <div class="metric-change positive">Hist√≥rico Recente</div>
                </div>
            </div>

            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">Alertas Pendentes</h3>
                    <select id="alertaFilter" class="input" onchange="renderAlertsList()">
                        <option value="pendente">Pendentes</option>
                        <option value="resolvido">Resolvidos</option>
                        <option value="todos">Todos</option>
                    </select>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tipo de Alerta</th>
                                <th>Origem</th>
                                <th>Mensagem</th>
                                <th>Data</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="alertasTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div id="tab-exportar" class="tab-content hidden">
      <div class="reports-container">
        <div class="report-header">
          <h2 class="report-title">Exportar Relat√≥rios (PDF)</h2>
          <p style="color: var(--muted); margin-top: 5px;">Gere relat√≥rios completos em formato PDF para impress√£o ou arquivamento.</p>
        </div>

        <div class="export-cards">
          <div class="export-card" onclick="exportCompletePDF()">
            <div class="export-icon" style="color: var(--accent);">üìÑ</div>
            <div class="export-title">Relat√≥rio Completo</div>
            <div class="export-desc">Dashboard, Estoque, Fogos e Alertas (PDF com dados resumidos)</div>
          </div>
          <div class="export-card" onclick="exportFinancialReport()">
            <div class="export-icon" style="color: var(--success);">üí∞</div>
            <div class="export-title">Relat√≥rio Financeiro</div>
            <div class="export-desc">Valor total investido, custo dos fogos ativos e estoque</div>
          </div>
          <div class="export-card" onclick="exportInventoryReport()">
            <div class="export-icon" style="color: var(--warn);">üì¶</div>
            <div class="export-title">Relat√≥rio de Estoque</div>
            <div class="export-desc">Invent√°rio completo com valores e status de todos os pneus</div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <div class="bottom-nav">
    <button class="nav-btn active" data-tab="dashboard">
      <span class="nav-icon">üìä</span>
      Dashboard
    </button>
    <button class="nav-btn" data-tab="estoque">
      <span class="nav-icon">üì¶</span>
      Estoque
    </button>
    <button class="nav-btn" data-tab="movimento-pneus">
      <span class="nav-icon">üöö</span>
      Movimento
    </button>
    <button class="nav-btn" data-tab="fogos">
      <span class="nav-icon">üî•</span>
      Fogos
    </button>
    <button class="nav-btn" data-tab="alertas">
      <span class="nav-icon">üîî</span>
      Alertas
    </button>
  </div>

  <div class="modal-backdrop" id="addPneuModal">
    <div class="modal">
      <h2>Adicionar Novo Pneu ao Estoque</h2>
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div class="field-row">
          <div class="field-group">
            <label for="pneuMedida">Medida</label>
            <input type="text" id="pneuMedida" class="input" placeholder="Ex: 295/80 R22.5" required>
          </div>
          <div class="field-group">
            <label for="pneuMarca">Marca</label>
            <input type="text" id="pneuMarca" class="input" placeholder="Ex: Michelin" required>
          </div>
        </div>
        <div class="field-row">
          <div class="field-group">
            <label for="pneuModelo">Modelo</label>
            <input type="text" id="pneuModelo" class="input" placeholder="Ex: X Line Energy" required>
          </div>
          <div class="field-group">
            <label for="pneuStatus">Status</label>
            <select id="pneuStatus" class="input" required>
              <option value="Novo">Novo</option>
              <option value="Usado">Usado</option>
              <option value="Reformado">Reformado</option>
            </select>
          </div>
        </div>
        <div class="field-row">
          <div class="field-group">
            <label for="pneuQuantidade">QTD</label>
            <input type="number" id="pneuQuantidade" class="input" min="1" value="1" required>
          </div>
          <div class="field-group">
            <label for="pneuPreco">Valor Unit (R$)</label>
            <input type="number" id="pneuPreco" class="input" min="0" step="0.01" placeholder="Ex: 1500.00" required>
          </div>
        </div>
        <div class="field-row">
            <div class="field-group">
                <label for="pneuContainer">Container</label>
                <select id="pneuContainer" class="input" required>
                    <option value="container1">Container 1 (Novo/Sem Fogo)</option>
                    <option value="container2">Container 2 (Usado)</option>
                    <option value="container3">Container 3 (Reformado)</option>
                </select>
            </div>
        </div>
        <div class="field-group">
          <label for="pneuObservacoes">Observa√ß√µes (Opcional)</label>
          <textarea id="pneuObservacoes" class="input" placeholder="Detalhes adicionais..." style="width: 100%; height: 80px;"></textarea>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-xs" onclick="closeAddPneuModal()">Cancelar</button>
        <button onclick="confirmAddPneu()" class="btn-success">Adicionar</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="editPneuModal">
    <div class="modal">
      <h2>Editar Item de Estoque</h2>
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div class="field-row">
          <div class="field-group">
            <label for="editPneuMedida">Medida</label>
            <input type="text" id="editPneuMedida" class="input" required>
          </div>
          <div class="field-group">
            <label for="editPneuMarca">Marca</label>
            <input type="text" id="editPneuMarca" class="input" required>
          </div>
        </div>
        <div class="field-row">
          <div class="field-group">
            <label for="editPneuModelo">Modelo</label>
            <input type="text" id="editPneuModelo" class="input" required>
          </div>
          <div class="field-group">
            <label for="editPneuStatus">Status</label>
            <select id="editPneuStatus" class="input" required>
              <option value="Novo">Novo</option>
              <option value="Usado">Usado</option>
              <option value="Reformado">Reformado</option>
            </select>
          </div>
        </div>
        <div class="field-row">
          <div class="field-group">
            <label for="editPneuQuantidade">QTD</label>
            <input type="number" id="editPneuQuantidade" class="input" min="0" required>
          </div>
          <div class="field-group">
            <label for="editPneuPreco">Valor Unit (R$)</label>
            <input type="number" id="editPneuPreco" class="input" min="0" step="0.01" required>
          </div>
        </div>
        <div class="field-row">
            <div class="field-group">
                <label for="editPneuContainer">Container</label>
                <select id="editPneuContainer" class="input" required>
                    <option value="container1">Container 1 (Novo/Sem Fogo)</option>
                    <option value="container2">Container 2 (Usado)</option>
                    <option value="container3">Container 3 (Reformado)</option>
                </select>
            </div>
        </div>
        <div class="field-group">
          <label for="editPneuObservacoes">Observa√ß√µes (Opcional)</label>
          <textarea id="editPneuObservacoes" class="input" style="width: 100%; height: 80px;"></textarea>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-xs" onclick="closeEditPneuModal()">Cancelar</button>
        <button onclick="confirmEditPneu()" class="btn-success">Salvar Altera√ß√µes</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="deleteQuantityModal">
    <div class="modal">
      <h2>Excluir Quantidade de Pneus</h2>
      <p style="margin-bottom: 20px;">Voc√™ est√° prestes a remover unidades deste item do estoque. Insira a quantidade a ser removida:</p>
      
      <div class="field-group">
        <label for="deletePneuQuantidade">Quantidade a Excluir (M√°ximo: <span id="maxDeleteQuantity">0</span>)</label>
        <input type="number" id="deletePneuQuantidade" class="input" min="1" value="1" required>
      </div>

      <div class="modal-actions">
        <button class="btn-xs" onclick="closeDeleteQuantityModal()">Cancelar</button>
        <button onclick="confirmDeleteQuantity()" class="btn-danger">Excluir Unidades</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="addFogoModal">
    <div class="modal">
      <h2>Adicionar Novo Fogo (Serial)</h2>
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div class="field-row">
          <div class="field-group">
            <label for="fogoNumero">N√∫mero do Fogo (Serial)</label>
            <input type="text" id="fogoNumero" class="input" placeholder="Ex: 001, 12345" required>
          </div>
          <div class="field-group">
            <label for="fogoPneuId">Selecione o Item do Estoque</label>
            <select id="fogoPneuId" class="input" required onchange="updateFogoPreview()">
              <option value="">Selecione um item...</option>
              </select>
          </div>
        </div>
        <div class="field-row">
          <div class="field-group">
            <label for="fogoQuantidade">Quantidade de Fogos a Gerar</label>
            <input type="number" id="fogoQuantidade" class="input" min="1" value="1" required>
          </div>
        </div>
        
        <div id="fogoPreview" style="padding: 15px; border: 1px dashed var(--muted); border-radius: var(--radius); font-size: 0.9rem; color: var(--text); background: rgba(15, 23, 42, 0.4);">
            <p style="color: var(--muted);">Pr√©via do Pneu: Selecione um item de estoque para ver os detalhes.</p>
        </div>

        <div class="field-group">
          <label for="fogoObservacoes">Observa√ß√µes (Opcional)</label>
          <textarea id="fogoObservacoes" class="input" placeholder="Observa√ß√µes sobre o pneu (data de compra, etc.)..." style="width: 100%; height: 80px;"></textarea>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-xs" onclick="closeAddFogoModal()">Cancelar</button>
        <button onclick="confirmAddFogo()" class="btn-success">Gerar Fogo(s)</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="editFogoModal">
    <div class="modal">
      <h2>Editar Fogo <span id="editFogoNumeroTitle"></span></h2>
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div class="field-row">
          <div class="field-group">
            <label for="editFogoMedida">Medida</label>
            <input type="text" id="editFogoMedida" class="input" disabled>
          </div>
          <div class="field-group">
            <label for="editFogoVeiculo">Ve√≠culo Atual</label>
            <select id="editFogoVeiculo" class="input" disabled>
                <option value="">Nenhum</option>
            </select>
          </div>
        </div>
        <div class="field-row">
          <div class="field-group">
            <label for="editFogoKMAcumulado">KM Acumulado (Total)</label>
            <input type="number" id="editFogoKMAcumulado" class="input" min="0" value="0" required>
          </div>
          <div class="field-group">
            <label for="editFogoPosicao">Posi√ß√£o</label>
            <select id="editFogoPosicao" class="input" disabled>
                <option value="">Em Estoque/N√£o Montado</option>
                </select>
          </div>
        </div>
        <div class="field-group">
          <label for="editFogoObservacoes">Observa√ß√µes</label>
          <textarea id="editFogoObservacoes" class="input" placeholder="Observa√ß√µes sobre o fogo..." style="width: 100%; height: 80px;"></textarea>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-xs" onclick="closeEditFogoModal()">Cancelar</button>
        <button onclick="confirmEditFogo()" class="btn-success">Salvar Altera√ß√µes</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="addVeiculoModal">
    <div class="modal">
      <h2>Adicionar Novo Ve√≠culo</h2>
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div class="field-row">
          <div class="field-group">
            <label for="veiculoPlaca">Placa *</label>
            <input type="text" id="veiculoPlaca" class="input" placeholder="Ex: ABC-1234" required>
          </div>
          <div class="field-group">
            <label for="veiculoModelo">Modelo *</label>
            <input type="text" id="veiculoModelo" class="input" placeholder="Ex: VOLVO FH-540" required>
          </div>
        </div>
        <div class="field-row">
          <div class="field-group">
            <label for="veiculoTipo">Tipo de Ve√≠culo *</label>
            <select id="veiculoTipo" class="input" required onchange="updateVeiculoConfig()">
              <option value="cavalo">Cavalo Mec√¢nico</option>
              <option value="carreta">Carreta</option>
            </select>
          </div>
          <div class="field-group">
            <label for="veiculoConfiguracao">Configura√ß√£o *</label>
            <select id="veiculoConfiguracao" class="input" required>
                <option value="6x2">6x2</option>
                <option value="6x4">6x4</option>
                <option value="4x2">4x2</option>
            </select>
          </div>
        </div>
        <div class="field-group">
            <label for="veiculoKmAtual">KM Atual</label>
            <input type="number" id="veiculoKmAtual" class="input" min="0" value="0" required>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-xs" onclick="closeAddVeiculoModal()">Cancelar</button>
        <button onclick="confirmAddVeiculo()" class="btn-success">Adicionar Ve√≠culo</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="editVeiculoModal">
    <div class="modal">
      <h2>Editar Ve√≠culo</h2>
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div class="field-row">
          <div class="field-group">
            <label for="editVeiculoPlaca">Placa *</label>
            <input type="text" id="editVeiculoPlaca" class="input" required>
          </div>
          <div class="field-group">
            <label for="editVeiculoModelo">Modelo *</label>
            <input type="text" id="editVeiculoModelo" class="input" required>
          </div>
        </div>
        <div class="field-row">
          <div class="field-group">
            <label for="editVeiculoTipo">Tipo de Ve√≠culo *</label>
            <select id="editVeiculoTipo" class="input" required onchange="updateEditVeiculoConfig()">
              <option value="cavalo">Cavalo Mec√¢nico</option>
              <option value="carreta">Carreta</option>
            </select>
          </div>
          <div class="field-group">
            <label for="editVeiculoConfiguracao">Configura√ß√£o *</label>
            <select id="editVeiculoConfiguracao" class="input" required>
                <option value="6x2">6x2</option>
                <option value="6x4">6x4</option>
                <option value="4x2">4x2</option>
            </select>
          </div>
        </div>
        <div class="field-group">
            <label for="editVeiculoKmAtual">KM Atual</label>
            <input type="number" id="editVeiculoKmAtual" class="input" min="0" required>
        </div>
        <div class="field-group">
            <label for="editVeiculoObservacoes">Observa√ß√µes (Opcional)</label>
            <textarea id="editVeiculoObservacoes" class="input" style="width: 100%; height: 80px;"></textarea>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-xs" onclick="closeEditVeiculoModal()">Cancelar</button>
        <button onclick="confirmEditVeiculo()" class="btn-success">Salvar Altera√ß√µes</button>
        <button onclick="deleteVeiculo()" class="btn-danger">Excluir Ve√≠culo</button>
      </div>
    </div>
  </div>


  <div class="modal-backdrop" id="addAlertaModal">
    <div class="modal">
      <h2>Criar Novo Alerta Manual</h2>
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div class="field-group">
            <label for="alertaTipo">Tipo de Alerta</label>
            <select id="alertaTipo" class="input" required>
                <option value="Manuten√ß√£o Urgente">Manuten√ß√£o Urgente</option>
                <option value="Troca Programada">Troca Programada</option>
                <option value="Estoque Baixo">Estoque Baixo</option>
                <option value="Outro">Outro</option>
            </select>
        </div>
        <div class="field-group">
            <label for="alertaMensagem">Mensagem *</label>
            <textarea id="alertaMensagem" class="input" placeholder="Descreva o alerta..." style="width: 100%; height: 80px;" required></textarea>
        </div>
        <div class="field-group">
            <label for="alertaOrigem">Origem (Opcional)</label>
            <input type="text" id="alertaOrigem" class="input" placeholder="Ex: Fogo 123, Ve√≠culo ABC-1234">
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-xs" onclick="closeAddAlertaModal()">Cancelar</button>
        <button onclick="confirmAddAlerta()" class="btn-danger">Criar Alerta</button>
      </div>
    </div>
  </div>
  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  
  <script>
    // Vari√°veis globais de estado
    let reportData = {};
    let veiculoSelecionado = null;
    let pneuEditando = null;
    let pneuParaExcluir = null;
    let fogoEditando = null;
    let chartStatus, chartBrand, custoKmChart, durabilidadeChart;
    let sistemaAlertas = [];
    let alertaEditando = null;
    
    // Vari√°veis do sistema de movimenta√ß√£o
    let modoMontagem = false;
    let pneusDisponiveis = [];
    let montagemTemporaria = {
        dataInicio: null,
        posicoesOcupadas: {}, // { 'dianteiro-esquerda': '001', ... }
        pneusMontados: [], // ['001', '002', ...]
    };

    // Estrutura de dados inicial (para o primeiro acesso)
    const initialData = {
      items: [
        { id: 'P001', medida: '295/80 R22.5', marca: 'Michelin', modelo: 'X Line Energy', status: 'Novo', qty: 15, preco: 1500.00, container: 'container1', observacoes: 'Lote A' },
        { id: 'P002', medida: '295/80 R22.5', marca: 'Pirelli', modelo: 'TR01', status: 'Novo', qty: 10, preco: 1200.00, container: 'container1', observacoes: 'Lote B' },
        { id: 'P003', medida: '275/80 R22.5', marca: 'Bridgestone', modelo: 'R248', status: 'Usado', qty: 5, preco: 800.00, container: 'container2', observacoes: 'Vida √∫til restante 50%' },
        { id: 'P004', medida: '295/80 R22.5', marca: 'Michelin', modelo: 'X Line Energy', status: 'Reformado', qty: 8, preco: 600.00, container: 'container3', observacoes: '1¬™ recapagem' },
        { id: 'P005', medida: '11.00 R22', marca: 'Goodyear', modelo: 'G667', status: 'Novo', qty: 2, preco: 1000.00, container: 'container1', observacoes: 'Para VOLKSWAGER 8.160' }
      ],
      fogos: [
        { numero: '12345', pneuId: 'P001', dataCadastro: '2023-10-01', kmAcumulado: 45000, veiculo: 'V001', posicao: 'traseiro1-esquerda', observacoes: 'Montado em 15/10/2023' },
        { numero: '12346', pneuId: 'P001', dataCadastro: '2023-10-01', kmAcumulado: 45000, veiculo: 'V001', posicao: 'traseiro1-direita', observacoes: 'Montado em 15/10/2023' },
        { numero: '12347', pneuId: 'P001', dataCadastro: '2023-10-01', kmAcumulado: 40000, veiculo: 'V002', posicao: 'dianteiro-esquerda', observacoes: 'Montado em 20/10/2023' },
        { numero: '12348', pneuId: 'P002', dataCadastro: '2023-11-15', kmAcumulado: 0, veiculo: null, posicao: null, observacoes: 'Em estoque fogo' },
        { numero: '12349', pneuId: 'P002', dataCadastro: '2023-11-15', kmAcumulado: 0, veiculo: null, posicao: null, observacoes: 'Em estoque fogo' },
      ],
      movimentacoes: [
        { id: 'M001', data: '2023-10-15', tipo: 'Montagem', fogo: '12345', veiculo: 'V001', posicao: 'traseiro1-esquerda', kmVeiculo: 150000, kmFogo: 0 },
        { id: 'M002', data: '2023-10-15', tipo: 'Montagem', fogo: '12346', veiculo: 'V001', posicao: 'traseiro1-direita', kmVeiculo: 150000, kmFogo: 0 },
        { id: 'M003', data: '2023-10-20', tipo: 'Montagem', fogo: '12347', veiculo: 'V002', posicao: 'dianteiro-esquerda', kmVeiculo: 80000, kmFogo: 0 },
        { id: 'M004', data: '2023-11-10', tipo: 'Desmontagem', fogo: '12345', veiculo: 'V001', posicao: 'traseiro1-esquerda', kmVeiculo: 195000, kmFogo: 45000 },
        { id: 'M005', data: '2023-11-10', tipo: 'Desmontagem', fogo: '12346', veiculo: 'V001', posicao: 'traseiro1-direita', kmVeiculo: 195000, kmFogo: 45000 },
        { id: 'M006', data: '2023-11-10', tipo: 'Montagem', fogo: '12345', veiculo: 'V001', posicao: 'traseiro2-esquerda', kmVeiculo: 195000, kmFogo: 45000 },
        { id: 'M007', data: '2023-11-10', tipo: 'Montagem', fogo: '12346', veiculo: 'V001', posicao: 'traseiro2-direita', kmVeiculo: 195000, kmFogo: 45000 },
      ],
      veiculos: [
        { 
            id: 'V001', 
            placa: 'ABC-1234', 
            modelo: 'VOLVO FH-540', 
            tipo: 'cavalo', 
            configuracao: '6x2', // 6x2, 6x4, 4x2, etc.
            kmAtual: 200000,
            observacoes: 'Ve√≠culo principal da frota',
            eixos: { 
                dianteiro: { tipo: 'direcional', esquerda: '12350', direita: '12351' }, 
                traseiro1: { tipo: 'tracao', esquerda: '12352', direita: '12353' }, 
                traseiro2: { tipo: 'livre', esquerda: '12345', direita: '12346' }, 
                estepe: '12348' 
            } 
        },
        { 
            id: 'V002', 
            placa: 'DEF-5678', 
            modelo: 'SCANIA R450', 
            tipo: 'cavalo', 
            configuracao: '6x4',
            kmAtual: 100000,
            observacoes: 'Ve√≠culo reserva',
            eixos: { 
                dianteiro: { tipo: 'direcional', esquerda: '12347', direita: null }, 
                traseiro1: { tipo: 'tracao', esquerda: null, direita: null }, 
                traseiro2: { tipo: 'tracao', esquerda: null, direita: null }, 
                estepe: null 
            } 
        },
        { 
            id: 'V003', 
            placa: 'GHI-9012', 
            modelo: 'Carreta Ba√∫', 
            tipo: 'carreta', 
            configuracao: '3 eixos',
            kmAtual: 50000,
            observacoes: 'Carreta de carga seca',
            eixos: { 
                traseiro1: { tipo: 'fixo', esquerda: null, direita: null }, 
                traseiro2: { tipo: 'fixo', esquerda: null, direita: null }, 
                traseiro3: { tipo: 'fixo', esquerda: null, direita: null }, 
                estepe: null 
            } 
        }
      ],
      performance: [
        { veiculo: 'VOLVO FH-540', kmTotal: 300000, pneusTrocados: 12, custoTotal: 60000.00, durabilidadeMedia: 50000 },
        { veiculo: 'SCANIA R450', kmTotal: 150000, pneusTrocados: 6, custoTotal: 25000.00, durabilidadeMedia: 45000 }
      ]
    };

    // Fun√ß√£o principal para carregar os dados
    function loadData() {
      const savedData = localStorage.getItem('tc_report_data');
      if (savedData) {
        reportData = JSON.parse(savedData);
        // Garantir que a estrutura de eixos de ve√≠culos mais recentes esteja correta, caso tenha sido salva em um formato mais antigo.
        reportData.veiculos = reportData.veiculos.map(v => {
            if (!v.eixos) {
                v.eixos = createInitialAxles(v.tipo, v.configuracao);
            }
            if (!v.kmAtual) v.kmAtual = 0;
            return v;
        });
      } else {
        reportData = initialData;
      }
      
      // Corrigir dados de fogos para pneus que foram exclu√≠dos do estoque (se houver)
      reportData.fogos = reportData.fogos.filter(fogo => reportData.items.some(item => item.id === fogo.pneuId));
      
      // Sincronizar posi√ß√µes dos fogos com a estrutura de ve√≠culos
      sincronizarFogosComVeiculos();
    }

    // Fun√ß√£o para sincronizar: (1) Remover refer√™ncias de fogos em ve√≠culos se o fogo n√£o existir, (2) Atualizar o campo `veiculo`/`posicao` do fogo baseado no ve√≠culo
    function sincronizarFogosComVeiculos() {
        const fogosExistentes = reportData.fogos.map(f => f.numero);
        
        // 1. Limpar refer√™ncias inv√°lidas nos ve√≠culos e preencher fogos (para evitar inconsist√™ncias)
        reportData.veiculos.forEach(v => {
            v.eixos = Object.fromEntries(
                Object.entries(v.eixos).map(([eixoKey, eixoValue]) => {
                    if (eixoValue && typeof eixoValue === 'object') {
                        // Eixo duplo
                        eixoValue.esquerda = fogosExistentes.includes(eixoValue.esquerda) ? eixoValue.esquerda : null;
                        eixoValue.direita = fogosExistentes.includes(eixoValue.direita) ? eixoValue.direita : null;
                    } else if (eixoValue && typeof eixoValue === 'string') {
                        // Estepe (valor √∫nico)
                        eixoValue = fogosExistentes.includes(eixoValue) ? eixoValue : null;
                    }
                    return [eixoKey, eixoValue];
                })
            );
        });

        // 2. Atualizar o objeto 'fogos' com a posi√ß√£o e ve√≠culo corretos
        reportData.fogos.forEach(fogo => {
            fogo.veiculo = null;
            fogo.posicao = null;

            // Busca a posi√ß√£o do fogo em todos os ve√≠culos
            for (const v of reportData.veiculos) {
                for (const [eixoKey, eixoValue] of Object.entries(v.eixos)) {
                    if (eixoValue && typeof eixoValue === 'object') {
                        if (eixoValue.esquerda === fogo.numero) {
                            fogo.veiculo = v.id;
                            fogo.posicao = `${eixoKey}-esquerda`;
                            return; // Encontrado, pare de procurar por este fogo
                        }
                        if (eixoValue.direita === fogo.numero) {
                            fogo.veiculo = v.id;
                            fogo.posicao = `${eixoKey}-direita`;
                            return; // Encontrado, pare de procurar por este fogo
                        }
                    } else if (eixoValue === fogo.numero) {
                        fogo.veiculo = v.id;
                        fogo.posicao = eixoKey; // Para o estepe
                        return; // Encontrado, pare de procurar por este fogo
                    }
                }
            }
        });
    }

    // Fun√ß√£o para salvar os dados
    function saveData() {
      localStorage.setItem('tc_report_data', JSON.stringify(reportData));
      console.log('Dados salvos no LocalStorage.');
    }

    // Fun√ß√£o para resetar os dados
    function resetData() {
        if (confirm('ATEN√á√ÉO: Isso ir√° APAGAR TODOS OS DADOS de estoque, fogos e ve√≠culos. Tem certeza?')) {
            localStorage.removeItem('tc_report_data');
            localStorage.removeItem('tc_alertas');
            loadData();
            inicializarSistemaAlertas();
            showNotification('Dados resetados com sucesso!', 'success');
            // Recarregar a aba atual
            const activeTab = document.querySelector('.tab-btn.active').dataset.tab;
            if (activeTab) {
                document.querySelector(`.tab-btn[data-tab="${activeTab}"]`).click();
            } else {
                renderDashboard();
            }
        }
    }

    // Fun√ß√£o de notifica√ß√£o
    function showNotification(message, type = 'success') {
      const area = document.getElementById('notification-area');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      area.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.add('hidden');
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // =============================================
    // FUN√á√ïES DE C√ÅLCULO
    // =============================================
    
    function calcularEstoquePorStatus() {
        return reportData.items.reduce((acc, item) => {
            acc[item.status] = (acc[item.status] || 0) + item.qty;
            return acc;
        }, { 'Novo': 0, 'Usado': 0, 'Reformado': 0 });
    }

    function calcularEstoquePorContainer() {
        return reportData.items.reduce((acc, item) => {
            acc[item.container] = (acc[item.container] || 0) + item.qty;
            return acc;
        }, { 'container1': 0, 'container2': 0, 'container3': 0 });
    }
    
    function calcularEstoquePorMarca() {
        const data = reportData.items.reduce((acc, item) => {
            if (!acc[item.marca]) {
                acc[item.marca] = 0;
            }
            acc[item.marca] += item.qty * (item.preco || 0);
            return acc;
        }, {});

        return Object.entries(data)
            .sort(([, a], [, b]) => b - a) // Ordena do maior para o menor valor
            .slice(0, 5) // Pega apenas os 5 primeiros
            .map(([marca, valor]) => ({ marca, valor }));
    }
    
    // =============================================
    // DASHBOARD
    // =============================================

    function renderDashboard() {
        loadData(); // Recarregar dados para garantir a sincronia
        console.log('Renderizando Dashboard...');
        
        // 1. M√©tricas
        const totalEstoque = reportData.items.reduce((sum, item) => sum + item.qty, 0);
        const totalFogos = reportData.fogos.length;
        const valorTotal = reportData.items.reduce((sum, item) => sum + (item.qty * (item.preco || 0)), 0);
        const pneusNovos = reportData.items.filter(item => item.status === 'Novo').reduce((sum, item) => sum + item.qty, 0);
        const alertasPendentes = sistemaAlertas.filter(a => a.status === 'pendente').length;

        const metricsContainer = document.getElementById('dashboardMetrics');
        if (metricsContainer) {
            metricsContainer.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${totalEstoque}</div>
                    <div class="metric-label">Total em Estoque</div>
                    <div class="metric-change positive">‚Üë 12% vs m√™s anterior</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${totalFogos}</div>
                    <div class="metric-label">Pneus com Fogo</div>
                    <div class="metric-change positive">‚Üë 8% vs m√™s anterior</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">R$ ${valorTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                    <div class="metric-label">Valor Total Estoque</div>
                    <div class="metric-change positive">Rendimento por KM (Em breve)</div>
                </div>
                <div class="metric-card" style="--accent: var(--danger);">
                    <div class="metric-value">${alertasPendentes}</div>
                    <div class="metric-label">Alertas Pendentes</div>
                    <div class="metric-change negative">A√ß√µes Imediatas</div>
                </div>
            `;
        }

        // 2. Gr√°fico por Status
        renderStatusChart();
        
        // 3. Gr√°fico de Valor por Marca
        renderBrandValueChart();
        
        // 4. Tabela de Movimenta√ß√µes Recentes
        renderMovimentacoesRecentes();
        
        verificarAlertasAutomaticos();
    }
    
    function renderStatusChart() {
      const statusData = calcularEstoquePorStatus();
      const labels = Object.keys(statusData);
      const data = Object.values(statusData);
      
      const colors = [
          '#10b981', // Novo - Success
          '#f97316', // Usado - Warn
          '#8b5cf6'  // Reformado - Purple
      ];

      const ctx = document.getElementById('statusChart').getContext('2d');
      if (chartStatus) chartStatus.destroy();

      chartStatus = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: colors,
            hoverOffset: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: 'var(--muted)',
                font: {
                    family: "'Segoe UI', system-ui, sans-serif"
                }
              }
            },
            title: {
              display: false,
            }
          }
        }
      });
    }

    function renderBrandValueChart() {
        const brandValueData = calcularEstoquePorMarca();
        const labels = brandValueData.map(item => item.marca);
        const data = brandValueData.map(item => item.valor);
        
        const colors = [
            '#38bdf8', '#8b5cf6', '#10b981', '#f97316', '#f43f5e'
        ];

        const ctx = document.getElementById('brandValueChart').getContext('2d');
        if (chartBrand) chartBrand.destroy();

        chartBrand = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Valor Total (R$)',
                    data: data,
                    backgroundColor: colors,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: 'var(--muted)',
                            callback: function(value) {
                                return 'R$ ' + value.toLocaleString('pt-BR');
                            }
                        },
                        grid: {
                            color: 'rgba(148, 163, 184, 0.1)',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            color: 'var(--muted)'
                        },
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
    
    function renderMovimentacoesRecentes() {
        const body = document.getElementById('movimentacoesRecentesBody');
        body.innerHTML = '';
        
        const sevenDaysAgo = new Date();
        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

        const recentes = reportData.movimentacoes
            .filter(mov => new Date(mov.data) >= sevenDaysAgo)
            .sort((a, b) => new Date(b.data) - new Date(a.data))
            .slice(0, 10); // Limitar a 10 para o dashboard

        if (recentes.length === 0) {
            body.innerHTML = `<tr><td colspan="5" style="text-align: center; color: var(--muted);">Nenhuma movimenta√ß√£o recente nos √∫ltimos 7 dias.</td></tr>`;
            return;
        }

        recentes.forEach(mov => {
            const veiculo = reportData.veiculos.find(v => v.id === mov.veiculo) || { placa: 'N/A' };
            const statusClass = mov.tipo === 'Montagem' ? 'status-novo' : 'status-danger';
            
            const row = body.insertRow();
            row.innerHTML = `
                <td><span style="font-weight: bold;">${mov.fogo}</span></td>
                <td>${veiculo.placa}</td>
                <td>${mov.posicao.toUpperCase().replace('-', ' ')}</td>
                <td>${new Date(mov.data).toLocaleDateString('pt-BR')}</td>
                <td><span class="status-badge ${statusClass}">${mov.tipo}</span></td>
            `;
        });
    }

    // =============================================
    // ESTOQUE
    // =============================================

    // Controla a troca de abas dentro da aba Estoque
    document.querySelectorAll('.container-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.container-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            document.querySelectorAll('.container-content').forEach(c => c.classList.remove('active'));
            const containerId = this.dataset.container;
            document.getElementById(`${containerId}-content`).classList.add('active');
            
            updateContainerData(containerId);
        });
    });

    function updateContainerData(containerId) {
        const containerItems = reportData.items.filter(item => item.container === containerId);
        const body = document.getElementById(`${containerId}-table-body`);
        const totalElement = document.getElementById(`${containerId}-total`);
        const valorElement = document.getElementById(`${containerId}-valor`);
        const specificStatElement = document.getElementById(`${containerId}-novos`) || document.getElementById(`${containerId}-usados`) || document.getElementById(`${containerId}-reformados`);
        const emptyState = document.getElementById(`${containerId}-empty`);

        body.innerHTML = '';

        if (containerItems.length === 0) {
            emptyState.classList.remove('hidden');
        } else {
            emptyState.classList.add('hidden');
            containerItems.forEach(item => {
                const isFogo = reportData.fogos.some(f => f.pneuId === item.id);
                const isUsable = item.status === 'Novo' || item.status === 'Reformado';
                const showAddFogo = !isFogo && isUsable;

                const row = body.insertRow();
                row.innerHTML = `
                    <td><span style="font-weight: bold;">${item.id}</span></td>
                    <td>${item.medida}</td>
                    <td>${item.marca} / ${item.modelo}</td>
                    <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
                    <td>${item.qty}</td>
                    <td>R$ ${item.preco.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-xs" onclick="openEditPneuModal('${item.id}')">Editar</button>
                            <button class="btn-xs btn-danger" onclick="openDeleteQuantityModal('${item.id}')">Excluir QTD</button>
                            ${showAddFogo ? `<button class="btn-xs btn-warning" onclick="openAddFogoModal('${item.id}', 1)">Gerar Fogo</button>` : ''}
                        </div>
                    </td>
                `;
            });
        }
        
        // Atualizar estat√≠sticas do container
        const totalQty = containerItems.reduce((sum, item) => sum + item.qty, 0);
        const totalValue = containerItems.reduce((sum, item) => sum + (item.qty * (item.preco || 0)), 0);
        
        totalElement.textContent = totalQty;
        valorElement.textContent = `R$ ${totalValue.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        
        let statSpecific = 0;
        if (containerId === 'container1') {
            statSpecific = containerItems.filter(p => p.status === 'Novo').reduce((sum, item) => sum + item.qty, 0);
        } else if (containerId === 'container2') {
            statSpecific = containerItems.filter(p => p.status === 'Usado').reduce((sum, item) => sum + item.qty, 0);
        } else if (containerId === 'container3') {
            statSpecific = containerItems.filter(p => p.status === 'Reformado').reduce((sum, item) => sum + item.qty, 0);
        }
        if (specificStatElement) specificStatElement.textContent = statSpecific;

    }

    function generateStockReport() {
        console.log('Gerando relat√≥rio de estoque por containers...');
        // O container 1 √© o ativo por padr√£o ao entrar na aba
        updateContainerData('container1'); 
        updateContainerData('container2');
        updateContainerData('container3');
    }

    // =============================================
    // FUN√á√ïES PARA CONTROLE DE QUANTIDADE DE PNEUS
    // =============================================
    
    function openAddPneuModal() {
        document.getElementById('addPneuModal').style.display = 'flex';
    }

    function closeAddPneuModal() {
        document.getElementById('addPneuModal').style.display = 'none';
        // Limpar campos
        document.getElementById('pneuMedida').value = '';
        document.getElementById('pneuMarca').value = '';
        document.getElementById('pneuModelo').value = '';
        document.getElementById('pneuStatus').value = 'Novo';
        document.getElementById('pneuQuantidade').value = 1;
        document.getElementById('pneuPreco').value = '';
        document.getElementById('pneuContainer').value = 'container1';
        document.getElementById('pneuObservacoes').value = '';
    }

    function confirmAddPneu() {
        const medida = document.getElementById('pneuMedida').value;
        const marca = document.getElementById('pneuMarca').value;
        const modelo = document.getElementById('pneuModelo').value;
        const status = document.getElementById('pneuStatus').value;
        const qty = parseInt(document.getElementById('pneuQuantidade').value);
        const preco = parseFloat(document.getElementById('pneuPreco').value);
        const container = document.getElementById('pneuContainer').value;
        const observacoes = document.getElementById('pneuObservacoes').value;
        
        if (!medida || !marca || !modelo || !status || qty < 1 || isNaN(preco) || preco < 0) {
            showNotification('Preencha todos os campos obrigat√≥rios corretamente.', 'error');
            return;
        }

        // Gerar um ID √∫nico
        let newId;
        do {
            const num = (reportData.items.length + 1).toString().padStart(3, '0');
            newId = `P${num}`;
        } while(reportData.items.some(p => p.id === newId));

        reportData.items.push({
            id: newId,
            medida,
            marca,
            modelo,
            status,
            qty,
            preco,
            container,
            observacoes
        });

        showNotification(`Pneu ${newId} adicionado com sucesso! QTD: ${qty}`, 'success');
        closeAddPneuModal();
        saveData();
        generateStockReport();
        renderDashboard();
        verificarAlertasAutomaticos();
    }

    function openEditPneuModal(pneuId) {
        const pneu = reportData.items.find(p => p.id === pneuId);
        if (!pneu) return;
        pneuEditando = pneu;

        // Preencher modal com dados atuais
        document.getElementById('editPneuMedida').value = pneu.medida;
        document.getElementById('editPneuMarca').value = pneu.marca;
        document.getElementById('editPneuModelo').value = pneu.modelo;
        document.getElementById('editPneuStatus').value = pneu.status;
        document.getElementById('editPneuQuantidade').value = pneu.qty;
        document.getElementById('editPneuPreco').value = pneu.preco;
        document.getElementById('editPneuContainer').value = pneu.container;
        document.getElementById('editPneuObservacoes').value = pneu.observacoes || '';

        document.getElementById('editPneuModal').style.display = 'flex';
    }

    function closeEditPneuModal() {
        document.getElementById('editPneuModal').style.display = 'none';
        pneuEditando = null;
    }

    function confirmEditPneu() {
        if (!pneuEditando) return;

        const medida = document.getElementById('editPneuMedida').value;
        const marca = document.getElementById('editPneuMarca').value;
        const modelo = document.getElementById('editPneuModelo').value;
        const status = document.getElementById('editPneuStatus').value;
        const qty = parseInt(document.getElementById('editPneuQuantidade').value);
        const preco = parseFloat(document.getElementById('editPneuPreco').value);
        const container = document.getElementById('editPneuContainer').value;
        const observacoes = document.getElementById('editPneuObservacoes').value;

        if (!medida || !marca || !modelo || !status || qty < 0 || isNaN(preco) || preco < 0) {
            showNotification('Preencha todos os campos obrigat√≥rios corretamente.', 'error');
            return;
        }
        
        // Verificar se a nova quantidade √© menor que o n√∫mero de fogos ativos
        const fogosAtivos = reportData.fogos.filter(f => f.pneuId === pneuEditando.id).length;
        if (qty < fogosAtivos) {
            showNotification(`N√£o √© poss√≠vel reduzir a quantidade para ${qty}, pois existem ${fogosAtivos} fogos ativos associados a este pneu.`, 'error');
            return;
        }

        pneuEditando.medida = medida;
        pneuEditando.marca = marca;
        pneuEditando.modelo = modelo;
        pneuEditando.status = status;
        pneuEditando.qty = qty;
        pneuEditando.preco = preco;
        pneuEditando.container = container;
        pneuEditando.observacoes = observacoes;

        showNotification(`Pneu ${pneuEditando.id} atualizado com sucesso!`, 'success');
        closeEditPneuModal();
        saveData();
        generateStockReport();
        renderDashboard();
    }
    
    function openDeleteQuantityModal(pneuId) {
        pneuParaExcluir = reportData.items.find(p => p.id === pneuId);
        if (!pneuParaExcluir) return;

        // Limite m√°ximo de exclus√£o (Quantidade total - Fogos Ativos)
        const fogosAtivos = reportData.fogos.filter(f => f.pneuId === pneuParaExcluir.id).length;
        const maxDelete = pneuParaExcluir.qty - fogosAtivos;

        document.getElementById('maxDeleteQuantity').textContent = maxDelete;
        document.getElementById('deletePneuQuantidade').max = maxDelete;
        document.getElementById('deletePneuQuantidade').value = 1;
        document.getElementById('deleteQuantityModal').style.display = 'flex';
    }

    function closeDeleteQuantityModal() {
        document.getElementById('deleteQuantityModal').style.display = 'none';
        pneuParaExcluir = null;
    }

    function confirmDeleteQuantity() {
        if (!pneuParaExcluir) return;
        
        const quantidade = parseInt(document.getElementById('deletePneuQuantidade').value);
        const maxDelete = parseInt(document.getElementById('maxDeleteQuantidade').textContent);

        if (isNaN(quantidade) || quantidade < 1 || quantidade > maxDelete) {
            showNotification(`A quantidade deve ser entre 1 e ${maxDelete}.`, 'error');
            return;
        }

        pneuParaExcluir.qty -= quantidade;

        // Se a quantidade chegar a 0, remover o pneu
        if (pneuParaExcluir.qty <= 0) {
            const index = reportData.items.findIndex(p => p.id === pneuParaExcluir.id);
            if (index !== -1) {
                reportData.items.splice(index, 1);
                showNotification(`Pneu ${pneuParaExcluir.id} removido do estoque!`, 'success');
            }
        } else {
            showNotification(`${quantidade} unidade(s) exclu√≠da(s) do pneu ${pneuParaExcluir.id}`, 'success');
        }

        // Salvar e atualizar
        saveData();
        generateStockReport();
        renderDashboard();
        verificarAlertasAutomaticos();
        closeDeleteQuantityModal();
    }


    // =============================================
    // SISTEMA DE ALERTAS FUNCIONAL
    // =============================================

    function inicializarSistemaAlertas() {
        // Carregar alertas do localStorage ou criar padr√£o
        const alertasSalvos = localStorage.getItem('tc_alertas');
        if (alertasSalvos) {
            sistemaAlertas = JSON.parse(alertasSalvos);
        } else {
            sistemaAlertas = [
                { id: 'A001', tipo: 'Estoque Baixo', origem: 'Sistema', mensagem: 'O estoque de Pneus Novos est√° abaixo de 5 unidades.', status: 'pendente', data: '2023-11-20' },
                { id: 'A002', tipo: 'Manuten√ß√£o', origem: 'Fogo 12347 (SCANIA DEF-5678)', mensagem: 'Pneu com KM Acumulado acima do limite recomendado (40.000km). Verificar rod√≠zio/troca.', status: 'pendente', data: '2023-11-21' },
                { id: 'A003', tipo: 'Troca Programada', origem: 'Ve√≠culo V001', mensagem: 'Pr√≥xima troca programada do VOLVO FH-540 em 5.000km.', status: 'resolvido', data: '2023-11-01' }
            ];
            saveAlerts();
        }
    }

    function saveAlerts() {
        localStorage.setItem('tc_alertas', JSON.stringify(sistemaAlertas));
    }
    
    function verificarAlertasAutomaticos() {
        let novosAlertas = 0;
        
        // 1. Alerta de Estoque Baixo (Exemplo: < 5 pneus novos)
        const estoqueNovo = reportData.items.filter(item => item.status === 'Novo').reduce((sum, item) => sum + item.qty, 0);
        const alertaEstoqueExiste = sistemaAlertas.some(a => a.tipo === 'Estoque Baixo' && a.status === 'pendente');
        
        if (estoqueNovo < 5 && !alertaEstoqueExiste) {
            const newAlerta = {
                id: `A${(sistemaAlertas.length + 1).toString().padStart(3, '0')}`,
                tipo: 'Estoque Baixo',
                origem: 'Sistema',
                mensagem: `O estoque de Pneus Novos est√° perigosamente baixo (${estoqueNovo} unidades).`,
                status: 'pendente',
                data: new Date().toISOString().substring(0, 10)
            };
            sistemaAlertas.push(newAlerta);
            novosAlertas++;
        } else if (estoqueNovo >= 5 && alertaEstoqueExiste) {
            // Se o estoque normalizou, resolve o alerta
            sistemaAlertas.filter(a => a.tipo === 'Estoque Baixo' && a.status === 'pendente').forEach(a => a.status = 'resolvido');
            showNotification('Alerta de Estoque Baixo resolvido (estoque normalizado).', 'success');
        }

        // 2. Alerta de KM Acumulado (Exemplo: > 40.000km em qualquer fogo)
        reportData.fogos.forEach(fogo => {
            if (fogo.kmAcumulado >= 40000 && fogo.veiculo) {
                const alertaKmExiste = sistemaAlertas.some(a => a.origem === `Fogo ${fogo.numero} (${fogo.veiculo})` && a.status === 'pendente');
                if (!alertaKmExiste) {
                    const veiculo = reportData.veiculos.find(v => v.id === fogo.veiculo);
                    const newAlerta = {
                        id: `A${(sistemaAlertas.length + novosAlertas + 1).toString().padStart(3, '0')}`,
                        tipo: 'KM Excedido',
                        origem: `Fogo ${fogo.numero} (${veiculo ? veiculo.placa : 'N/A'})`,
                        mensagem: `Pneu fogo ${fogo.numero} com ${fogo.kmAcumulado}km acumulado. Sugerida inspe√ß√£o/rod√≠zio/troca.`,
                        status: 'pendente',
                        data: new Date().toISOString().substring(0, 10)
                    };
                    sistemaAlertas.push(newAlerta);
                    novosAlertas++;
                }
            }
        });
        
        saveAlerts();
        
        if (novosAlertas > 0) {
            showNotification(`Foram gerados ${novosAlertas} novos alertas autom√°ticos!`, 'danger');
        }
        
        renderAlertsList(); // Atualiza a lista na aba Alertas
    }

    function renderAlertsList() {
        const body = document.getElementById('alertasTableBody');
        const filter = document.getElementById('alertaFilter').value;
        const metricPendentes = document.getElementById('alertasPendentesMetric');
        const metricResolvidos = document.getElementById('alertasResolvidosMetric');
        
        body.innerHTML = '';
        
        const filteredAlerts = sistemaAlertas.filter(a => filter === 'todos' || a.status === filter).sort((a, b) => new Date(b.data) - new Date(a.data));
        
        const pendentesCount = sistemaAlertas.filter(a => a.status === 'pendente').length;
        const resolvidosCount = sistemaAlertas.filter(a => a.status === 'resolvido' && new Date(a.data) > new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)).length; // √öltimos 30 dias

        metricPendentes.textContent = pendentesCount;
        metricResolvidos.textContent = resolvidosCount;


        if (filteredAlerts.length === 0) {
            body.innerHTML = `<tr><td colspan="6" style="text-align: center; color: var(--muted);">Nenhum alerta encontrado com o filtro selecionado.</td></tr>`;
            return;
        }

        filteredAlerts.forEach(alerta => {
            const statusClass = alerta.status === 'pendente' ? 'status-alta' : 'status-baixa';
            const statusLabel = alerta.status === 'pendente' ? 'Pendente' : 'Resolvido';
            
            const row = body.insertRow();
            row.innerHTML = `
                <td>${alerta.id}</td>
                <td>${alerta.tipo}</td>
                <td>${alerta.origem}</td>
                <td>${alerta.mensagem}</td>
                <td>${new Date(alerta.data).toLocaleDateString('pt-BR')}</td>
                <td>
                    <div class="action-buttons">
                        ${alerta.status === 'pendente' ? 
                            `<button class="btn-xs btn-success" onclick="marcarAlertaResolvido('${alerta.id}')">Resolver</button>` :
                            `<span class="status-badge ${statusClass}">${statusLabel}</span>`
                        }
                        <button class="btn-xs btn-danger" onclick="deleteAlerta('${alerta.id}')">Excluir</button>
                    </div>
                </td>
            `;
        });
    }

    function openAddAlertaModal() {
        document.getElementById('addAlertaModal').style.display = 'flex';
    }

    function closeAddAlertaModal() {
        document.getElementById('addAlertaModal').style.display = 'none';
        // Limpar campos
        document.getElementById('alertaTipo').value = 'Manuten√ß√£o Urgente';
        document.getElementById('alertaMensagem').value = '';
        document.getElementById('alertaOrigem').value = '';
    }

    function confirmAddAlerta() {
        const tipo = document.getElementById('alertaTipo').value;
        const mensagem = document.getElementById('alertaMensagem').value;
        const origem = document.getElementById('alertaOrigem').value;

        if (!mensagem) {
            showNotification('A mensagem do alerta √© obrigat√≥ria.', 'error');
            return;
        }
        
        // Gerar ID
        const newId = `A${(sistemaAlertas.length + 1).toString().padStart(3, '0')}`;

        const newAlerta = {
            id: newId,
            tipo: tipo,
            origem: origem || 'Manual',
            mensagem: mensagem,
            status: 'pendente',
            data: new Date().toISOString().substring(0, 10)
        };
        
        sistemaAlertas.push(newAlerta);
        saveAlerts();
        showNotification(`Alerta ${newId} criado com sucesso!`, 'danger');
        closeAddAlertaModal();
        renderAlertsList();
        renderDashboard(); // Atualiza a m√©trica no dashboard
    }

    function marcarAlertaResolvido(alertaId) {
        const alerta = sistemaAlertas.find(a => a.id === alertaId);
        if (alerta) {
            alerta.status = 'resolvido';
            saveAlerts();
            showNotification(`Alerta ${alertaId} resolvido.`, 'success');
            renderAlertsList();
            renderDashboard();
        }
    }

    function deleteAlerta(alertaId) {
        if (confirm(`Tem certeza que deseja excluir o alerta ${alertaId}?`)) {
            sistemaAlertas = sistemaAlertas.filter(a => a.id !== alertaId);
            saveAlerts();
            showNotification(`Alerta ${alertaId} exclu√≠do.`, 'success');
            renderAlertsList();
            renderDashboard();
        }
    }

    // =============================================
    // GEST√ÉO DE FOGOS
    // =============================================

    function renderFogosList() {
        loadData(); // Garante dados atualizados
        sincronizarFogosComVeiculos(); // Garante sincronia entre fogos e ve√≠culos

        const container = document.getElementById('fogosList');
        const countElement = document.getElementById('fogosCount');
        const totalMetric = document.getElementById('totalFogosMetric');
        const emVeiculosMetric = document.getElementById('emVeiculosMetric');
        const emEstoqueMetric = document.getElementById('emEstoqueMetric');

        container.innerHTML = '';

        // Atualizar m√©tricas
        const totalFogos = reportData.fogos.length;
        const emVeiculos = reportData.fogos.filter(f => f.veiculo !== null).length;
        const emEstoque = totalFogos - emVeiculos;

        countElement.textContent = totalFogos;
        totalMetric.textContent = totalFogos;
        emVeiculosMetric.textContent = emVeiculos;
        emEstoqueMetric.textContent = emEstoque;

        if (totalFogos === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üî•</div>
                    <p>Nenhum pneu com fogo (serial) cadastrado.</p>
                </div>
            `;
            return;
        }

        reportData.fogos.sort((a, b) => a.numero.localeCompare(b.numero)).forEach(fogo => {
            const pneuOriginal = reportData.items.find(p => p.id === fogo.pneuId);
            const veiculo = fogo.veiculo ? reportData.veiculos.find(v => v.id === fogo.veiculo) : null;
            const posicao = fogo.posicao ? fogo.posicao.toUpperCase().replace('-', ' ') : 'ESTOQUE FOGO';
            const statusClass = fogo.veiculo ? 'status-media' : 'status-novo';
            const veiculoInfo = veiculo ? `${veiculo.placa} (${veiculo.modelo})` : 'N/A';
            const pneuInfo = pneuOriginal ? `${pneuOriginal.medida} / ${pneuOriginal.marca} (${pneuOriginal.status})` : 'Pneu original exclu√≠do';

            const itemDiv = document.createElement('div');
            itemDiv.className = 'fogo-item';
            itemDiv.innerHTML = `
                <div class="fogo-info">
                    <div class="fogo-number">Fogo ${fogo.numero} <span class="status-badge ${statusClass}">${posicao}</span></div>
                    <div class="fogo-details">
                        Pneu Base: ${pneuInfo}
                    </div>
                    <div class="fogo-details">
                        KM Acumulado: <span style="font-weight: bold; color: var(--accent);">${fogo.kmAcumulado.toLocaleString('pt-BR')} KM</span>
                    </div>
                    <div class="fogo-details">
                        Ve√≠culo: ${veiculoInfo}
                    </div>
                </div>
                <div class="fogo-actions">
                    <button class="btn-xs" onclick="openEditFogoModal('${fogo.numero}')">Editar</button>
                    <button class="btn-xs btn-danger" onclick="deleteFogo('${fogo.numero}')">Excluir</button>
                </div>
            `;
            container.appendChild(itemDiv);
        });
    }

    function updateFogoPreview() {
        const pneuId = document.getElementById('fogoPneuId').value;
        const preview = document.getElementById('fogoPreview');
        const pneu = reportData.items.find(p => p.id === pneuId);

        if (pneu) {
            preview.innerHTML = `
                <p><strong>ID Item:</strong> ${pneu.id}</p>
                <p><strong>Detalhes:</strong> ${pneu.medida} / ${pneu.marca} / ${pneu.modelo}</p>
                <p><strong>Status:</strong> <span class="status-badge status-${pneu.status.toLowerCase()}">${pneu.status}</span></p>
                <p><strong>Valor Unit:</strong> R$ ${pneu.preco.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                <p style="margin-top: 10px; color: var(--warn);">* OBS: Ao gerar o fogo, 1 unidade do estoque ser√° removida.</p>
            `;
        } else {
            preview.innerHTML = `<p style="color: var(--muted);">Pr√©via do Pneu: Selecione um item de estoque para ver os detalhes.</p>`;
        }
    }

    function openAddFogoModal(pneuId = null, qty = 1) {
        const select = document.getElementById('fogoPneuId');
        select.innerHTML = '<option value="">Selecione um item...</option>';
        
        // Popular o select apenas com pneus que podem se tornar fogo (Novo e Reformado)
        reportData.items.filter(p => p.status === 'Novo' || p.status === 'Reformado').forEach(pneu => {
            select.innerHTML += `<option value="${pneu.id}">[${pneu.id}] ${pneu.medida} - ${pneu.marca} (QTD: ${pneu.qty})</option>`;
        });
        
        // Preselecionar se o ID foi passado
        if (pneuId) {
            select.value = pneuId;
            document.getElementById('fogoQuantidade').value = qty;
        }

        updateFogoPreview();
        document.getElementById('fogoNumero').value = '';
        document.getElementById('fogoObservacoes').value = '';
        document.getElementById('addFogoModal').style.display = 'flex';
    }

    function closeAddFogoModal() {
        document.getElementById('addFogoModal').style.display = 'none';
    }

    function confirmAddFogo() {
        let numeroBase = document.getElementById('fogoNumero').value.trim();
        const pneuId = document.getElementById('fogoPneuId').value;
        const quantidade = parseInt(document.getElementById('fogoQuantidade').value);
        const observacoes = document.getElementById('fogoObservacoes').value;
        
        if (!numeroBase || !pneuId || quantidade < 1) {
            showNotification('Preencha o n√∫mero do Fogo e selecione um item de estoque.', 'error');
            return;
        }

        const pneu = reportData.items.find(p => p.id === pneuId);
        if (!pneu) {
            showNotification('Item de estoque n√£o encontrado.', 'error');
            return;
        }
        
        if (quantidade > pneu.qty) {
            showNotification(`N√£o h√° ${quantidade} unidades do item ${pneu.id} em estoque. Dispon√≠vel: ${pneu.qty}.`, 'error');
            return;
        }
        
        const novosFogos = [];
        let numBase = parseInt(numeroBase);

        for (let i = 0; i < quantidade; i++) {
            let newNumero = (numBase + i).toString().padStart(numeroBase.length, '0');
            
            // Verificar se o Fogo j√° existe
            if (reportData.fogos.some(f => f.numero === newNumero)) {
                showNotification(`O n√∫mero de fogo ${newNumero} j√° existe. Tente outro serial inicial.`, 'error');
                return;
            }

            // Gerar o novo objeto Fogo
            novosFogos.push({
                numero: newNumero,
                pneuId: pneuId,
                dataCadastro: new Date().toISOString().substring(0, 10),
                kmAcumulado: 0,
                veiculo: null,
                posicao: null,
                observacoes: observacoes
            });
        }
        
        // 1. Adicionar os novos fogos
        reportData.fogos.push(...novosFogos);
        
        // 2. Remover a quantidade do estoque
        pneu.qty -= quantidade;
        
        // 3. Remover o item do estoque se a quantidade for 0
        if (pneu.qty <= 0) {
            reportData.items = reportData.items.filter(item => item.id !== pneuId);
        }

        showNotification(`${quantidade} Fogo(s) gerado(s) com sucesso, a partir do serial ${novosFogos[0].numero}!`, 'success');
        closeAddFogoModal();
        saveData();
        renderFogosList();
        generateStockReport();
        renderDashboard();
    }

    function openEditFogoModal(fogoNumero) {
        fogoEditando = reportData.fogos.find(f => f.numero === fogoNumero);
        if (!fogoEditando) return;
        
        const pneu = reportData.items.find(p => p.id === fogoEditando.pneuId);
        const veiculo = fogoEditando.veiculo ? reportData.veiculos.find(v => v.id === fogoEditando.veiculo) : null;
        
        document.getElementById('editFogoNumeroTitle').textContent = fogoEditando.numero;
        document.getElementById('editFogoMedida').value = pneu ? pneu.medida : 'N/A';
        document.getElementById('editFogoKMAcumulado').value = fogoEditando.kmAcumulado;
        document.getElementById('editFogoObservacoes').value = fogoEditando.observacoes || '';

        // Campos de Ve√≠culo e Posi√ß√£o (apenas para visualiza√ß√£o/leitura)
        const veiculoSelect = document.getElementById('editFogoVeiculo');
        veiculoSelect.innerHTML = `<option value="">Nenhum</option>`;
        if (veiculo) {
            veiculoSelect.innerHTML += `<option value="${veiculo.id}" selected>${veiculo.placa} (${veiculo.modelo})</option>`;
        }
        
        const posicaoSelect = document.getElementById('editFogoPosicao');
        posicaoSelect.innerHTML = `<option value="">Em Estoque Fogo</option>`;
        if (fogoEditando.posicao) {
            posicaoSelect.innerHTML += `<option value="${fogoEditando.posicao}" selected>${fogoEditando.posicao.toUpperCase().replace('-', ' ')}</option>`;
        }

        document.getElementById('editFogoModal').style.display = 'flex';
    }

    function closeEditFogoModal() {
        document.getElementById('editFogoModal').style.display = 'none';
        fogoEditando = null;
    }

    function confirmEditFogo() {
        if (!fogoEditando) return;
        
        const novoKm = parseInt(document.getElementById('editFogoKMAcumulado').value);
        const novasObs = document.getElementById('editFogoObservacoes').value;
        
        if (isNaN(novoKm) || novoKm < 0) {
            showNotification('KM Acumulado inv√°lido.', 'error');
            return;
        }
        
        fogoEditando.kmAcumulado = novoKm;
        fogoEditando.observacoes = novasObs;
        
        showNotification(`Fogo ${fogoEditando.numero} atualizado com sucesso!`, 'success');
        closeEditFogoModal();
        saveData();
        renderFogosList();
        verificarAlertasAutomaticos();
    }

    function deleteFogo(fogoNumero) {
        if (confirm(`Tem certeza que deseja EXCLUIR o Fogo ${fogoNumero}? Isso ir√° remover o registro, mas o pneu base (se houver) n√£o ser√° afetado.`)) {
            const fogo = reportData.fogos.find(f => f.numero === fogoNumero);
            if (!fogo) return;

            // 1. Remover do ve√≠culo se estiver montado
            if (fogo.veiculo) {
                const veiculo = reportData.veiculos.find(v => v.id === fogo.veiculo);
                if (veiculo) {
                    const [eixoKey, lado] = fogo.posicao.split('-');
                    if (eixoKey === 'estepe') {
                        veiculo.eixos.estepe = null;
                    } else if (veiculo.eixos[eixoKey]) {
                        veiculo.eixos[eixoKey][lado] = null;
                    }
                }
            }

            // 2. Remover da lista de fogos
            reportData.fogos = reportData.fogos.filter(f => f.numero !== fogoNumero);
            
            showNotification(`Fogo ${fogoNumero} exclu√≠do com sucesso!`, 'success');
            saveData();
            renderFogosList();
            renderDashboard();
            inicializarSistemaMovimentacao();
            verificarAlertasAutomaticos();
        }
    }
    
    // =============================================
    // PERFORMANCE
    // =============================================
    
    function generatePerformanceReport() {
        console.log('Gerando relat√≥rio de performance...');
        const veiculoFilter = document.getElementById('veiculoFilter').value;
        const periodoFilter = parseInt(document.getElementById('periodoFilter').value);
        
        // Filtra os dados de performance (simulados) com base nos filtros
        let filteredPerformance = reportData.performance;
        if (veiculoFilter) {
            filteredPerformance = filteredPerformance.filter(p => p.veiculo === veiculoFilter);
        }
        
        // Simula√ß√£o de filtros por per√≠odo (n√£o implementada para os dados simulados)
        // Se fosse real, voc√™ filtraria as movimenta√ß√µes e recalcularia as m√©tricas.

        // 1. M√©tricas de Performance (simuladas)
        const totalKm = filteredPerformance.reduce((sum, p) => sum + p.kmTotal, 0);
        const totalPneusTrocados = filteredPerformance.reduce((sum, p) => sum + p.pneusTrocados, 0);
        const totalCusto = filteredPerformance.reduce((sum, p) => sum + p.custoTotal, 0);
        const custoKmGeral = totalKm > 0 ? totalCusto / totalKm : 0;

        const metricsContainer = document.getElementById('performanceMetrics');
        if (metricsContainer) {
            metricsContainer.innerHTML = `
                <div class="metric-card" style="--accent: var(--purple);">
                    <div class="metric-value">${totalKm.toLocaleString('pt-BR')} KM</div>
                    <div class="metric-label">KM Total Rodado</div>
                    <div class="metric-change positive">No Per√≠odo Selecionado</div>
                </div>
                <div class="metric-card" style="--accent: var(--success);">
                    <div class="metric-value">${totalPneusTrocados}</div>
                    <div class="metric-label">Pneus Trocados</div>
                    <div class="metric-change positive">Total de trocas</div>
                </div>
                <div class="metric-card" style="--accent: var(--warn);">
                    <div class="metric-value">R$ ${custoKmGeral.toLocaleString('pt-BR', {minimumFractionDigits: 4})}</div>
                    <div class="metric-label">Custo/KM Geral</div>
                    <div class="metric-change negative">Objetivo: Reduzir</div>
                </div>
                <div class="metric-card" style="--accent: var(--accent);">
                    <div class="metric-value">${filteredPerformance.length > 0 ? (filteredPerformance.reduce((sum, p) => sum + p.durabilidadeMedia, 0) / filteredPerformance.length).toLocaleString('pt-BR', {maximumFractionDigits: 0}) : 0} KM</div>
                    <div class="metric-label">M√©dia Durabilidade</div>
                    <div class="metric-change positive">Vida √∫til dos pneus</div>
                </div>
            `;
        }
        
        // 2. Tabela Detalhada
        const tableBody = document.getElementById('performanceTableBody');
        tableBody.innerHTML = '';
        
        if (filteredPerformance.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: var(--muted);">Nenhum dado de performance encontrado para o filtro.</td></tr>`;
        } else {
            filteredPerformance.forEach(p => {
                const custoKm = p.kmTotal > 0 ? p.custoTotal / p.kmTotal : 0;
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td style="font-weight: bold;">${p.veiculo}</td>
                    <td>${p.kmTotal.toLocaleString('pt-BR')}</td>
                    <td>${p.pneusTrocados}</td>
                    <td>R$ ${p.custoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td>R$ ${custoKm.toLocaleString('pt-BR', {minimumFractionDigits: 4})}</td>
                    <td>${p.durabilidadeMedia.toLocaleString('pt-BR')}</td>
                `;
            });
        }
        
        // 3. Gr√°ficos (Simulados)
        renderPerformanceCharts(filteredPerformance.map(p => p.veiculo));
    }

    function renderPerformanceCharts(veiculos) {
        // Op√ß√µes de gr√°fico padr√£o
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: 'var(--muted)',
                        font: { family: "'Segoe UI', system-ui, sans-serif" }
                    }
                },
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: 'var(--muted)' },
                    grid: { color: 'rgba(148, 163, 184, 0.1)', drawBorder: false }
                },
                x: {
                    ticks: { color: 'var(--muted)' },
                    grid: { display: false }
                }
            }
        };

        // Gr√°fico de Custo por KM
        const custoKmCtx = document.getElementById('custoKmChart').getContext('2d');
        if (custoKmChart) custoKmChart.destroy();

        custoKmChart = new Chart(custoKmCtx, {
            type: 'bar',
            data: {
                labels: veiculos.length > 0 ? veiculos : ['VOLVO FH-540', 'SCANIA R450', 'MERCEDES AXOR'],
                datasets: [{
                    label: 'Custo/KM (R$)',
                    data: veiculos.length > 0 ? reportData.performance.filter(p => veiculos.includes(p.veiculo)).map(p => p.kmTotal > 0 ? p.custoTotal / p.kmTotal : 0) : [0.20, 0.18, 0.15],
                    backgroundColor: '#38bdf8',
                    borderColor: '#0ea5e9',
                    borderWidth: 0
                }]
            },
            options: chartOptions
        });

        // Gr√°fico de Durabilidade
        const durabilidadeCtx = document.getElementById('durabilidadeChart').getContext('2d');
        if (durabilidadeChart) durabilidadeChart.destroy();

        durabilidadeChart = new Chart(durabilidadeCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                datasets: [
                    {
                        label: 'VOLVO FH-540',
                        data: [65000, 62000, 58000, 61000, 59000, 63000],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'SCANIA R450',
                        data: [58000, 56000, 54000, 52000, 55000, 57000],
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: chartOptions
        });
    }

    // =============================================
    // SISTEMA DE MOVIMENTA√á√ÉO DE PNEUS
    // =============================================

    function inicializarSistemaMovimentacao() {
        loadData();
        sincronizarFogosComVeiculos();
        carregarPneusDisponiveis();
        renderizarListaVeiculos();
        
        // Resetar montagem tempor√°ria se n√£o estiver em modo montagem
        if (!modoMontagem) {
            montagemTemporaria = { dataInicio: null, posicoesOcupadas: {}, pneusMontados: [] };
            document.getElementById('btnIniciarMontagem').style.display = 'inline-block';
            document.getElementById('btnFinalizarMontagem').style.display = 'none';
            document.getElementById('montagemInfo').style.display = 'none';
        } else {
            // Se j√° estava em modo montagem, garantir que o estado seja restaurado
            renderizarPneusDisponiveis();
            atualizarStatusMontagem();
            adicionarEventosRemocao();
        }

        // Se um ve√≠culo estava selecionado, re-renderizar o diagrama
        if (veiculoSelecionado) {
            veiculoSelecionado = reportData.veiculos.find(v => v.id === veiculoSelecionado.id);
            if (veiculoSelecionado) {
                renderizarDiagramaVeiculo();
            } else {
                 // Ve√≠culo exclu√≠do
                veiculoSelecionado = null;
                document.getElementById('currentVehicle').textContent = 'Selecione um Ve√≠culo';
                document.getElementById('vehicleDetails').textContent = 'Detalhes';
            }
        }
        
        // Configurar drag and drop
        adicionarEventosDragAndDrop();
    }

    function salvarPosicoesVeiculos() {
        localStorage.setItem('tc_veiculos_data', JSON.stringify(reportData.veiculos));
    }

    function renderizarListaVeiculos() {
        const container = document.getElementById('vehiclesList');
        const count = document.getElementById('veiculosCount');
        container.innerHTML = '';
        
        count.textContent = `${reportData.veiculos.length} Ve√≠culos`;

        if (reportData.veiculos.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üöö</div>
                    <p>Nenhum ve√≠culo cadastrado.</p>
                    <button onclick="openAddVeiculoModal()" class="btn-xs btn-success" style="margin-top: 10px;">Adicionar</button>
                </div>
            `;
            // Limpar visualiza√ß√£o
            veiculoSelecionado = null;
            renderizarDiagramaVeiculo();
            return;
        }

        reportData.veiculos.forEach(veiculo => {
            const isActive = veiculoSelecionado && veiculo.id === veiculoSelecionado.id;
            const div = document.createElement('div');
            div.className = `vehicle-item ${isActive ? 'active' : ''}`;
            div.onclick = () => selecionarVeiculo(veiculo);
            div.innerHTML = `
                <div class="vehicle-plate">${veiculo.placa}</div>
                <div class="vehicle-model">${veiculo.modelo} (${veiculo.configuracao.toUpperCase()})</div>
            `;
            container.appendChild(div);
            
            // Selecionar o primeiro ve√≠culo por padr√£o se nenhum estiver selecionado
            if (!veiculoSelecionado && veiculo.id === reportData.veiculos[0].id) {
                selecionarVeiculo(veiculo);
            }
        });
    }

    function carregarPneusDisponiveis() {
        // Pegar todos os fogos ativos que n√£o est√£o em ve√≠culos
        pneusDisponiveis = reportData.fogos.filter(fogo => !fogo.veiculo);
    }

    function selecionarVeiculo(veiculo) {
        veiculoSelecionado = veiculo;
        renderizarListaVeiculos();
        renderizarDiagramaVeiculo();
        
        // Resetar a montagem tempor√°ria ao trocar de ve√≠culo
        montagemTemporaria = { dataInicio: null, posicoesOcupadas: {}, pneusMontados: [] };
        
        // Preencher posi√ß√µes iniciais se n√£o estiver em modo montagem
        if (!modoMontagem) {
            Object.keys(veiculo.eixos).forEach(eixoKey => {
                const eixo = veiculo.eixos[eixoKey];
                if (eixo && typeof eixo === 'object') {
                    if (eixo.esquerda) {
                        colocarPneuNaMontagem(`${eixoKey}-esquerda`, eixo.esquerda, false);
                    }
                    if (eixo.direita) {
                        colocarPneuNaMontagem(`${eixoKey}-direita`, eixo.direita, false);
                    }
                } else if (eixo) {
                    // Estepe
                    colocarPneuNaMontagem(eixoKey, eixo, false);
                }
            });
        }
        
        // Atualizar informa√ß√µes do ve√≠culo
        document.getElementById('currentVehicle').textContent = `${veiculo.placa} - ${veiculo.modelo}`;
        document.getElementById('vehicleDetails').textContent = `${veiculo.tipo === 'cavalo' ? 'Cavalo Mec√¢nico' : 'Carreta'} ‚Ä¢ ${veiculo.configuracao}`;
        
        // Renderizar pneus dispon√≠veis (que podem ter mudado se o ve√≠culo anterior foi deselecionado)
        carregarPneusDisponiveis();
        renderizarPneusDisponiveis();

        // Atualizar status da montagem
        atualizarStatusMontagem();
    }

    function renderizarDiagramaVeiculo() {
        const container = document.getElementById('truckDiagram');
        container.innerHTML = '';
        
        if (!veiculoSelecionado) {
            container.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--muted);">
                    Selecione um ve√≠culo para visualizar
                </div>
            `;
            return;
        }

        const truckContainer = document.createElement('div');
        truckContainer.style.position = 'relative';
        truckContainer.style.width = '100%';
        truckContainer.style.height = '100%';
        truckContainer.style.background = 'rgba(30, 41, 59, 0.3)';
        truckContainer.style.borderRadius = 'var(--radius)';
        truckContainer.style.border = '2px solid rgba(148, 163, 184, 0.2)';
        
        if (veiculoSelecionado.tipo === 'cavalo') {
            criarDiagramaCavalo(truckContainer);
        } else {
            criarDiagramaCarreta(truckContainer);
        }
        
        container.appendChild(truckContainer);
        adicionarEventosDrop();
        adicionarEventosRemocao();
    }

    function criarDiagramaCavalo(truckContainer) {
        // Cabine
        const cabin = document.createElement('div');
        cabin.style.position = 'absolute';
        cabin.style.left = '5%';
        cabin.style.top = '20%';
        cabin.style.width = '20%';
        cabin.style.height = '30%';
        cabin.style.background = '#4a5568';
        cabin.style.borderRadius = '10px 0 0 10px';
        truckContainer.appendChild(cabin);

        // Chassis
        const chassis = document.createElement('div');
        chassis.style.position = 'absolute';
        chassis.style.left = '25%';
        chassis.style.top = '30%';
        chassis.style.width = '70%';
        chassis.style.height = '15%';
        chassis.style.background = '#2d3748';
        chassis.style.borderRadius = '5px';
        truckContainer.appendChild(chassis);

        // Configura√ß√µes de eixos para Cavalo (6x2, 6x4, 4x2)
        const eixosConfig = [];
        
        // Eixo Dianteiro (Direcional)
        eixosConfig.push({ id: 'dianteiro', nome: 'EIXO DIANTEIRO', tipo: 'direcional', left: '35%', top: '35%', tracao: false });

        // Eixo(s) Traseiro(s)
        if (veiculoSelecionado.configuracao === '4x2') {
            // 4x2 tem apenas um eixo traseiro (tra√ß√£o)
            eixosConfig.push({ id: 'traseiro1', nome: 'EIXO TRASEIRO', tipo: 'tracao', left: '65%', top: '35%', tracao: true });
        } else if (veiculoSelecionado.configuracao === '6x2' || veiculoSelecionado.configuracao === '6x4') {
            // 6x2 e 6x4 t√™m dois eixos traseiros
            const eixo1 = veiculoSelecionado.eixos.traseiro1;
            const eixo2 = veiculoSelecionado.eixos.traseiro2;
            
            // Eixo Traseiro 1
            eixosConfig.push({ 
                id: 'traseiro1', 
                nome: 'EIXO 1', 
                tipo: eixo1.tipo, 
                left: '55%', 
                top: '35%', 
                tracao: eixo1.tipo === 'tracao' 
            });
            
            // Eixo Traseiro 2
            eixosConfig.push({ 
                id: 'traseiro2', 
                nome: 'EIXO 2', 
                tipo: eixo2.tipo, 
                left: '75%', 
                top: '35%', 
                tracao: eixo2.tipo === 'tracao' 
            });
        }
        
        // Estepe (em posi√ß√£o isolada)
        eixosConfig.push({ id: 'estepe', nome: 'ESTEPE', tipo: 'estepe', left: '10%', top: '75%', tracao: false });


        // Renderizar Eixos
        eixosConfig.forEach(eixo => {
            const axleDiv = document.createElement('div');
            axleDiv.className = `axle axle-${eixo.id}`;
            axleDiv.style.position = 'absolute';
            axleDiv.style.left = eixo.left;
            axleDiv.style.top = eixo.top;
            axleDiv.dataset.eixo = eixo.id;
            
            // Estilos visuais do eixo
            const isEstepe = eixo.id === 'estepe';
            const isTracao = eixo.tracao;
            const isDirecional = eixo.tipo === 'direcional';
            
            let bgColor = 'rgba(74, 85, 104, 0.7)';
            if (isTracao) bgColor = 'rgba(22, 163, 74, 0.3)'; // Verde
            else if (isDirecional) bgColor = 'rgba(29, 78, 216, 0.3)'; // Azul
            
            axleDiv.style.width = isEstepe ? '60px' : '80px';
            axleDiv.style.height = isEstepe ? '60px' : '30px';
            axleDiv.style.background = bgColor;
            axleDiv.style.border = `2px solid ${isTracao ? '#16a34a' : isDirecional ? '#1d4ed8' : '#4b5563'}`;
            axleDiv.style.borderRadius = isEstepe ? '50%' : '8px';
            axleDiv.style.padding = '8px';
            axleDiv.style.display = 'flex';
            axleDiv.style.gap = '15px';
            axleDiv.style.alignItems = 'center';
            axleDiv.style.justifyContent = 'center';
            axleDiv.style.cursor = 'pointer';
            axleDiv.style.transition = 'all 0.3s ease';

            // Adicionar indicador de posi√ß√£o
            const indicator = document.createElement('div');
            indicator.className = 'position-indicator';
            indicator.style.position = 'absolute';
            indicator.style.top = isEstepe ? '-35px' : '-30px';
            indicator.style.left = '50%';
            indicator.style.transform = 'translateX(-50%)';
            indicator.style.background = isTracao ? '#16a34a' : isDirecional ? '#1d4ed8' : '#6b7280';
            indicator.style.color = 'white';
            indicator.style.padding = '4px 8px';
            indicator.style.borderRadius = '4px';
            indicator.style.fontSize = '0.7rem';
            indicator.style.fontWeight = 'bold';
            indicator.style.whiteSpace = 'nowrap';
            indicator.textContent = `${eixo.nome}${isTracao ? ' (TRACAO)' : ''}`;
            axleDiv.appendChild(indicator);

            // Slots de Pneu
            if (eixo.id === 'estepe') {
                axleDiv.style.flexDirection = 'column';
                axleDiv.style.justifyContent = 'center';
                const pneuEstepe = montagemTemporaria.posicoesOcupadas[eixo.id] || veiculoSelecionado.eixos[eixo.id];
                const slot = document.createElement('div');
                slot.className = `tire-slot ${pneuEstepe ? 'filled' : ''}`;
                slot.dataset.posicao = eixo.id;
                slot.style.width = '40px';
                slot.style.height = '40px';
                slot.style.borderRadius = '50%';
                slot.style.display = 'flex';
                slot.style.alignItems = 'center';
                slot.style.justifyContent = 'center';
                slot.style.fontSize = '0.7rem';
                slot.style.fontWeight = 'bold';
                slot.textContent = pneuEstepe || 'E';
                axleDiv.appendChild(slot);
            } else {
                const pneuEsquerda = montagemTemporaria.posicoesOcupadas[`${eixo.id}-esquerda`] || veiculoSelecionado.eixos[eixo.id].esquerda;
                const pneuDireita = montagemTemporaria.posicoesOcupadas[`${eixo.id}-direita`] || veiculoSelecionado.eixos[eixo.id].direita;

                const leftSlot = document.createElement('div');
                leftSlot.className = `tire-slot ${pneuEsquerda ? 'filled' : ''}`;
                leftSlot.dataset.posicao = `${eixo.id}-esquerda`;
                leftSlot.style.width = '20px';
                leftSlot.style.height = '20px';
                leftSlot.style.borderRadius = '50%';
                leftSlot.style.display = 'flex';
                leftSlot.style.alignItems = 'center';
                leftSlot.style.justifyContent = 'center';
                leftSlot.style.fontSize = '0.7rem';
                leftSlot.style.fontWeight = 'bold';
                leftSlot.textContent = pneuEsquerda || 'E';

                const rightSlot = document.createElement('div');
                rightSlot.className = `tire-slot ${pneuDireita ? 'filled' : ''}`;
                rightSlot.dataset.posicao = `${eixo.id}-direita`;
                rightSlot.style.width = '20px';
                rightSlot.style.height = '20px';
                rightSlot.style.borderRadius = '50%';
                rightSlot.style.display = 'flex';
                rightSlot.style.alignItems = 'center';
                rightSlot.style.justifyContent = 'center';
                rightSlot.style.fontSize = '0.7rem';
                rightSlot.style.fontWeight = 'bold';
                rightSlot.textContent = pneuDireita || 'D';
                
                axleDiv.appendChild(leftSlot);
                axleDiv.appendChild(rightSlot);
            }
            
            truckContainer.appendChild(axleDiv);
        });
    }

    function criarDiagramaCarreta(truckContainer) {
        // Chassis da carreta
        const chassis = document.createElement('div');
        chassis.style.position = 'absolute';
        chassis.style.left = '5%';
        chassis.style.top = '30%';
        chassis.style.width = '90%';
        chassis.style.height = '25%';
        chassis.style.background = '#374151';
        chassis.style.borderRadius = '8px';
        chassis.style.border = '2px solid #1f2937';
        truckContainer.appendChild(chassis);
        
        // Eixos para carreta (simula√ß√£o de 3 eixos fixos)
        const eixosConfig = [
            { id: 'traseiro1', nome: 'EIXO 1', tipo: 'fixo', left: '25%', top: '55%', tracao: false },
            { id: 'traseiro2', nome: 'EIXO 2', tipo: 'fixo', left: '50%', top: '55%', tracao: false },
            { id: 'traseiro3', nome: 'EIXO 3', tipo: 'fixo', left: '75%', top: '55%', tracao: false },
            { id: 'estepe', nome: 'ESTEPE', tipo: 'estepe', left: '10%', top: '75%', tracao: false }
        ];

        eixosConfig.forEach(eixo => {
            const axleDiv = document.createElement('div');
            axleDiv.className = `axle axle-${eixo.id}`;
            axleDiv.style.position = 'absolute';
            axleDiv.style.left = eixo.left;
            axleDiv.style.top = eixo.top;
            axleDiv.dataset.eixo = eixo.id;
            
            // Estilos visuais do eixo
            const isEstepe = eixo.id === 'estepe';
            
            let bgColor = 'rgba(74, 85, 104, 0.7)';

            axleDiv.style.width = isEstepe ? '60px' : '80px';
            axleDiv.style.height = isEstepe ? '60px' : '30px';
            axleDiv.style.background = bgColor;
            axleDiv.style.border = `2px solid #4b5563`;
            axleDiv.style.borderRadius = isEstepe ? '50%' : '8px';
            axleDiv.style.padding = '8px';
            axleDiv.style.display = 'flex';
            axleDiv.style.gap = '15px';
            axleDiv.style.alignItems = 'center';
            axleDiv.style.justifyContent = 'center';
            axleDiv.style.cursor = 'pointer';
            axleDiv.style.transition = 'all 0.3s ease';

            // Adicionar indicador de posi√ß√£o
            const indicator = document.createElement('div');
            indicator.className = 'position-indicator';
            indicator.style.position = 'absolute';
            indicator.style.top = isEstepe ? '-35px' : '-30px';
            indicator.style.left = '50%';
            indicator.style.transform = 'translateX(-50%)';
            indicator.style.background = '#6b7280';
            indicator.style.color = 'white';
            indicator.style.padding = '4px 8px';
            indicator.style.borderRadius = '4px';
            indicator.style.fontSize = '0.7rem';
            indicator.style.fontWeight = 'bold';
            indicator.style.whiteSpace = 'nowrap';
            indicator.textContent = eixo.nome;
            axleDiv.appendChild(indicator);

            // Slots de Pneu
            if (eixo.id === 'estepe') {
                axleDiv.style.flexDirection = 'column';
                axleDiv.style.justifyContent = 'center';
                const pneuEstepe = montagemTemporaria.posicoesOcupadas[eixo.id] || veiculoSelecionado.eixos[eixo.id];
                const slot = document.createElement('div');
                slot.className = `tire-slot ${pneuEstepe ? 'filled' : ''}`;
                slot.dataset.posicao = eixo.id;
                slot.style.width = '40px';
                slot.style.height = '40px';
                slot.style.borderRadius = '50%';
                slot.style.display = 'flex';
                slot.style.alignItems = 'center';
                slot.style.justifyContent = 'center';
                slot.style.fontSize = '0.7rem';
                slot.style.fontWeight = 'bold';
                slot.textContent = pneuEstepe || 'E';
                axleDiv.appendChild(slot);
            } else {
                const pneuEsquerda = montagemTemporaria.posicoesOcupadas[`${eixo.id}-esquerda`] || veiculoSelecionado.eixos[eixo.id].esquerda;
                const pneuDireita = montagemTemporaria.posicoesOcupadas[`${eixo.id}-direita`] || veiculoSelecionado.eixos[eixo.id].direita;

                const leftSlot = document.createElement('div');
                leftSlot.className = `tire-slot ${pneuEsquerda ? 'filled' : ''}`;
                leftSlot.dataset.posicao = `${eixo.id}-esquerda`;
                leftSlot.style.width = '20px';
                leftSlot.style.height = '20px';
                leftSlot.style.borderRadius = '50%';
                leftSlot.style.display = 'flex';
                leftSlot.style.alignItems = 'center';
                leftSlot.style.justifyContent = 'center';
                leftSlot.style.fontSize = '0.7rem';
                leftSlot.style.fontWeight = 'bold';
                leftSlot.textContent = pneuEsquerda || 'E';

                const rightSlot = document.createElement('div');
                rightSlot.className = `tire-slot ${pneuDireita ? 'filled' : ''}`;
                rightSlot.dataset.posicao = `${eixo.id}-direita`;
                rightSlot.style.width = '20px';
                rightSlot.style.height = '20px';
                rightSlot.style.borderRadius = '50%';
                rightSlot.style.display = 'flex';
                rightSlot.style.alignItems = 'center';
                rightSlot.style.justifyContent = 'center';
                rightSlot.style.fontSize = '0.7rem';
                rightSlot.style.fontWeight = 'bold';
                rightSlot.textContent = pneuDireita || 'D';
                
                axleDiv.appendChild(leftSlot);
                axleDiv.appendChild(rightSlot);
            }
            
            truckContainer.appendChild(axleDiv);
        });
    }

    function renderizarPneusDisponiveis() {
        const container = document.getElementById('availableTiresList');
        container.innerHTML = '';

        if (pneusDisponiveis.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; color: var(--muted); padding: 20px;">
                    Nenhum pneu dispon√≠vel<br>
                    <small style="font-size: 0.8rem;">Cadastre fogos primeiro na aba "Fogos"</small>
                </div>
            `;
            return;
        }

        pneusDisponiveis.forEach(pneu => {
            // Verificar se o pneu j√° est√° sendo usado na montagem atual
            const estaEmUso = montagemTemporaria.pneusMontados.includes(pneu.numero);
            
            const pneuOriginal = reportData.items.find(p => p.id === pneu.pneuId);
            const pneuInfo = pneuOriginal ? `${pneuOriginal.medida} / ${pneuOriginal.marca}` : 'Pneu Base Exclu√≠do';
            
            const div = document.createElement('div');
            div.className = `tire-item ${estaEmUso ? 'em-uso' : ''}`;
            div.draggable = !estaEmUso && modoMontagem; // S√≥ pode arrastar se n√£o estiver em uso e estiver em modo montagem
            div.dataset.fogo = pneu.numero;
            
            div.innerHTML = `
                <div class="tire-number">Fogo ${pneu.numero}</div>
                <div class="tire-details">
                    ${pneuInfo}<br>
                    KM Acumulado: ${pneu.kmAcumulado.toLocaleString('pt-BR')}
                </div>
            `;
            container.appendChild(div);
        });
    }
    
    // Fun√ß√µes de Drag and Drop
    function adicionarEventosDragAndDrop() {
        const availableTiresList = document.getElementById('availableTiresList');
        
        // Drag Start
        availableTiresList.addEventListener('dragstart', (e) => {
            if (modoMontagem && e.target.classList.contains('tire-item') && !e.target.classList.contains('em-uso')) {
                e.dataTransfer.setData('text/plain', e.target.dataset.fogo);
                e.target.style.opacity = '0.4';
            }
        });
        
        // Drag End
        availableTiresList.addEventListener('dragend', (e) => {
            if (e.target.classList.contains('tire-item')) {
                e.target.style.opacity = '1';
            }
        });

        // Eventos Drop
        adicionarEventosDrop();
    }

    function adicionarEventosDrop() {
        // Limpar eventos drop anteriores
        document.querySelectorAll('.tire-slot').forEach(slot => {
            slot.removeEventListener('dragover', dragOver);
            slot.removeEventListener('drop', dropHandler);
        });
        
        document.querySelectorAll('.tire-slot').forEach(slot => {
            slot.addEventListener('dragover', dragOver);
            slot.addEventListener('drop', dropHandler);
        });
    }

    function dragOver(e) {
        if (!modoMontagem) return;
        e.preventDefault();
        e.currentTarget.style.border = '2px dashed var(--warn)';
    }

    function dragLeave(e) {
        if (!modoMontagem) return;
        e.currentTarget.style.border = '2px solid transparent';
    }

    function dropHandler(e) {
        if (!modoMontagem) return;
        e.preventDefault();
        e.currentTarget.style.border = '2px solid transparent';

        const numeroFogo = e.dataTransfer.getData('text/plain');
        const posicao = e.currentTarget.dataset.posicao;

        if (e.currentTarget.classList.contains('filled')) {
            showNotification('Esta posi√ß√£o j√° est√° ocupada. Remova o pneu atual primeiro.', 'warning');
            return;
        }

        colocarPneuNaMontagem(posicao, numeroFogo);
    }
    
    // Adicionar eventos de clique para remover pneu (quando em modo montagem)
    function adicionarEventosRemocao() {
        // Limpar eventos de clique anteriores
        document.querySelectorAll('.tire-slot.filled').forEach(slot => {
            slot.removeEventListener('click', removerPneuDoSlot);
        });

        // Adicionar novos eventos de clique se estiver em modo montagem
        if (modoMontagem) {
            document.querySelectorAll('.tire-slot.filled').forEach(slot => {
                slot.addEventListener('click', removerPneuDoSlot);
                slot.title = 'Clique para remover';
            });
        }
    }

    function removerPneuDoSlot(e) {
        if (!modoMontagem) return;
        const posicao = e.currentTarget.dataset.posicao;
        removerPneuDaMontagem(posicao);
    }

    // Fun√ß√£o de gerenciamento de montagem
    function colocarPneuNaMontagem(posicao, numeroFogo, atualizar = true) {
        // Se a posi√ß√£o j√° estiver ocupada, remove o pneu antigo primeiro
        const pneuAntigo = montagemTemporaria.posicoesOcupadas[posicao];
        if (pneuAntigo) {
            removerPneuDaMontagem(posicao, false); // N√£o atualiza a visualiza√ß√£o aqui
        }

        // Adicionar √† montagem tempor√°ria
        montagemTemporaria.posicoesOcupadas[posicao] = numeroFogo;
        
        // Garantir que n√£o haja duplicatas
        if (!montagemTemporaria.pneusMontados.includes(numeroFogo)) {
            montagemTemporaria.pneusMontados.push(numeroFogo);
        }

        if (atualizar) {
            // Atualizar visualiza√ß√£o
            renderizarDiagramaVeiculo();
            renderizarPneusDisponiveis();
            atualizarStatusMontagem();
            showNotification(`Pneu Fogo ${numeroFogo} colocado na posi√ß√£o ${posicao.toUpperCase().replace('-', ' ')}`, 'success');
        }
    }

    function removerPneuDaMontagem(posicao, atualizar = true) {
        if (!modoMontagem) return;
        
        const numeroFogo = montagemTemporaria.posicoesOcupadas[posicao];
        
        if (numeroFogo) {
            // Remover da montagem tempor√°ria
            delete montagemTemporaria.posicoesOcupadas[posicao];
            
            // Reconstruir lista de pneus montados (garantir que o pneu s√≥ saia se n√£o estiver em *outra* posi√ß√£o)
            montagemTemporaria.pneusMontados = Object.values(montagemTemporaria.posicoesOcupadas);

            if (atualizar) {
                // Atualizar visualiza√ß√£o
                renderizarDiagramaVeiculo();
                renderizarPneusDisponiveis();
                atualizarStatusMontagem();
                showNotification(`Pneu Fogo ${numeroFogo} removido da posi√ß√£o ${posicao.toUpperCase().replace('-', ' ')}`, 'warning');
            }
        }
    }

    // =============================================
    // SISTEMA DE MONTAGEM - NOVAS FUN√á√ïES
    // =============================================

    function iniciarMontagem() {
        if (!veiculoSelecionado) {
            showNotification('Selecione um ve√≠culo primeiro!', 'error');
            return;
        }
        
        modoMontagem = true;
        montagemTemporaria.dataInicio = new Date();
        
        // Limpar e recarregar posi√ß√µes iniciais no modo montagem
        montagemTemporaria = { dataInicio: montagemTemporaria.dataInicio, posicoesOcupadas: {}, pneusMontados: [] };
        
        // Copiar as posi√ß√µes ATUAIS do ve√≠culo para o objeto tempor√°rio
        Object.keys(veiculoSelecionado.eixos).forEach(eixoKey => {
            const eixo = veiculoSelecionado.eixos[eixoKey];
            if (eixo && typeof eixo === 'object') {
                if (eixo.esquerda) colocarPneuNaMontagem(`${eixoKey}-esquerda`, eixo.esquerda, false);
                if (eixo.direita) colocarPneuNaMontagem(`${eixoKey}-direita`, eixo.direita, false);
            } else if (eixo) {
                // Estepe
                colocarPneuNaMontagem(eixoKey, eixo, false);
            }
        });
        
        // Atualizar interface
        document.getElementById('btnIniciarMontagem').style.display = 'none';
        document.getElementById('btnFinalizarMontagem').style.display = 'inline-block';
        document.getElementById('montagemInfo').style.display = 'block';
        
        // Re-renderizar com eventos de remo√ß√£o e drag
        renderizarDiagramaVeiculo();
        renderizarPneusDisponiveis();
        adicionarEventosRemocao();
        
        showNotification('Modo montagem ativado! Arraste os pneus para as posi√ß√µes desejadas.', 'success');
        
        // Atualizar status
        atualizarStatusMontagem();
    }

    function finalizarMontagem() {
        if (!modoMontagem) return;
        
        // Confirmar finaliza√ß√£o
        if (!confirm('Voc√™ est√° prestes a finalizar a montagem. As posi√ß√µes atuais do ve√≠culo ser√£o salvas. Deseja continuar?')) {
            return;
        }

        // 1. Resetar o ve√≠culo, removendo todos os fogos atuais
        veiculoSelecionado.eixos = createInitialAxles(veiculoSelecionado.tipo, veiculoSelecionado.configuracao);
        
        // 2. Aplicar a montagem tempor√°ria ao ve√≠culo
        Object.entries(montagemTemporaria.posicoesOcupadas).forEach(([posicao, fogoNumero]) => {
            const [eixoKey, lado] = posicao.split('-');
            
            if (eixoKey === 'estepe') {
                veiculoSelecionado.eixos.estepe = fogoNumero;
            } else if (lado) {
                veiculoSelecionado.eixos[eixoKey][lado] = fogoNumero;
            }
            
            // 3. Registrar movimenta√ß√£o (Montagem) e atualizar KM Acumulado/Veiculo/Posicao do Fogo
            const fogo = reportData.fogos.find(f => f.numero === fogoNumero);
            if (fogo) {
                // Se o fogo j√° estava no ve√≠culo, isso √© uma troca de posi√ß√£o.
                // Aqui simplificamos: se mudou de posi√ß√£o ou foi montado pela primeira vez, registramos.
                // O controle de KM real e Desmontagem/Montagem deve ser mais complexo no futuro.
                
                // Simula√ß√£o: se o fogo n√£o estava neste ve√≠culo (ou estava em estoque), √© uma montagem
                if (fogo.veiculo !== veiculoSelecionado.id || fogo.posicao !== posicao) {
                    reportData.movimentacoes.push({
                        id: `M${(reportData.movimentacoes.length + 1).toString().padStart(4, '0')}`,
                        data: new Date().toISOString().substring(0, 10),
                        tipo: 'Montagem',
                        fogo: fogoNumero,
                        veiculo: veiculoSelecionado.id,
                        posicao: posicao,
                        kmVeiculo: veiculoSelecionado.kmAtual,
                        kmFogo: fogo.kmAcumulado
                    });
                }
                
                fogo.veiculo = veiculoSelecionado.id;
                fogo.posicao = posicao;
            }
        });

        // 4. Identificar fogos que foram removidos (estavam no ve√≠culo, mas n√£o est√£o na montagem tempor√°ria)
        // Isso √© complexo e exigiria um estado inicial do ve√≠culo antes da montagem. 
        // Simplifica√ß√£o: vamos apenas garantir que os fogos que foram removidos voltem para o estado 'Em Estoque Fogo'.
        reportData.fogos.forEach(fogo => {
            if (fogo.veiculo === veiculoSelecionado.id && !montagemTemporaria.pneusMontados.includes(fogo.numero)) {
                
                // Se o fogo foi removido e n√£o est√° em nenhuma outra posi√ß√£o
                const aindaMontado = Object.values(veiculoSelecionado.eixos).some(eixo => {
                    if (eixo && typeof eixo === 'object') {
                        return eixo.esquerda === fogo.numero || eixo.direita === fogo.numero;
                    } else if (eixo) {
                        return eixo === fogo.numero; // Estepe
                    }
                    return false;
                });
                
                if (!aindaMontado) {
                    // √â uma desmontagem. Registrar movimenta√ß√£o.
                    reportData.movimentacoes.push({
                        id: `M${(reportData.movimentacoes.length + 1).toString().padStart(4, '0')}`,
                        data: new Date().toISOString().substring(0, 10),
                        tipo: 'Desmontagem',
                        fogo: fogo.numero,
                        veiculo: veiculoSelecionado.id,
                        posicao: fogo.posicao, // Posi√ß√£o anterior
                        kmVeiculo: veiculoSelecionado.kmAtual,
                        kmFogo: fogo.kmAcumulado
                    });

                    fogo.veiculo = null;
                    fogo.posicao = null;
                }
            }
        });
        
        // 5. Salvar e atualizar estados
        modoMontagem = false;
        montagemTemporaria = { dataInicio: null, posicoesOcupadas: {}, pneusMontados: [] };
        
        document.getElementById('btnIniciarMontagem').style.display = 'inline-block';
        document.getElementById('btnFinalizarMontagem').style.display = 'none';
        document.getElementById('montagemInfo').style.display = 'none';

        saveData();
        carregarPneusDisponiveis();
        renderizarDiagramaVeiculo();
        renderizarPneusDisponiveis();
        atualizarStatusMontagem();
        adicionarEventosRemocao();
        verificarAlertasAutomaticos();
        
        showNotification('Montagem finalizada e posi√ß√µes salvas!', 'success');
    }
    
    // Fun√ß√£o para salvar as posi√ß√µes atuais do ve√≠culo (apenas em modo montagem)
    function saveTirePositions() {
        if (!modoMontagem) {
            showNotification('Inicie o modo de montagem primeiro!', 'error');
            return;
        }
        
        // O processo de 'salvar posi√ß√µes' √© o mesmo de 'finalizar montagem'
        finalizarMontagem();
    }

    // Fun√ß√£o para resetar a montagem tempor√°ria (perder altera√ß√µes)
    function resetTirePositions() {
        if (!veiculoSelecionado) return;
        
        if (modoMontagem && confirm('Isto ir√° descartar todas as altera√ß√µes tempor√°rias de montagem. Deseja continuar?')) {
            // Resetar montagem tempor√°ria
            montagemTemporaria = { dataInicio: null, posicoesOcupadas: {}, pneusMontados: [] };

            // Voltar ao modo de visualiza√ß√£o
            modoMontagem = false;
            document.getElementById('btnIniciarMontagem').style.display = 'inline-block';
            document.getElementById('btnFinalizarMontagem').style.display = 'none';
            document.getElementById('montagemInfo').style.display = 'none';
            
            // Re-selecionar o ve√≠culo para carregar as posi√ß√µes salvas
            selecionarVeiculo(veiculoSelecionado);
            
            showNotification('Montagem tempor√°ria descartada.', 'warning');
        } else if (!modoMontagem) {
            showNotification('N√£o h√° montagem ativa para resetar.', 'warning');
        }
    }

    function atualizarStatusMontagem() {
        if (!veiculoSelecionado) return;
        
        const totalPosicoes = calcularTotalPosicoes(veiculoSelecionado);
        const pneusMontados = Object.keys(montagemTemporaria.posicoesOcupadas).length;
        const posicoesVazias = totalPosicoes - pneusMontados;
        
        // Pneus dispon√≠veis: Total de fogos em estoque - pneus que acabaram de ser adicionados
        const fogosEmEstoque = reportData.fogos.filter(f => !f.veiculo);
        const pneusDisponiveisCount = fogosEmEstoque.length - montagemTemporaria.pneusMontados.filter(f => fogosEmEstoque.some(fe => fe.numero === f)).length;

        // Atualizar elementos
        document.getElementById('statusPneusMontados').textContent = pneusMontados;
        document.getElementById('statusPosicoesVazias').textContent = posicoesVazias;
        document.getElementById('statusPneusDisponiveis').textContent = pneusDisponiveis.length;
    }

    function calcularTotalPosicoes(veiculo) {
        let total = 0;
        Object.values(veiculo.eixos).forEach(eixo => {
            if (eixo && typeof eixo === 'object' && eixo.tipo !== 'estepe') {
                total += 2; // Eixos duplos (esquerda + direita)
            } else if (eixo && eixo.tipo === 'estepe') {
                total += 1; // Estepe
            }
        });
        return total;
    }
    
    // =============================================
    // GEST√ÉO DE VE√çCULOS
    // =============================================

    function openAddVeiculoModal() {
        // Resetar para as op√ß√µes padr√£o (Cavalo, 6x2)
        document.getElementById('veiculoTipo').value = 'cavalo';
        updateVeiculoConfig();
        document.getElementById('veiculoPlaca').value = '';
        document.getElementById('veiculoModelo').value = '';
        document.getElementById('veiculoKmAtual').value = 0;
        document.getElementById('addVeiculoModal').style.display = 'flex';
    }

    function closeAddVeiculoModal() {
        document.getElementById('addVeiculoModal').style.display = 'none';
    }

    function updateVeiculoConfig() {
        const tipo = document.getElementById('veiculoTipo').value;
        const configSelect = document.getElementById('veiculoConfiguracao');
        configSelect.innerHTML = '';
        
        if (tipo === 'cavalo') {
            configSelect.innerHTML += `<option value="6x2">6x2</option>`;
            configSelect.innerHTML += `<option value="6x4">6x4</option>`;
            configSelect.innerHTML += `<option value="4x2">4x2</option>`;
        } else if (tipo === 'carreta') {
            configSelect.innerHTML += `<option value="1 eixo">1 Eixo</option>`;
            configSelect.innerHTML += `<option value="2 eixos">2 Eixos</option>`;
            configSelect.innerHTML += `<option value="3 eixos">3 Eixos</option>`;
            configSelect.innerHTML += `<option value="9 eixos">9 Eixos</option>`;
        }
    }

    function confirmAddVeiculo() {
        const placa = document.getElementById('veiculoPlaca').value.toUpperCase().trim();
        const modelo = document.getElementById('veiculoModelo').value.trim();
        const tipo = document.getElementById('veiculoTipo').value;
        const configuracao = document.getElementById('veiculoConfiguracao').value;
        const kmAtual = parseInt(document.getElementById('veiculoKmAtual').value);

        if (!placa || !modelo || !tipo || !configuracao || isNaN(kmAtual) || kmAtual < 0) {
            showNotification('Preencha todos os campos obrigat√≥rios corretamente.', 'error');
            return;
        }

        if (reportData.veiculos.some(v => v.placa === placa)) {
            showNotification('Ve√≠culo com esta placa j√° cadastrado.', 'error');
            return;
        }

        // Gerar ID
        const newId = `V${(reportData.veiculos.length + 1).toString().padStart(3, '0')}`;
        
        const newVeiculo = {
            id: newId,
            placa,
            modelo,
            tipo,
            configuracao,
            kmAtual,
            observacoes: '',
            eixos: createInitialAxles(tipo, configuracao)
        };
        
        reportData.veiculos.push(newVeiculo);

        showNotification(`Ve√≠culo ${placa} (${modelo}) adicionado com sucesso!`, 'success');
        closeAddVeiculoModal();
        saveData();
        renderizarListaVeiculos();
    }
    
    function createInitialAxles(tipo, configuracao) {
        if (tipo === 'cavalo') {
            const eixos = {
                dianteiro: { tipo: 'direcional', esquerda: null, direita: null },
                estepe: null
            };
            
            if (configuracao === '4x2') {
                eixos.traseiro1 = { tipo: 'tracao', esquerda: null, direita: null };
            } else if (configuracao === '6x2') {
                eixos.traseiro1 = { tipo: 'tracao', esquerda: null, direita: null };
                eixos.traseiro2 = { tipo: 'livre', esquerda: null, direita: null };
            } else if (configuracao === '6x4') {
                eixos.traseiro1 = { tipo: 'tracao', esquerda: null, direita: null };
                eixos.traseiro2 = { tipo: 'tracao', esquerda: null, direita: null };
            }
            return eixos;
        } else { // Carreta
            const eixos = { estepe: null };
            const numEixos = parseInt(configuracao.split(' ')[0]);

            for (let i = 1; i <= numEixos; i++) {
                eixos[`traseiro${i}`] = { tipo: 'fixo', esquerda: null, direita: null };
            }
            // Adicionar eixos espec√≠ficos para a "9 eixos" se for o caso
            // Se for "9 eixos", essa l√≥gica precisa ser mais espec√≠fica
            if (configuracao === '9 eixos') {
                return {
                    traseiro1: { tipo: 'fixo', esquerda: null, direita: null },
                    traseiro2: { tipo: 'fixo', esquerda: null, direita: null },
                    traseiro3: { tipo: 'fixo', esquerda: null, direita: null },
                    traseiro4: { tipo: 'fixo', esquerda: null, direita: null },
                    traseiro5: { tipo: 'fixo', esquerda: null, direita: null },
                    traseiro6: { tipo: 'fixo', esquerda: null, direita: null },
                    estepe: null 
                };
            }
            return eixos;
        }
    }
    
    function updateEditVeiculoConfig() {
        const tipo = document.getElementById('editVeiculoTipo').value;
        const configSelect = document.getElementById('editVeiculoConfiguracao');
        configSelect.innerHTML = '';
        
        if (tipo === 'cavalo') {
            configSelect.innerHTML += `<option value="6x2">6x2</option>`;
            configSelect.innerHTML += `<option value="6x4">6x4</option>`;
            configSelect.innerHTML += `<option value="4x2">4x2</option>`;
        } else if (tipo === 'carreta') {
            configSelect.innerHTML += `<option value="1 eixo">1 Eixo</option>`;
            configSelect.innerHTML += `<option value="2 eixos">2 Eixos</option>`;
            configSelect.innerHTML += `<option value="3 eixos">3 Eixos</option>`;
            configSelect.innerHTML += `<option value="9 eixos">9 Eixos</option>`;
        }
        // Tenta manter a configura√ß√£o atual se ela for compat√≠vel
        if (veiculoSelecionado) {
            configSelect.value = veiculoSelecionado.configuracao;
        }
    }

    function openEditVeiculoModal(veiculo) {
        veiculoSelecionado = veiculo;
        
        document.getElementById('editVeiculoPlaca').value = veiculo.placa;
        document.getElementById('editVeiculoModelo').value = veiculo.modelo;
        document.getElementById('editVeiculoTipo').value = veiculo.tipo;
        document.getElementById('editVeiculoKmAtual').value = veiculo.kmAtual;
        document.getElementById('editVeiculoObservacoes').value = veiculo.observacoes;
        
        // Atualiza as op√ß√µes de configura√ß√£o antes de setar o valor
        updateEditVeiculoConfig(); 
        document.getElementById('editVeiculoConfiguracao').value = veiculo.configuracao;

        document.getElementById('editVeiculoModal').style.display = 'flex';
    }
    
    function closeEditVeiculoModal() {
        document.getElementById('editVeiculoModal').style.display = 'none';
        // N√£o reseta veiculoSelecionado aqui para manter o diagrama
    }

    function confirmEditVeiculo() {
        if (!veiculoSelecionado) return;

        const novaPlaca = document.getElementById('editVeiculoPlaca').value.toUpperCase().trim();
        const novoModelo = document.getElementById('editVeiculoModelo').value.trim();
        const novoTipo = document.getElementById('editVeiculoTipo').value;
        const novaConfiguracao = document.getElementById('editVeiculoConfiguracao').value;
        const novoKm = parseInt(document.getElementById('editVeiculoKmAtual').value);
        const novasObs = document.getElementById('editVeiculoObservacoes').value;
        
        if (!novaPlaca || !novoModelo || !novoTipo || !novaConfiguracao || isNaN(novoKm) || novoKm < 0) {
            showNotification('Preencha todos os campos obrigat√≥rios corretamente.', 'error');
            return;
        }
        
        // Verifica se a placa foi alterada para uma que j√° existe
        if (reportData.veiculos.some(v => v.placa === novaPlaca && v.id !== veiculoSelecionado.id)) {
            showNotification('Ve√≠culo com esta placa j√° cadastrado.', 'error');
            return;
        }

        // Se a configura√ß√£o mudar, os eixos devem ser resetados (pneus ser√£o desmontados)
        let eixosNovos = veiculoSelecionado.eixos;
        if (veiculoSelecionado.tipo !== novoTipo || veiculoSelecionado.configuracao !== novaConfiguracao) {
             if (confirm('Aten√ß√£o: A configura√ß√£o do ve√≠culo foi alterada. Todos os pneus montados ser√£o removidos e colocados em "Estoque Fogo". Deseja continuar?')) {
                // Desmontar todos os pneus
                Object.values(veiculoSelecionado.eixos).forEach(eixo => {
                    if (eixo && typeof eixo === 'object') {
                        if (eixo.esquerda) {
                             const fogo = reportData.fogos.find(f => f.numero === eixo.esquerda);
                             if (fogo) { fogo.veiculo = null; fogo.posicao = null; }
                        }
                        if (eixo.direita) {
                            const fogo = reportData.fogos.find(f => f.numero === eixo.direita);
                            if (fogo) { fogo.veiculo = null; fogo.posicao = null; }
                        }
                    } else if (eixo) { // Estepe
                        const fogo = reportData.fogos.find(f => f.numero === eixo);
                        if (fogo) { fogo.veiculo = null; fogo.posicao = null; }
                    }
                });
                
                // Criar nova estrutura de eixos
                eixosNovos = createInitialAxles(novoTipo, novaConfiguracao);
                showNotification('Pneus desmontados e nova estrutura de eixos aplicada.', 'warning');
             } else {
                 return; // Cancelar a edi√ß√£o
             }
        }
        
        veiculoSelecionado.placa = novaPlaca;
        veiculoSelecionado.modelo = novoModelo;
        veiculoSelecionado.tipo = novoTipo;
        veiculoSelecionado.configuracao = novaConfiguracao;
        veiculoSelecionado.kmAtual = novoKm;
        veiculoSelecionado.observacoes = novasObs;
        veiculoSelecionado.eixos = eixosNovos; // Aplica a nova estrutura de eixos

        showNotification(`Ve√≠culo ${veiculoSelecionado.placa} atualizado com sucesso!`, 'success');
        closeEditVeiculoModal();
        saveData();
        renderizarListaVeiculos();
        renderizarDiagramaVeiculo(); // Garante que o diagrama seja atualizado
    }
    
    function deleteVeiculo() {
        if (!veiculoSelecionado) return;

        if (confirm(`Tem certeza que deseja EXCLUIR o ve√≠culo ${veiculoSelecionado.placa}? Todos os pneus montados nele ser√£o colocados em "Estoque Fogo".`)) {
            
            // Desmontar todos os pneus do ve√≠culo
            Object.values(veiculoSelecionado.eixos).forEach(eixo => {
                if (eixo && typeof eixo === 'object') {
                    if (eixo.esquerda) {
                         const fogo = reportData.fogos.find(f => f.numero === eixo.esquerda);
                         if (fogo) { fogo.veiculo = null; fogo.posicao = null; }
                    }
                    if (eixo.direita) {
                        const fogo = reportData.fogos.find(f => f.numero === eixo.direita);
                        if (fogo) { fogo.veiculo = null; fogo.posicao = null; }
                    }
                } else if (eixo) { // Estepe
                    const fogo = reportData.fogos.find(f => f.numero === eixo);
                    if (fogo) { fogo.veiculo = null; fogo.posicao = null; }
                }
            });

            // Remover o ve√≠culo da lista
            reportData.veiculos = reportData.veiculos.filter(v => v.id !== veiculoSelecionado.id);
            
            // Limpar a sele√ß√£o e a visualiza√ß√£o
            veiculoSelecionado = null;
            document.getElementById('currentVehicle').textContent = 'Selecione um Ve√≠culo';
            document.getElementById('vehicleDetails').textContent = 'Detalhes';
            
            showNotification(`Ve√≠culo ${veiculoSelecionado.placa} exclu√≠do com sucesso!`, 'success');
            closeEditVeiculoModal();
            saveData();
            renderizarListaVeiculos();
            renderizarDiagramaVeiculo();
            inicializarSistemaMovimentacao();
        }
    }


    // =============================================
    // EXPORTA√á√ÉO (PDF / EXCEL)
    // =============================================
    
    // Configura√ß√µes do jsPDF
    const { jsPDF } = window.jspdf;

    function gerarPDFCompleto(dados) {
        const doc = new jsPDF('p', 'mm', 'a4'); // 'p' for portrait, 'mm' for millimeters, 'a4' for size
        let y = 10;
        const margin = 15;
        const pageHeight = doc.internal.pageSize.height;
        let fontSize = 12;

        doc.setFont('helvetica', 'bold');
        doc.setFontSize(18);
        doc.setTextColor(15, 23, 42); // --bg (quase preto)
        doc.text(dados.titulo, 105, y, null, null, 'center');
        y += 7;

        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(100, 116, 139); // --muted
        doc.text(`Gerado em: ${dados.dataGeracao}`, 105, y, null, null, 'center');
        y += 10;

        // --- Se√ß√£o 1: Resumo do Dashboard ---
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(56, 189, 248); // --accent
        doc.text("üìä Resumo do Dashboard", margin, y);
        y += 8;

        doc.setFontSize(10);
        doc.setTextColor(0);
        
        // Simula√ß√£o de grid de m√©tricas
        const metrics = [
            { label: 'Total em Estoque', value: dados.resumo.totalEstoque, color: '#38bdf8' },
            { label: 'Pneus com Fogo', value: dados.resumo.totalFogos, color: '#f97316' },
            { label: 'Valor Total Estoque (R$)', value: dados.resumo.valorTotalEstoque.toLocaleString('pt-BR', {minimumFractionDigits: 2}), color: '#10b981' },
            { label: 'Alertas Pendentes', value: dados.resumo.alertasPendentes, color: '#f43f5e' }
        ];

        let xMetric = margin;
        const metricWidth = 40;
        const metricHeight = 18;

        metrics.forEach((m, index) => {
            if (index > 0) xMetric += metricWidth + 10; // Espa√ßamento entre as m√©tricas

            // Background
            doc.setFillColor(240, 240, 240);
            doc.roundedRect(xMetric, y, metricWidth, metricHeight, 3, 3, 'F');
            
            // Linha de acento
            doc.setDrawColor(m.color);
            doc.setLineWidth(1);
            doc.line(xMetric, y + 1, xMetric + metricWidth, y + 1);

            doc.setTextColor(15, 23, 42);
            doc.text(m.label, xMetric + 2, y + 5);
            
            doc.setTextColor(m.color);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text(m.value.toString(), xMetric + 2, y + 12);
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
        });
        y += metricHeight + 10;

        // --- Se√ß√£o 2: Estoque Detalhado (Tabela) ---
        if (y + 40 > pageHeight) { doc.addPage(); y = margin; }
        
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(56, 189, 248);
        doc.text("üì¶ Estoque Detalhado", margin, y);
        y += 5;

        const tableColumnStyles = {
            0: { cellWidth: 20 },  // ID
            1: { cellWidth: 35 },  // Medida
            2: { cellWidth: 45 },  // Marca/Modelo
            3: { cellWidth: 20 },  // Status
            4: { cellWidth: 15, halign: 'center' }, // Qtd
            5: { cellWidth: 30, halign: 'right' }, // Valor Unit
            6: { cellWidth: 30, halign: 'right' }  // Valor Total
        };

        const tableHeaders = [
            ['ID', 'Medida', 'Marca/Modelo', 'Status', 'Qtd', 'Valor Unit.', 'Valor Total']
        ];
        
        const tableData = dados.estoque.map(item => [
            item.id,
            item.medida,
            `${item.marca}/${item.modelo}`,
            item.status,
            item.qty.toString(),
            `R$ ${item.preco.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`,
            `R$ ${(item.qty * item.preco).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
        ]);
        
        doc.autoTable({
            startY: y + 5,
            head: tableHeaders,
            body: tableData,
            theme: 'striped',
            headStyles: { 
                fillColor: [30, 41, 59], 
                textColor: [148, 163, 184], 
                fontSize: 8 
            },
            bodyStyles: { 
                fontSize: 8, 
                textColor: [0, 0, 0] 
            },
            styles: {
                cellPadding: 2,
                lineWidth: 0.1,
                lineColor: [220, 220, 220]
            },
            columnStyles: tableColumnStyles,
            margin: { top: y, left: margin, right: margin }
        });
        
        y = doc.autoTable.previous.finalY + 10;
        
        // --- Se√ß√£o 3: Fogos Ativos ---
        if (y + 40 > pageHeight) { doc.addPage(); y = margin; }

        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(56, 189, 248);
        doc.text("üî• Fogos Ativos (Pneus Serializados)", margin, y);
        y += 5;
        
        const fogosHeaders = [
            ['Fogo', 'Pneu Base', 'Ve√≠culo', 'Posi√ß√£o', 'KM Acumulado']
        ];
        
        const fogosData = dados.fogos.map(fogo => {
            const pneu = reportData.items.find(p => p.id === fogo.pneuId);
            const veiculo = fogo.veiculo ? reportData.veiculos.find(v => v.id === fogo.veiculo) : null;
            
            return [
                fogo.numero,
                pneu ? `${pneu.medida} (${pneu.marca})` : 'N/A',
                veiculo ? veiculo.placa : 'ESTOQUE FOGO',
                fogo.posicao ? fogo.posicao.toUpperCase().replace('-', ' ') : 'N/A',
                fogo.kmAcumulado.toLocaleString('pt-BR')
            ];
        });
        
        doc.autoTable({
            startY: y + 5,
            head: fogosHeaders,
            body: fogosData,
            theme: 'striped',
            headStyles: { 
                fillColor: [30, 41, 59], 
                textColor: [148, 163, 184], 
                fontSize: 8 
            },
            bodyStyles: { 
                fontSize: 8, 
                textColor: [0, 0, 0] 
            },
            styles: {
                cellPadding: 2,
                lineWidth: 0.1,
                lineColor: [220, 220, 220]
            },
            margin: { top: y, left: margin, right: margin }
        });
        
        y = doc.autoTable.previous.finalY + 10;
        
        // --- Se√ß√£o 4: Alertas Pendentes ---
        if (y + 40 > pageHeight) { doc.addPage(); y = margin; }

        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(56, 189, 248);
        doc.text("üîî Alertas Pendentes", margin, y);
        y += 5;

        if (dados.alertas.length > 0) {
            dados.alertas.forEach(alerta => {
                if (y + 15 > pageHeight) { doc.addPage(); y = margin; }
                
                doc.setFillColor(254, 226, 226); // Vermelho claro
                doc.setDrawColor(248, 113, 113); // Vermelho
                doc.setLineWidth(0.5);
                doc.roundedRect(margin, y, 180, 12, 2, 2, 'FD'); // 180mm de largura (210 - 2*15)

                doc.setFontSize(9);
                doc.setTextColor(185, 28, 28); // Vermelho escuro
                doc.text(`[${alerta.id}] ${alerta.tipo}: ${alerta.mensagem} (Origem: ${alerta.origem})`, margin + 2, y + 7);
                y += 15;
            });
        } else {
            doc.setFontSize(10);
            doc.setTextColor(100, 116, 139);
            doc.text("Nenhum alerta pendente.", margin, y + 5);
            y += 10;
        }

        doc.save('Relatorio_Completo_Pneus.pdf');
    }
    
    function gerarPDFFinanceiro(dados) {
        const doc = new jsPDF('p', 'mm', 'a4'); 
        let y = 10;
        const margin = 15;
        const pageHeight = doc.internal.pageSize.height;

        doc.setFont('helvetica', 'bold');
        doc.setFontSize(18);
        doc.setTextColor(15, 23, 42); 
        doc.text(dados.titulo, 105, y, null, null, 'center');
        y += 7;

        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(100, 116, 139); 
        doc.text(`Gerado em: ${dados.dataGeracao}`, 105, y, null, null, 'center');
        y += 10;
        
        // --- Se√ß√£o 1: Totais Financeiros ---
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(16, 185, 129); // --success
        doc.text("üí∞ Resumo Financeiro", margin, y);
        y += 8;

        doc.setFontSize(10);
        doc.setTextColor(0);
        
        const totals = [
            { label: 'Investimento Total em Estoque', value: `R$ ${dados.totais.investimentoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`, color: '#38bdf8' },
            { label: 'Valor em Pneus com Fogo', value: `R$ ${dados.totais.valorEmFogos.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`, color: '#f97316' },
            { label: 'Valor em Estoque Parado', value: `R$ ${dados.totais.valorEmEstoque.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`, color: '#10b981' },
        ];

        let xMetric = margin;
        const metricWidth = 50;
        const metricHeight = 20;

        totals.forEach((m, index) => {
            if (index > 0) xMetric += metricWidth + 10;

            doc.setFillColor(240, 240, 240);
            doc.roundedRect(xMetric, y, metricWidth, metricHeight, 3, 3, 'F');
            doc.setDrawColor(m.color);
            doc.setLineWidth(1);
            doc.line(xMetric, y + 1, xMetric + metricWidth, y + 1);

            doc.setTextColor(15, 23, 42);
            doc.text(m.label, xMetric + 2, y + 5, { maxWidth: metricWidth - 4 });
            
            doc.setTextColor(m.color);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text(m.value, xMetric + 2, y + 15);
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
        });
        y += metricHeight + 10;
        
        // --- Se√ß√£o 2: Estoque por Status ---
        if (y + 40 > pageHeight) { doc.addPage(); y = margin; }
        
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(56, 189, 248);
        doc.text("Status do Estoque (Quantidade)", margin, y);
        y += 5;

        const statusHeaders = [
            ['Status', 'Quantidade']
        ];
        
        const statusData = [
            ['Novo', dados.estoquePorStatus.Novo.toString()],
            ['Usado', dados.estoquePorStatus.Usado.toString()],
            ['Reformado', dados.estoquePorStatus.Reformado.toString()],
        ];
        
        doc.autoTable({
            startY: y + 5,
            head: statusHeaders,
            body: statusData,
            theme: 'striped',
            headStyles: { 
                fillColor: [30, 41, 59], 
                textColor: [148, 163, 184], 
                fontSize: 8 
            },
            bodyStyles: { 
                fontSize: 8, 
                textColor: [0, 0, 0] 
            },
            columnStyles: {
                0: { cellWidth: 50 },
                1: { cellWidth: 50, halign: 'center' }
            },
            margin: { top: y, left: margin, right: 100 }
        });
        
        y = doc.autoTable.previous.finalY + 10;
        
        // --- Se√ß√£o 3: Top 5 Itens Mais Caros em Estoque ---
        if (y + 40 > pageHeight) { doc.addPage(); y = margin; }
        
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(14);
        doc.setTextColor(56, 189, 248);
        doc.text("Top 5 Itens Mais Caros (Valor Total)", margin, y);
        y += 5;
        
        const topHeaders = [
            ['Medida', 'Marca/Modelo', 'Qtd', 'Valor Unit.', 'Valor Total']
        ];
        
        const topData = dados.top5MaisCaros.map(item => [
            item.medida,
            `${item.marca}/${item.modelo}`,
            item.qty.toString(),
            `R$ ${item.preco.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`,
            `R$ ${(item.qty * item.preco).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
        ]);
        
        doc.autoTable({
            startY: y + 5,
            head: topHeaders,
            body: topData,
            theme: 'striped',
            headStyles: { 
                fillColor: [30, 41, 59], 
                textColor: [148, 163, 184], 
                fontSize: 8 
            },
            bodyStyles: { 
                fontSize: 8, 
                textColor: [0, 0, 0] 
            },
            styles: {
                cellPadding: 2,
                lineWidth: 0.1,
                lineColor: [220, 220, 220]
            },
            columnStyles: {
                2: { halign: 'center' },
                3: { halign: 'right' },
                4: { halign: 'right' }
            },
            margin: { top: y, left: margin, right: margin }
        });
        
        doc.save('Relatorio_Financeiro_Pneus.pdf');
    }

    function exportCompletePDF() {
        showNotification('üìÑ Gerando Relat√≥rio Completo...', 'success');
        
        // Obter dados para o PDF
        const totalEstoque = reportData.items.reduce((sum, item) => sum + item.qty, 0);
        const totalFogos = reportData.fogos.length;
        const valorTotal = reportData.items.reduce((sum, item) => sum + (item.qty * (item.preco || 0)), 0);
        const alertasPendentes = sistemaAlertas.filter(a => a.status === 'pendente').length;

        const dadosRelatorio = {
            titulo: "Relat√≥rio Completo - Transportes Canarinho",
            dataGeracao: new Date().toLocaleString('pt-BR'),
            resumo: {
                totalEstoque: totalEstoque,
                totalFogos: totalFogos,
                valorTotalEstoque: valorTotal,
                alertasPendentes: alertasPendentes
            },
            estoque: reportData.items.sort((a, b) => a.id.localeCompare(b.id)),
            fogos: reportData.fogos.sort((a, b) => a.numero.localeCompare(b.numero)),
            alertas: sistemaAlertas.filter(a => a.status === 'pendente'),
        };
        
        gerarPDFCompleto(dadosRelatorio);
    }
    
    function exportFinancialReport() {
        showNotification('üí∞ Gerando relat√≥rio financeiro...', 'success');
        
        // Calcular totais financeiros
        const totalInvestido = reportData.items.reduce((sum, item) => sum + (item.qty * (item.preco || 0)), 0);
        const custoFogosAtivos = reportData.fogos.reduce((sum, fogo) => {
            const pneu = reportData.items.find(p => p.id === fogo.pneuId);
            return sum + (pneu ? pneu.preco : 0);
        }, 0);
        
        const dadosFinanceiros = {
            titulo: "Relat√≥rio Financeiro - Transportes Canarinho",
            dataGeracao: new Date().toLocaleString('pt-BR'),
            totais: {
                investimentoTotal: totalInvestido,
                valorEmFogos: custoFogosAtivos,
                valorEmEstoque: totalInvestido - custoFogosAtivos
            },
            estoquePorStatus: calcularEstoquePorStatus(),
            top5MaisCaros: reportData.items
                .sort((a, b) => (b.preco * b.qty) - (a.preco * a.qty))
                .slice(0, 5)
        };
        
        gerarPDFFinanceiro(dadosFinanceiros);
    }

    function exportInventoryReport() {
        showNotification('üì¶ Gerando relat√≥rio de estoque...', 'success');
        
        const dadosEstoque = {
            titulo: "Relat√≥rio de Estoque - Transportes Canarinho",
            dataGeracao: new Date().toLocaleString('pt-BR'),
            itens: reportData.items,
            totais: {
                porStatus: calcularEstoquePorStatus(),
                porContainer: calcularEstoquePorContainer(),
                porMarca: calcularEstoquePorMarca()
            }
        };
        
        // Este relat√≥rio precisaria de uma fun√ß√£o de gera√ß√£o de PDF espec√≠fica (gerarPDFEstoque) se o layout fosse diferente do 'completo'
        // Por simplifica√ß√£o, vamos reutilizar o exportCompletePDF
        const dadosRelatorio = {
            titulo: "Relat√≥rio Detalhado de Estoque - Transportes Canarinho",
            dataGeracao: new Date().toLocaleString('pt-BR'),
            resumo: {
                totalEstoque: dadosEstoque.itens.reduce((sum, item) => sum + item.qty, 0),
                totalFogos: reportData.fogos.length,
                valorTotalEstoque: dadosEstoque.itens.reduce((sum, item) => sum + (item.qty * (item.preco || 0)), 0),
                alertasPendentes: sistemaAlertas.filter(a => a.status === 'pendente').length
            },
            estoque: dadosEstoque.itens.sort((a, b) => a.id.localeCompare(b.id)),
            fogos: [], // N√£o incluir fogos para manter o foco no estoque
            alertas: [] // N√£o incluir alertas
        };

        gerarPDFCompleto(dadosRelatorio); // Reutilizando a fun√ß√£o de PDF completo
    }
    
    function exportStockToExcel() {
        showNotification('Exportando Estoque para Excel...', 'success');
        
        const data = reportData.items.map(item => ({
            ID: item.id,
            Medida: item.medida,
            Marca: item.marca,
            Modelo: item.modelo,
            Status: item.status,
            Quantidade: item.qty,
            'Valor Unit√°rio (R$)': item.preco,
            'Valor Total (R$)': item.qty * item.preco,
            Container: item.container,
            Observa√ß√µes: item.observacoes
        }));
        
        const worksheet = XLSX.utils.json_to_sheet(data);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Estoque Pneus");
        
        XLSX.writeFile(workbook, "Relatorio_Estoque_Pneus.xlsx");
    }

    function exportFogosToExcel() {
        showNotification('Exportando Fogos para Excel...', 'success');
        
        const data = reportData.fogos.map(fogo => {
            const pneu = reportData.items.find(p => p.id === fogo.pneuId);
            const veiculo = fogo.veiculo ? reportData.veiculos.find(v => v.id === fogo.veiculo) : null;
            
            return {
                'N√∫mero Fogo': fogo.numero,
                'ID Item Estoque': fogo.pneuId,
                'Medida': pneu ? pneu.medida : 'N/A',
                'Marca': pneu ? pneu.marca : 'N/A',
                'Status Pneu Base': pneu ? pneu.status : 'N/A',
                'Valor Unit√°rio (R$)': pneu ? pneu.preco : 0,
                'KM Acumulado': fogo.kmAcumulado,
                'Ve√≠culo Atual': veiculo ? veiculo.placa : 'ESTOQUE FOGO',
                'Posi√ß√£o': fogo.posicao ? fogo.posicao.toUpperCase().replace('-', ' ') : 'N/A',
                'Data Cadastro': fogo.dataCadastro,
                'Observa√ß√µes': fogo.observacoes
            };
        });
        
        const worksheet = XLSX.utils.json_to_sheet(data);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Fogos Ativos");
        
        XLSX.writeFile(workbook, "Relatorio_Fogos_Ativos.xlsx");
    }
    
    function exportPerformanceToExcel() {
        showNotification('Exportando Performance para Excel...', 'success');
        
        const data = reportData.performance.map(p => ({
            Ve√≠culo: p.veiculo,
            'KM Total Rodado': p.kmTotal,
            'Pneus Trocados': p.pneusTrocados,
            'Custo Total (R$)': p.custoTotal,
            'Custo/KM (R$)': p.kmTotal > 0 ? p.custoTotal / p.kmTotal : 0,
            'M√©dia Durabilidade (KM)': p.durabilidadeMedia
        }));
        
        const worksheet = XLSX.utils.json_to_sheet(data);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Performance Ve√≠culos");
        
        XLSX.writeFile(workbook, "Relatorio_Performance_Veiculos.xlsx");
    }

    function exportAlertsToExcel() {
        showNotification('Exportando Alertas para Excel...', 'success');
        
        const data = sistemaAlertas.map(a => ({
            ID: a.id,
            Tipo: a.tipo,
            Origem: a.origem,
            Mensagem: a.mensagem,
            Status: a.status,
            Data: a.data
        }));
        
        const worksheet = XLSX.utils.json_to_sheet(data);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Alertas Sistema");
        
        XLSX.writeFile(workbook, "Relatorio_Alertas_Sistema.xlsx");
    }


    // =============================================
    // INICIALIZA√á√ÉO
    // =============================================

    document.addEventListener('DOMContentLoaded', function() {
      // 1. Carregar dados
      loadData();
      inicializarSistemaAlertas();
      
      // 2. Configurar o seletor de tabs principal
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tabName = this.dataset.tab;
          
          // Desativar todas as tabs e conte√∫dos
          document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
          document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
          
          // Ativar tab e conte√∫do selecionado
          document.getElementById('tab-' + tabName).classList.remove('hidden');
          // Ativar nav correspondente
          document.querySelector(`.nav-btn[data-tab="${tabName}"]`).classList.add('active');

          // Carregar dados espec√≠ficos da aba
          switch(tabName) {
            case 'dashboard': renderDashboard(); break;
            case 'estoque': generateStockReport(); break;
            case 'movimento-pneus': // NOVO CASO
                inicializarSistemaMovimentacao(); 
                // Seleciona o primeiro ve√≠culo por padr√£o se for a primeira vez na aba
                if (!veiculoSelecionado && reportData.veiculos.length > 0) {
                     selecionarVeiculo(reportData.veiculos[0]);
                } else if (veiculoSelecionado) {
                    renderizarDiagramaVeiculo();
                    renderizarPneusDisponiveis();
                    atualizarStatusMontagem();
                }
                break;
            case 'performance': generatePerformanceReport(); break;
            case 'fogos': renderFogosList(); break;
            case 'alertas': renderAlertsList(); break;
            case 'exportar': 
                document.getElementById('startDate').value = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().substring(0, 10);
                document.getElementById('endDate').value = new Date().toISOString().substring(0, 10);
                break;
          }
        });
      });
      
      // 3. Navega√ß√£o inferior
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tabName = this.dataset.tab;
          document.querySelector(`.tab-btn[data-tab="${tabName}"]`).click();
        });
      });
      
      // 4. Iniciar no Dashboard
      document.querySelector('.tab-btn[data-tab="dashboard"]').click();
      
      // 5. Configurar datas iniciais (opcional, apenas para o dashboard)
      const today = new Date().toISOString().substring(0, 10);
      const lastMonth = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().substring(0, 10);
      document.getElementById('startDate').value = lastMonth;
      document.getElementById('endDate').value = today;

      // 6. Atualizar preview quando quantidade mudar
      const fogoQuantidade = document.getElementById('fogoQuantidade');
      if (fogoQuantidade) {
          fogoQuantidade.addEventListener('input', function() {
              const pneuId = document.getElementById('fogoPneuId').value;
              const pneu = reportData.items.find(p => p.id === pneuId);
              if (pneu && parseInt(this.value) > pneu.qty) {
                  this.value = pneu.qty;
                  showNotification(`A quantidade n√£o pode exceder o estoque dispon√≠vel (${pneu.qty}).`, 'warning');
              }
          });
      }
    });

  </script>
</body>
</html>
```
