<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Pneus - Transportes Canarinho</title>

    <!-- CSS PRINCIPAL -->
    <link rel="stylesheet" href="assets/css/style.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Ícones -->
    <script src="https://kit.fontawesome.com/a2d9d5c6e4.js" crossorigin="anonymous"></script>
</head>
<body>

    <!-- ============================================
         CABEÇALHO / MENU SUPERIOR
    ============================================= -->
    <header class="header">
        <div class="logo-area">
            <img src="assets/img/logo.png" class="logo">
            <h1>Controle de Pneus</h1>
        </div>

        <nav class="nav-menu">
            <button class="nav-btn" data-target="container">Container</button>
            <button class="nav-btn" data-target="fogos">Fogos</button>
            <button class="nav-btn" data-target="recapagem">Recapagem</button>
            <button class="nav-btn" data-target="saidas">Saídas</button>
            <button class="nav-btn" data-target="montagem">Montagem de Veículos</button>
            <button class="nav-btn" data-target="alertas">Alertas</button>
            <button class="nav-btn" data-target="historico">Histórico</button>
        </nav>
    </header>


    <!-- ============================================
         CONTEÚDO DAS ABAS
    ============================================= -->
    <main id="conteudo">


        <!-- ============================================
             ABA: CONTAINER
        ============================================= -->
        <section id="aba-container" class="aba">
            <h2>Container</h2>

            <div class="container-grid">

                <div class="container-bloco">
                    <h3>Pneus Novos</h3>
                    <div id="listaPneusNovos" class="lista-container"></div>
                </div>

                <div class="container-bloco">
                    <h3>Pneus Usados</h3>
                    <div id="listaPneusUsados" class="lista-container"></div>
                </div>

                <div class="container-bloco">
                    <h3>Recapagens</h3>
                    <div id="listaRecapagens" class="lista-container"></div>
                </div>

            </div>
        </section>



        <!-- ============================================
             ABA: FOGOS
        ============================================= -->
        <section id="aba-fogos" class="aba">
            <h2>Fogos Disponíveis</h2>
            <div id="fogos-lista" class="fogos-grade"></div>
        </section>



        <!-- ============================================
             ABA: RECAPAGEM
        ============================================= -->
        <section id="aba-recapagem" class="aba">
            <h2>Recapagem</h2>

            <div class="recapagem-form">

                <label>Número do Fogo:</label>
                <input id="recap-numero" type="number" placeholder="Ex: 125">

                <label>Status:</label>
                <select id="recap-status">
                    <option value="Enviado">Enviado</option>
                    <option value="Aguardando">Aguardando</option>
                    <option value="Pronto">Pronto</option>
                </select>

                <button id="btnSalvarRecap" class="btn-primario">Salvar</button>
            </div>

            <div id="listaRecapTotal" class="recap-lista"></div>
        </section>



        <!-- ============================================
             ABA: SAÍDAS
        ============================================= -->
        <section id="aba-saidas" class="aba">
            <h2>Registro de Saídas</h2>

            <div class="saida-form">

                <label>Fogo:</label>
                <input id="saida-fogo" type="number" placeholder="Número do fogo">

                <label>Destino:</label>
                <input id="saida-destino" type="text" placeholder="Ex: Caminhão ABC-1234">

                <label>Data:</label>
                <input id="saida-data" type="date">

                <button id="btnRegistrarSaida" class="btn-primario">Registrar</button>

            </div>

            <div id="listaSaidas" class="lista-saidas"></div>
        </section>

              <!-- ============================================
             ABA: MONTAGEM DE VEÍCULOS (NOVA VERSÃO LEGO)
        ============================================= -->
        <section id="aba-montagem" class="aba">
            <h2>Montagem de Veículos</h2>

            <!-- =============================
                 ÁREA 1 — SELECIONAR VEÍCULO
            ============================== -->
            <div class="painel-selecao-veiculo">

                <div class="linha-selecao">
                    <label>Veículo Selecionado:</label>
                    <select id="selectVeiculoMontagem"></select>

                    <button id="btnCriarVeiculo" class="btn-primario">
                        <i class="fas fa-plus"></i> Novo Veículo
                    </button>
                </div>

                <div class="status-veiculo" id="dadosVeiculoSelecionado">
                    <h3>Dados do Veículo</h3>

                    <p><strong>Placa:</strong> <span id="infoPlaca"></span></p>
                    <p><strong>Modelo:</strong> <span id="infoModelo"></span></p>
                    <p><strong>Tipo:</strong> <span id="infoTipo"></span></p>
                    <p><strong>Total de Eixos:</strong> <span id="infoEixos"></span></p>
                </div>

            </div>




            <!-- =============================
                 ÁREA 2 — EDITOR LEGO DE EIXOS
            ============================== -->
            <div class="editor-lego">

                <!-- Painel esquerdo: Lista de eixos existentes -->
                <div class="lego-eixos-lista">
                    <h3>Eixos do Veículo</h3>

                    <div id="listaEixos"></div>

                    <button id="btnAdicionarEixo" class="btn-secundario">
                        <i class="fas fa-plus-circle"></i> Adicionar Eixo
                    </button>
                </div>


                <!-- Painel central: Montagem visual LEGO -->
                <div class="lego-montagem">
                    <h3>Montagem LEGO</h3>
                    <p class="subinfo">Arraste os eixos para organizar a ordem</p>

                    <div id="espacoMontagemLego" class="lego-area"></div>
                </div>


                <!-- Painel direito: Preview visual do caminhão -->
                <div class="lego-preview">
                    <h3>Visualização do Veículo</h3>

                    <div id="previewVeiculo" class="preview-caminhao"></div>
                </div>

            </div>





            <!-- =============================
                 ÁREA 3 — MONTAGEM DE PNEUS REAL
            ============================== -->
            <div class="montagem-real">

                <h3>Montagem Real dos Pneus</h3>

                <div class="montagem-grid">

                    <!-- Slots do veículo -->
                    <div class="montagem-caminhao-bloco">
                        <h4>Posições</h4>
                        <div id="areaPosicoesVeiculo" class="caminhao-posicoes"></div>
                    </div>

                    <!-- Pneus disponíveis -->
                    <div class="montagem-pneus-bloco">
                        <h4>Pneus Disponíveis</h4>
                        <div id="pneusDisponiveisMontagem" class="pneus-disponiveis-grade"></div>
                    </div>

                </div>

                <!-- Botões -->
                <div class="montagem-botoes">
                    <button id="btnIniciarMontagem" class="btn-primario">
                        <i class="fas fa-hand-paper"></i> Iniciar Montagem
                    </button>

                    <button id="btnFinalizarMontagem" class="btn-sucesso" style="display:none;">
                        <i class="fas fa-check-circle"></i> Finalizar Montagem
                    </button>
                </div>

                <!-- Informações -->
                <div id="montagemInfo" class="montagem-info" style="display:none;">
                    <p><strong>Pneus montados:</strong> <span id="statusPneusMontados">0</span></p>
                    <p><strong>Posições vazias:</strong> <span id="statusPosicoesVazias">0</span></p>
                    <p><strong>Pneus disponíveis:</strong> <span id="statusPneusDisponiveis">0</span></p>
                </div>

            </div>




            <!-- =============================
                 MODAL: CRIAÇÃO / EDIÇÃO DE VEÍCULO
            ============================== -->

            <div id="modalCriarVeiculo" class="modal">
                <div class="modal-content">

                    <h2>Criar Veículo</h2>

                    <label>Placa:</label>
                    <input type="text" id="modalVeiculoPlaca">

                    <label>Modelo:</label>
                    <input type="text" id="modalVeiculoModelo">

                    <label>Tipo:</label>
                    <input type="text" id="modalVeiculoTipo">

                    <!-- Informações gerais -->
                    <div class="modal-row">
                        <label>Quantidade de Eixos:</label>
                        <input type="number" id="modalQuantidadeEixos" min="1" value="2">
                    </div>

                    <button id="btnConfirmarCriarVeiculo" class="btn-primario">Criar</button>
                    <button id="btnCancelarCriarVeiculo" class="btn-perigo">Cancelar</button>

                </div>
            </div>

        </section>

              <!-- ============================================
             ABA: ALERTAS
        ============================================= -->
        <section id="aba-alertas" class="aba">
            <h2>Alertas</h2>

            <div id="listaAlertas" class="alertas-lista"></div>
        </section>



        <!-- ============================================
             ABA: HISTÓRICO
        ============================================= -->
        <section id="aba-historico" class="aba">
            <h2>Histórico Geral</h2>

            <div id="listaHistorico" class="historico-lista"></div>
        </section>



    </main>

    <!-- ============================================
         NOTIFICAÇÕES
    ============================================= -->
    <div id="notificationContainer" class="notification-container"></div>


    <!-- ============================================
         SCRIPTS
    ============================================= -->
    <script src="assets/js/main.js"></script>

</body>
</html>

/* ===============================================
   STYLE.CSS — PARTE 1
   Layout principal, cabeçalho, abas, container
   =============================================== */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Poppins", sans-serif;
}

body {
    background: #f7f7f7;
    color: #222;
}

/* ===========================
   CABEÇALHO / HEADER
=========================== */
.header {
    width: 100%;
    height: 70px;
    background: #005c96; /* cor original do sistema */
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 25px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
}

.logo-area {
    display: flex;
    align-items: center;
    gap: 15px;
}

.logo {
    height: 45px;
}

h1 {
    font-size: 22px;
    color: white;
    font-weight: 600;
}

/* ===========================
   MENU SUPERIOR
=========================== */
.nav-menu {
    display: flex;
    gap: 12px;
}

.nav-btn {
    background: #e3f2ff;
    border: 1px solid #b9dfff;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: 0.2s;
    font-weight: 500;
}

.nav-btn:hover {
    background: #ffffff;
    transform: scale(1.03);
}

.nav-btn.active {
    background: #ffffff;
    border-color: #fff;
    font-weight: 600;
}

/* ===========================
   ABAS / SECTIONS
=========================== */
.aba {
    display: none;
    padding: 25px;
}

.aba h2 {
    margin-bottom: 15px;
    font-size: 22px;
    color: #003e68;
    font-weight: 600;
}

.aba.active {
    display: block;
}

/* ===========================
   GRID PRINCIPAL - CONTAINER
=========================== */
.container-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 25px;
}

.container-bloco {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
}

.container-bloco h3 {
    font-size: 18px;
    margin-bottom: 10px;
    color: #003e68;
}

/* Listas internas */
.lista-container {
    max-height: 350px;
    overflow-y: auto;
    padding-right: 10px;
}

/* ===========================
   FOGOS
=========================== */
.fogos-grade {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px;
}

.fogo-item {
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 8px rgba(0,0,0,0.15);
    text-align: center;
    transition: 0.2s;
}

.fogo-item:hover {
    transform: scale(1.03);
}

.fogo-numero {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 5px;
}

.fogo-status {
    font-size: 14px;
    color: #555;
}

/* ===========================
   RECAPAGEM
=========================== */

.recapagem-form {
    background: white;
    padding: 15px;
    border-radius: 12px;
    display: grid;
    gap: 12px;
    width: 300px;
    box-shadow: 0 0 8px rgba(0,0,0,0.12);
}

.recap-lista {
    margin-top: 20px;
}

/* ===========================
   SAÍDAS
=========================== */
.saida-form {
    background: white;
    padding: 15px;
    border-radius: 12px;
    display: grid;
    gap: 12px;
    width: 350px;
    box-shadow: 0 0 8px rgba(0,0,0,0.12);
}

.lista-saidas {
    margin-top: 20px;
}

/* ===========================
   BOTÕES GERAIS
=========================== */
.btn-primario {
    background: #0077c2;
    color: white;
    padding: 10px 16px;
    border: none;
    border-radius: 7px;
    font-size: 14px;
    cursor: pointer;
    transition: 0.2s;
}

.btn-primario:hover {
    background: #005c96;
}

.btn-secundario {
    background: #e9e9e9;
    padding: 10px 16px;
    border-radius: 7px;
    cursor: pointer;
}

.btn-sucesso {
    background: #2ecc71;
    padding: 10px 16px;
    border-radius: 7px;
    color: white;
    border: none;
    cursor: pointer;
}

.btn-perigo {
    background: #e63946;
    padding: 10px 16px;
    border-radius: 7px;
    color: white;
    border: none;
    cursor: pointer;
}

/* ===========================
   NOTIFICAÇÕES
=========================== */
.notification-container {
    position: fixed;
    right: 20px;
    top: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 2000;
}

.notification {
    padding: 12px 18px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    animation: fadeIn 0.4s ease;
}

.notification.success { background: #2ecc71; }
.notification.error { background: #e74c3c; }
.notification.info { background: #3498db; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
}

/* ===============================================
   STYLE.CSS — PARTE 2
   Editor LEGO, Preview, Montagem de Pneus
   =============================================== */

/* ===========================
   EDITOR LEGO - ESTRUTURA
=========================== */
.editor-lego {
    display: grid;
    grid-template-columns: 1fr 2fr 1.2fr;
    gap: 25px;
    margin-top: 25px;
}

.lego-eixos-lista,
.lego-montagem,
.lego-preview {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 8px rgba(0,0,0,0.12);
}

.lego-eixos-lista h3,
.lego-montagem h3,
.lego-preview h3 {
    margin-bottom: 12px;
    color: #003e68;
}



/* ===========================
   LISTA DE EIXOS
=========================== */
#listaEixos {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.eixo-item {
    background: #f5faff;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #cce7ff;
    cursor: grab;
    transition: 0.2s;
}

.eixo-item:hover {
    background: #e9f4ff;
    transform: scale(1.02);
}

.eixo-item span {
    font-weight: 500;
    color: #004772;
}



/* ===========================
   ÁREA LEGO DE MONTAGEM
=========================== */
.lego-area {
    min-height: 300px;
    border: 2px dashed #cbdffb;
    border-radius: 12px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.lego-eixo-bloco {
    background: #e3f2ff;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #b9dfff;
    cursor: grab;
    display: flex;
    gap: 10px;
    align-items: center;
    transition: 0.2s;
}

.lego-eixo-bloco:hover {
    background: #d7eaff;
}

.lego-eixo-bloco .eixo-label {
    font-weight: 600;
    font-size: 15px;
    color: #004772;
}



/* ===========================
   SLOTS DO LEGO
=========================== */

.lego-slots {
    display: flex;
    gap: 6px;
}

.slot-simples {
    width: 22px;
    height: 22px;
    background: #ffffff;
    border: 2px solid #004772;
    border-radius: 4px;
}

.slot-duplo {
    width: 22px;
    height: 22px;
    background: #ffffff;
    border: 2px solid #004772;
    border-radius: 4px;
}



/* ===========================
   PREVIEW DO CAMINHÃO
=========================== */
.preview-caminhao {
    min-height: 340px;
    background: #f1faff;
    border-radius: 12px;
    padding: 18px;
    border: 1px solid #d2e5ff;
}

.preview-eixo {
    margin-bottom: 12px;
    display: flex;
    gap: 14px;
    align-items: center;
}

.preview-eixo span {
    font-weight: 600;
    font-size: 15px;
}



/* ===========================
   MONTAGEM REAL
=========================== */

.montagem-real {
    margin-top: 40px;
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 0 8px rgba(0,0,0,0.12);
}

.montagem-grid {
    display: grid;
    grid-template-columns: 1.5fr 1fr;
    gap: 30px;
    margin-top: 20px;
}

.caminhao-posicoes {
    background: #f8fbff;
    border: 1px solid #d5e7ff;
    border-radius: 12px;
    padding: 15px;
    min-height: 300px;
    display: grid;
    gap: 12px;
}

.pneus-disponiveis-grade {
    background: #f8fbff;
    border: 1px solid #d5e7ff;
    border-radius: 12px;
    padding: 15px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 12px;
}



/* ===========================
   SLOT REAL DO CAMINHÃO
=========================== */
.tire-slot {
    width: 50px;
    height: 50px;
    border: 2px dashed #90b7d5;
    border-radius: 10px;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: #005c96;
    cursor: pointer;
    transition: 0.2s;
}

.tire-slot.filled {
    border-style: solid;
    background: #d7efff;
    color: #003e68;
}

.tire-slot:hover {
    transform: scale(1.05);
}



/* ===========================
   PNEU DISPONÍVEL
=========================== */
.pneu-item {
    width: 70px;
    height: 70px;
    background: #ffffff;
    border: 2px solid #004772;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    cursor: grab;
    transition: 0.2s;
}

.pneu-item:hover {
    background: #e9f6ff;
    transform: scale(1.05);
}



/* ===========================
   BOTÕES DA MONTAGEM
=========================== */
.montagem-botoes {
    margin-top: 20px;
    display: flex;
    gap: 12px;
}



/* ===========================
   MODAL - CRIAÇÃO DE VEÍCULO
=========================== */
.modal {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.45);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 3000;
}

.modal-content {
    background: white;
    padding: 25px;
    border-radius: 14px;
    width: 380px;
    display: grid;
    gap: 16px;
}

.modal-content input,
.modal-content select {
    padding: 9px;
    border-radius: 6px;
    border: 1px solid #cbd3da;
}



/* ===========================
   RESPONSIVIDADE
=========================== */

@media (max-width: 980px) {
    .editor-lego {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 600px) {
    .montagem-grid {
        grid-template-columns: 1fr;
    }
}

/* ============================================================
   main.js — PARTE 1
   Sistema completo reestruturado, compatível com pneus.html
   ============================================================ */

/* ============================================================
   VARIÁVEIS PRINCIPAIS
   ============================================================ */
let reportData = {
    container: [],
    fogos: [],
    recapagem: [],
    saidas: [],
    alertas: [],
    historico: [],
    veiculos: []
};

let veiculoSelecionado = null;
let modoMontagem = false;

// Armazena a construção LEGO antes de salvar
let montagemTemporaria = {
    eixos: [],
    posicoesOcupadas: {},
    pneusMontados: [],
    dataInicio: null
};

/* ============================================================
   INICIALIZAÇÃO
   ============================================================ */

document.addEventListener("DOMContentLoaded", () => {
    carregarDados();
    inicializarAbas();
    inicializarEventosGerais();
    renderizarTudo();
});

/* ============================================================
   CARREGAMENTO E SALVAMENTO
   ============================================================ */

function carregarDados() {
    const data = localStorage.getItem("pneusData");
    if (data) {
        reportData = JSON.parse(data);
    }
}

function saveData() {
    localStorage.setItem("pneusData", JSON.stringify(reportData));
}

/* ============================================================
   CONTROLE DE ABAS
   ============================================================ */

function inicializarAbas() {
    const botoes = document.querySelectorAll(".nav-btn");
    const abas = document.querySelectorAll(".aba");

    botoes.forEach(btn => {
        btn.addEventListener("click", () => {
            botoes.forEach(b => b.classList.remove("active"));
            abas.forEach(a => a.classList.remove("active"));

            btn.classList.add("active");
            document.getElementById(`aba-${btn.dataset.target}`).classList.add("active");
        });
    });

    // Ativar primeira aba
    botoes[0].click();
}

/* ============================================================
   NOTIFICAÇÕES
   ============================================================ */

function showNotification(msg, type = "info") {
    const container = document.getElementById("notificationContainer");
    const div = document.createElement("div");
    div.className = `notification ${type}`;
    div.textContent = msg;

    container.appendChild(div);

    setTimeout(() => {
        div.style.opacity = "0";
        setTimeout(() => div.remove(), 500);
    }, 2500);
}

/* ============================================================
   RENDERIZAÇÃO GERAL
   ============================================================ */

function renderizarTudo() {
    renderizarContainer();
    renderizarFogos();
    renderizarRecapagem();
    renderizarSaidas();
    renderizarAlertas();
    renderizarHistorico();
    renderizarVeiculosSelect();
}

/* ============================================================
   ABA CONTAINER
   ============================================================ */

function renderizarContainer() {
    const novos = document.getElementById("listaPneusNovos");
    const usados = document.getElementById("listaPneusUsados");
    const recap = document.getElementById("listaRecapagens");

    novos.innerHTML = "";
    usados.innerHTML = "";
    recap.innerHTML = "";

    reportData.container.forEach(item => {
        const div = document.createElement("div");
        div.className = "fogo-item";

        div.innerHTML = `
            <div class="fogo-numero">#${item.numero}</div>
            <div class="fogo-status">${item.status}</div>
        `;

        if (item.status === "Novo") novos.appendChild(div);
        else if (item.status === "Usado") usados.appendChild(div);
        else recap.appendChild(div);
    });
}

/* ============================================================
   ABA FOGOS
   ============================================================ */

function renderizarFogos() {
    const lista = document.getElementById("fogos-lista");
    lista.innerHTML = "";

    reportData.fogos.forEach(fogo => {
        const div = document.createElement("div");
        div.className = "fogo-item";

        div.innerHTML = `
            <div class="fogo-numero">#${fogo.numero}</div>
            <div class="fogo-status">${fogo.veiculo ? fogo.veiculo : "Disponível"}</div>
        `;

        lista.appendChild(div);
    });
}

/* ============================================================
   ABA RECAPAGEM
   ============================================================ */

function renderizarRecapagem() {
    const lista = document.getElementById("listaRecapTotal");
    lista.innerHTML = "";

    reportData.recapagem.forEach(item => {
        const div = document.createElement("div");
        div.className = "fogo-item";

        div.innerHTML = `
            <div class="fogo-numero">#${item.numero}</div>
            <div class="fogo-status">${item.status}</div>
        `;

        lista.appendChild(div);
    });
}

document.getElementById("btnSalvarRecap").addEventListener("click", () => {
    const num = document.getElementById("recap-numero").value;
    const status = document.getElementById("recap-status").value;

    if (!num) return showNotification("Informe o número do fogo!", "error");

    reportData.recapagem.push({ numero: num, status });
    saveData();
    renderizarRecapagem();

    showNotification("Recapagem registrada!", "success");
});

/* ============================================================
   ABA SAÍDAS
   ============================================================ */

function renderizarSaidas() {
    const lista = document.getElementById("listaSaidas");
    lista.innerHTML = "";

    reportData.saidas.forEach(s => {
        const div = document.createElement("div");
        div.className = "fogo-item";

        div.innerHTML = `
            <div class="fogo-numero">#${s.fogo}</div>
            <div class="fogo-status">${s.destino}</div>
            <div class="fogo-status">${s.data}</div>
        `;

        lista.appendChild(div);
    });
}

document.getElementById("btnRegistrarSaida").addEventListener("click", () => {
    const fogo = document.getElementById("saida-fogo").value;
    const destino = document.getElementById("saida-destino").value;
    const data = document.getElementById("saida-data").value;

    if (!fogo || !destino || !data)
        return showNotification("Preencha todos os campos!", "error");

    reportData.saidas.push({ fogo, destino, data });
    saveData();
    renderizarSaidas();

    showNotification("Saída registrada!", "success");
});

/* ============================================================
   ABA ALERTAS
   ============================================================ */

function renderizarAlertas() {
    const lista = document.getElementById("listaAlertas");
    lista.innerHTML = "";

    reportData.alertas.forEach(alerta => {
        const div = document.createElement("div");
        div.className = "notification info";
        div.textContent = alerta;
        lista.appendChild(div);
    });
}

/* ============================================================
   ABA HISTÓRICO
   ============================================================ */

function renderizarHistorico() {
    const lista = document.getElementById("listaHistorico");
    lista.innerHTML = "";

    reportData.historico.forEach(reg => {
        const div = document.createElement("div");
        div.className = "fogo-item";

        div.innerHTML = `
            <div class="fogo-numero">${reg.acao}</div>
            <div class="fogo-status">${reg.data}</div>
        `;

        lista.appendChild(div);
    });
}

/* ============================================================
   VEÍCULOS — SELECT PRINCIPAL
   ============================================================ */

function renderizarVeiculosSelect() {
    const select = document.getElementById("selectVeiculoMontagem");
    select.innerHTML = "";

    reportData.veiculos.forEach(v => {
        const op = document.createElement("option");
        op.value = v.placa;
        op.textContent = `${v.placa} — ${v.modelo}`;
        select.appendChild(op);
    });

    select.addEventListener("change", () => {
        selecionarVeiculo(select.value);
    });
}

function selecionarVeiculo(placa) {
    veiculoSelecionado = reportData.veiculos.find(v => v.placa === placa);
    if (!veiculoSelecionado) return;

    document.getElementById("infoPlaca").textContent = veiculoSelecionado.placa;
    document.getElementById("infoModelo").textContent = veiculoSelecionado.modelo;
    document.getElementById("infoTipo").textContent = veiculoSelecionado.tipo;
    document.getElementById("infoEixos").textContent = veiculoSelecionado.eixos.length;

    renderizarEixosLEGO();
    renderizarPreviewVeiculo();
    renderizarPosicoesMontagem();
    renderizarPneusDisponiveisMontagem();
}

/* ============================================================
   PARTE 2 — SISTEMA LEGO (EIXOS + PREVIEW)
   ============================================================ */

/* ============================================================
   CRIAÇÃO DE VEÍCULOS
   ============================================================ */

document.getElementById("btnCriarVeiculo").addEventListener("click", () => {
    document.getElementById("modalCriarVeiculo").style.display = "flex";
});

document.getElementById("btnCancelarCriarVeiculo").addEventListener("click", () => {
    document.getElementById("modalCriarVeiculo").style.display = "none";
});

document.getElementById("btnConfirmarCriarVeiculo").addEventListener("click", () => {
    const placa = document.getElementById("modalVeiculoPlaca").value.trim();
    const modelo = document.getElementById("modalVeiculoModelo").value.trim();
    const tipo = document.getElementById("modalVeiculoTipo").value.trim();
    const qtEixos = Number(document.getElementById("modalQuantidadeEixos").value);

    if (!placa || !modelo || !tipo || qtEixos < 1) {
        return showNotification("Preencha todos os campos!", "error");
    }

    // Verifica duplicidade
    if (reportData.veiculos.find(v => v.placa === placa)) {
        return showNotification("Veículo já cadastrado!", "error");
    }

    const novo = {
        placa,
        modelo,
        tipo,
        eixos: []
    };

    // Cria eixos básicos
    for (let i = 1; i <= qtEixos; i++) {
        novo.eixos.push({
            id: `E${i}`,
            tipo: "simples", // simples ou duplo
            slots: gerarSlotsDoEixo(`E${i}`, "simples")
        });
    }

    reportData.veiculos.push(novo);
    saveData();

    document.getElementById("modalCriarVeiculo").style.display = "none";
    showNotification("Veículo criado!", "success");

    renderizarVeiculosSelect();
    selecionarVeiculo(placa);
});


/* ============================================================
   GERAR SLOTS DE UM EIXO
   ============================================================ */

function gerarSlotsDoEixo(eixoID, tipo) {
    let slots = [];

    if (tipo === "simples") {
        slots.push({ id: `${eixoID}-SL1`, lado: "E", fogo: null });
        slots.push({ id: `${eixoID}-SL2`, lado: "D", fogo: null });
    }

    if (tipo === "duplo") {
        slots.push({ id: `${eixoID}-SL1`, lado: "EE", fogo: null });
        slots.push({ id: `${eixoID}-SL2`, lado: "ED", fogo: null });
        slots.push({ id: `${eixoID}-SL3`, lado: "DE", fogo: null });
        slots.push({ id: `${eixoID}-SL4`, lado: "DD", fogo: null });
    }

    return slots;
}


/* ============================================================
   RENDERIZAR LISTA DE EIXOS (MENU ESQUERDO)
   ============================================================ */

function renderizarEixosLEGO() {
    const lista = document.getElementById("listaEixos");
    lista.innerHTML = "";

    if (!veiculoSelecionado) return;

    veiculoSelecionado.eixos.forEach(eixo => {
        const div = document.createElement("div");
        div.className = "eixo-item";
        div.draggable = true;
        div.dataset.eixo = eixo.id;

        div.innerHTML = `
            <span>${eixo.id} — ${eixo.tipo.toUpperCase()}</span>
            <div class="lego-slots">
                ${eixo.slots.map(s => `<div class="slot-simples"></div>`).join("")}
            </div>
        `;

        // Eventos de drag
        div.addEventListener("dragstart", eixoDragStart);
        div.addEventListener("dragover", eixoDragOver);
        div.addEventListener("drop", eixoDrop);

        lista.appendChild(div);
    });

    renderizarMontagemLEGO();
}


/* ============================================================
   DRAG & DROP — ORDEM DOS EIXOS
   ============================================================ */

let eixoArrastado = null;

function eixoDragStart(e) {
    eixoArrastado = e.target.dataset.eixo;
}

function eixoDragOver(e) {
    e.preventDefault();
}

function eixoDrop(e) {
    const alvo = e.target.closest(".eixo-item");
    if (!alvo) return;

    const eixoDestino = alvo.dataset.eixo;

    if (eixoDestino === eixoArrastado) return;

    const indexOrigem = veiculoSelecionado.eixos.findIndex(e => e.id === eixoArrastado);
    const indexDestino = veiculoSelecionado.eixos.findIndex(e => e.id === eixoDestino);

    // Troca posições
    const temp = veiculoSelecionado.eixos[indexOrigem];
    veiculoSelecionado.eixos[indexOrigem] = veiculoSelecionado.eixos[indexDestino];
    veiculoSelecionado.eixos[indexDestino] = temp;

    saveData();
    renderizarEixosLEGO();
    renderizarPreviewVeiculo();
    renderizarPosicoesMontagem();
}


/* ============================================================
   RENDERIZAR MONTAGEM LEGO (MEIO)
   ============================================================ */

function renderizarMontagemLEGO() {
    const area = document.getElementById("espacoMontagemLego");
    area.innerHTML = "";

    veiculoSelecionado.eixos.forEach(eixo => {
        const bloco = document.createElement("div");
        bloco.className = "lego-eixo-bloco";
        bloco.draggable = true;
        bloco.dataset.eixo = eixo.id;

        bloco.innerHTML = `
            <span class="eixo-label">${eixo.id}</span>
            <div class="lego-slots">
                ${eixo.slots.map(s => `<div class="slot-simples"></div>`).join("")}
            </div>
        `;

        // Drag do bloco LEGO
        bloco.addEventListener("dragstart", eixoDragStart);
        bloco.addEventListener("dragover", eixoDragOver);
        bloco.addEventListener("drop", eixoDrop);

        area.appendChild(bloco);
    });
}


/* ============================================================
   ALTERAR TIPO DE EIXO (simples ↔ duplo)
   ============================================================ */

function alterarTipoEixo(idEixo, novoTipo) {
    const eixo = veiculoSelecionado.eixos.find(e => e.id === idEixo);
    if (!eixo) return;

    eixo.tipo = novoTipo;
    eixo.slots = gerarSlotsDoEixo(idEixo, novoTipo);

    saveData();
    renderizarEixosLEGO();
    renderizarPreviewVeiculo();
    renderizarPosicoesMontagem();
}


/* ============================================================
   RENDERIZAR PREVIEW DO CAMINHÃO (PAINEL DIREITO)
   ============================================================ */

function renderizarPreviewVeiculo() {
    const preview = document.getElementById("previewVeiculo");
    preview.innerHTML = "";

    if (!veiculoSelecionado) return;

    veiculoSelecionado.eixos.forEach(eixo => {
        const div = document.createElement("div");
        div.className = "preview-eixo";

        div.innerHTML = `
            <span>${eixo.id} (${eixo.tipo})</span>
            <div class="lego-slots">
                ${eixo.slots.map(s => `<div class="slot-simples"></div>`).join("")}
            </div>
        `;

        preview.appendChild(div);
    });
}

      /* ============================================================
   PARTE 3 — MONTAGEM REAL DOS PNEUS
   ============================================================ */

/* ============================================================
   RENDERIZAR POSIÇÕES DO CAMINHÃO (ÁREA ESQUERDA)
   ============================================================ */

function renderizarPosicoesMontagem() {
    const area = document.getElementById("areaPosicoesVeiculo");
    area.innerHTML = "";

    if (!veiculoSelecionado) return;

    veiculoSelecionado.eixos.forEach(eixo => {
        const bloco = document.createElement("div");
        bloco.className = "montagem-eixo";

        bloco.innerHTML = `<h4>${eixo.id} (${eixo.tipo})</h4>`;

        const grade = document.createElement("div");
        grade.className = "montagem-eixo-grade";

        eixo.slots.forEach(slot => {
            const div = document.createElement("div");
            div.className = "tire-slot";
            div.dataset.posicao = slot.id;

            if (slot.fogo !== null) {
                div.classList.add("filled");
                div.textContent = slot.fogo;
            } else {
                div.textContent = "";
            }

            // Permitir drag & drop
            div.addEventListener("dragover", slotDragOver);
            div.addEventListener("drop", slotDrop);

            // Remoção durante montagem
            if (modoMontagem && slot.fogo !== null) {
                div.style.cursor = "pointer";
                div.title = "Clique para remover";
                div.addEventListener("click", () => {
                    removerPneuPosicao(slot.id);
                });
            }

            grade.appendChild(div);
        });

        bloco.appendChild(grade);
        area.appendChild(bloco);
    });
}


/* ============================================================
   RENDERIZAR PNEUS DISPONÍVEIS (ÁREA DIREITA)
   ============================================================ */

function renderizarPneusDisponiveisMontagem() {
    const lista = document.getElementById("pneusDisponiveisMontagem");
    lista.innerHTML = "";

    if (!reportData.fogos) return;

    reportData.fogos.forEach(fogo => {
        // Pneu só aparece se estiver disponível
        if (fogo.veiculo === null || fogo.veiculo === "" || fogo.veiculo === undefined) {
            const div = document.createElement("div");
            div.className = "pneu-item";
            div.draggable = true;
            div.dataset.fogo = fogo.numero;
            div.textContent = fogo.numero;

            div.addEventListener("dragstart", pneuDragStart);

            lista.appendChild(div);
        }
    });
}

/* ============================================================
   DRAG & DROP – PNEUS
   ============================================================ */

let pneuArrastado = null;

function pneuDragStart(e) {
    pneuArrastado = e.target.dataset.fogo;
}

function slotDragOver(e) {
    e.preventDefault();
}

function slotDrop(e) {
    e.preventDefault();
    const posicao = e.target.dataset.posicao;

    if (!modoMontagem)
        return showNotification("Clique em INICIAR MONTAGEM primeiro!", "error");

    if (!pneuArrastado)
        return;

    aplicarPneuNaPosicao(pneuArrastado, posicao);

    pneuArrastado = null;
}


/* ============================================================
   APLICAR PNEU NA POSIÇÃO
   ============================================================ */

function aplicarPneuNaPosicao(numeroFogo, posicao) {
    if (!veiculoSelecionado) return;

    const [idEixo] = posicao.split("-");

    const eixo = veiculoSelecionado.eixos.find(e => e.id === idEixo);
    if (!eixo) return;

    // Remove pneu anterior de todas as posições temporárias
    for (let e of veiculoSelecionado.eixos) {
        for (let s of e.slots) {
            if (s.fogo === numeroFogo) {
                s.fogo = null;
            }
        }
    }

    // Verificar problema de duplicidade
    eixo.slots.forEach(s => {
        if (s.id === posicao) s.fogo = numeroFogo;
    });

    salvarHistorico(`Montado pneu ${numeroFogo} na posição ${posicao}`);

    renderizarPosicoesMontagem();
    renderizarPneusDisponiveisMontagem();
    atualizarStatusMontagem();
}


/* ============================================================
   REMOVER PNEU DE UMA POSIÇÃO
   ============================================================ */

function removerPneuPosicao(posicao) {
    const [idEixo] = posicao.split("-");
    const eixo = veiculoSelecionado.eixos.find(e => e.id === idEixo);
    if (!eixo) return;

    const slot = eixo.slots.find(s => s.id === posicao);
    if (!slot) return;

    if (slot.fogo === null) return;

    const numero = slot.fogo;
    slot.fogo = null;

    salvarHistorico(`Pneu ${numero} removido da posição ${posicao}`);

    renderizarPosicoesMontagem();
    renderizarPneusDisponiveisMontagem();
    atualizarStatusMontagem();
}


/* ============================================================
   STATUS DA MONTAGEM
   ============================================================ */

function atualizarStatusMontagem() {
    try {
        if (!veiculoSelecionado) return;

        let total = 0;
        let montados = 0;

        veiculoSelecionado.eixos.forEach(e => {
            total += e.slots.length;
            e.slots.forEach(s => {
                if (s.fogo) montados++;
            });
        });

        document.getElementById("statusPneusMontados").textContent = montados;
        document.getElementById("statusPosicoesVazias").textContent = total - montados;

        const disponiveis = reportData.fogos.filter(f => !f.veiculo || f.veiculo === "");
        document.getElementById("statusPneusDisponiveis").textContent = disponiveis.length;

    } catch (e) {
        console.error("Erro status montagem:", e);
    }
}


/* ============================================================
   BOTÃO INICIAR MONTAGEM
   ============================================================ */

document.getElementById("btnIniciarMontagem").addEventListener("click", () => {
    if (!veiculoSelecionado)
        return showNotification("Selecione um veículo!", "error");

    modoMontagem = true;
    montagemTemporaria.dataInicio = new Date();

    document.getElementById("btnIniciarMontagem").style.display = "none";
    document.getElementById("btnFinalizarMontagem").style.display = "inline-block";
    document.getElementById("montagemInfo").style.display = "block";

    showNotification("Modo Montagem ativado!", "success");

    renderizarPosicoesMontagem();
});


/* ============================================================
   BOTÃO FINALIZAR MONTAGEM
   ============================================================ */

document.getElementById("btnFinalizarMontagem").addEventListener("click", () => {
    if (!modoMontagem) return;

    if (!confirm("Deseja finalizar a montagem?")) return;

    aplicarMontagemFinal();

    modoMontagem = false;

    document.getElementById("btnIniciarMontagem").style.display = "inline-block";
    document.getElementById("btnFinalizarMontagem").style.display = "none";
    document.getElementById("montagemInfo").style.display = "none";

    showNotification("Montagem finalizada!", "success");

    renderizarPneusDisponiveisMontagem();
    renderizarPosicoesMontagem();
    renderizarPreviewVeiculo();
});


/* ============================================================
   SALVAR MONTAGEM FINAL
   ============================================================ */

function aplicarMontagemFinal() {
    veiculoSelecionado.eixos.forEach(eixo => {
        eixo.slots.forEach(slot => {
            const numero = slot.fogo;

            // Se tem pneu, atualiza no banco
            if (numero) {
                const pneu = reportData.fogos.find(f => f.numero == numero);
                if (pneu) {
                    pneu.veiculo = veiculoSelecionado.placa;
                    pneu.posicao = slot.id;
                }
            }
        });
    });

    saveData();

    salvarHistorico(`Montagem finalizada no veículo ${veiculoSelecionado.placa}`);
}


/* ============================================================
   HISTÓRICO
   ============================================================ */

function salvarHistorico(acao) {
    reportData.historico.push({
        acao,
        data: new Date().toLocaleString()
    });

    saveData();
    renderizarHistorico();
}

      /* ============================================================
   PARTE 4 — FUNÇÕES FINAIS, UTILIDADES E INTEGRAÇÕES
   ============================================================ */

/* ============================================================
   ATUALIZAR INFORMAÇÕES DO VEÍCULO SELECIONADO
   ============================================================ */
function atualizarInfoVeiculo() {
    if (!veiculoSelecionado) return;

    document.getElementById("infoPlaca").textContent = veiculoSelecionado.placa;
    document.getElementById("infoModelo").textContent = veiculoSelecionado.modelo;
    document.getElementById("infoTipo").textContent = veiculoSelecionado.tipo;
    document.getElementById("infoEixos").textContent = veiculoSelecionado.eixos.length;
}

/* ============================================================
   RECARREGAR SISTEMA COMPLETO
   ============================================================ */
function recarregarSistema() {
    renderizarContainer();
    renderizarFogos();
    renderizarRecapagem();
    renderizarSaidas();
    renderizarAlertas();
    renderizarHistorico();
    renderizarVeiculosSelect();

    if (veiculoSelecionado) {
        renderizarEixosLEGO();
        renderizarPreviewVeiculo();
        renderizarPosicoesMontagem();
        renderizarPneusDisponiveisMontagem();
    }
}

/* ============================================================
   FUNÇÕES DE VALIDAÇÃO
   ============================================================ */

function existeFogo(numero) {
    return reportData.fogos.some(f => f.numero == numero);
}

function existePneuMontado(numero) {
    return reportData.veiculos.some(v =>
        v.eixos.some(e =>
            e.slots.some(s => s.fogo == numero)
        )
    );
}

/* ============================================================
   ADICIONAR FOGO AO SISTEMA (CASO OUTRAS ABAS USEM)
   ============================================================ */
function adicionarFogo(numero) {
    if (!numero) return false;

    if (existeFogo(numero)) {
        showNotification("Esse fogo já existe!", "error");
        return false;
    }

    reportData.fogos.push({
        numero,
        veiculo: null,
        posicao: null
    });

    saveData();
    renderizarFogos();
    renderizarPneusDisponiveisMontagem();
    return true;
}

/* ============================================================
   REMOVER FOGO DO SISTEMA
   ============================================================ */
function removerFogo(numero) {
    reportData.fogos = reportData.fogos.filter(f => f.numero != numero);

    // remove de veículos
    reportData.veiculos.forEach(v => {
        v.eixos.forEach(e => {
            e.slots.forEach(s => {
                if (s.fogo == numero) s.fogo = null;
            });
        });
    });

    saveData();
    recarregarSistema();
}

/* ============================================================
   LIMPAR MONTAGEM TEMPORÁRIA (SEGURANÇA)
   ============================================================ */
function limparMontagemTemporaria() {
    montagemTemporaria = {
        eixos: [],
        posicoesOcupadas: {},
        pneusMontados: [],
        dataInicio: null
    };
}

/* ============================================================
   RESETAR VEÍCULO (OPCIONAL)
   ============================================================ */
function resetarVeiculo(placa) {
    const v = reportData.veiculos.find(x => x.placa === placa);
    if (!v) return;

    v.eixos.forEach(e => {
        e.slots.forEach(s => {
            s.fogo = null;
        });
    });

    reportData.fogos.forEach(f => {
        if (f.veiculo === placa) {
            f.veiculo = null;
            f.posicao = null;
        }
    });

    saveData();
    recarregarSistema();
    showNotification("Veículo resetado!", "success");
}

/* ============================================================
   EXPORTAR DADOS (BACKUP)
   ============================================================ */
function exportarDados() {
    const dados = JSON.stringify(reportData, null, 2);
    const blob = new Blob([dados], { type: "application/json" });

    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "pneus_backup.json";
    a.click();

    showNotification("Backup exportado!", "success");
}

/* ============================================================
   IMPORTAR DADOS
   ============================================================ */
function importarDados(json) {
    try {
        reportData = JSON.parse(json);
        saveData();
        recarregarSistema();
        showNotification("Backup importado!", "success");
    } catch (e) {
        showNotification("Arquivo inválido!", "error");
    }
}

/* ============================================================
   LIMPAR TODO O SISTEMA (PERIGOSO)
   ============================================================ */
function wipeAll() {
    if (!confirm("Tem certeza que deseja APAGAR TUDO?")) return;

    reportData = {
        container: [],
        fogos: [],
        recapagem: [],
        saidas: [],
        alertas: [],
        historico: [],
        veiculos: []
    };

    saveData();
    recarregarSistema();
    showNotification("Sistema resetado!", "success");
}

/* ============================================================
   FILTROS E BUSCAS (PREPARADO PARA FUTURAS ABAS)
   ============================================================ */
function filtrarFogosPorStatus(status) {
    return reportData.fogos.filter(f => f.status === status);
}

function buscarFogo(numero) {
    return reportData.fogos.find(f => f.numero == numero);
}

/* ============================================================
   INICIALIZAÇÃO FINAL DO SISTEMA
   ============================================================ */

document.addEventListener("DOMContentLoaded", () => {
    carregarDados();
    inicializarAbas();
    inicializarEventosGerais();
    recarregarSistema();
});

/* ============================================================
   EVENTOS GERAIS DO SISTEMA
   ============================================================ */
function inicializarEventosGerais() {
    // Placeholder, caso você queira adicionar novos botões depois.
    console.log("Eventos gerais carregados.");
}

/* ============================================================
   DEBUG (OPCIONAL — PODE REMOVER)
   ============================================================ */
console.log("%cSistema de Controle de Pneus carregado com sucesso!",
            "background:#005c96;color:white;padding:6px;border-radius:4px;");
