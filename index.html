<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Transportes Canarinho - Controle de Pneus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --accent: #38bdf8;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --danger: #f43f5e;
      --warn: #f97316;
      --success: #10b981;
      --radius: 12px;
    }
    * {
      box-sizing: border-box;
      font-family: "Segoe UI", system-ui, sans-serif;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    header {
      padding: 16px 24px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.12);
      background: rgba(2, 6, 23, 0.78);
    }
    header h1 {
      margin: 0;
      font-size: 1.3rem;
    }
    main {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .tab-btn {
      background: rgba(15, 23, 42, 0.3);
      border: 1px solid rgba(148, 163, 184, 0.2);
      color: var(--text);
      padding: 8px 16px;
      border-radius: var(--radius);
      cursor: pointer;
    }
    .tab-btn.active {
      background: var(--accent);
      color: #020617;
    }
    .hidden {
      display: none;
    }
    .toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    .input, select, button {
      padding: 8px 12px;
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(15, 23, 42, 0.6);
      color: var(--text);
    }
    button {
      background: var(--accent);
      color: #020617;
      border: none;
      font-weight: 600;
      cursor: pointer;
    }
    .card {
      background: rgba(2, 6, 23, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: var(--radius);
      overflow: hidden;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }
    th {
      background: rgba(15, 23, 42, 0.4);
      color: var(--muted);
      font-weight: 600;
    }
    .badge {
      background: rgba(15, 23, 42, 0.6);
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.8rem;
    }
    .sulco-critico {
      background: rgba(244, 63, 94, 0.2);
      color: #ffe4e6;
    }
    .sulco-alerta {
      background: rgba(249, 115, 22, 0.2);
      color: #ffedd5;
    }
    .sulco-ok {
      background: rgba(16, 185, 129, 0.2);
      color: #d1fae5;
    }
    .qty-low {
      background: rgba(244, 63, 94, 0.2);
      color: #ffe4e6;
    }
    .actions {
      display: flex;
      gap: 5px;
    }
    .btn-xs {
      padding: 4px 8px;
      font-size: 0.8rem;
      background: rgba(15, 23, 42, 0.4);
      color: var(--text);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 6px;
      cursor: pointer;
    }
    .btn-success {
      background: rgba(16, 185, 129, 0.2);
      color: #d1fae5;
    }
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(2, 6, 23, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal {
      background: var(--bg);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: var(--radius);
      padding: 20px;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal h2 {
      margin-top: 0;
    }
    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 15px;
    }
    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    .stat-card {
      background: rgba(15, 23, 42, 0.4);
      padding: 15px;
      border-radius: var(--radius);
      text-align: center;
    }
    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent);
    }
    .stat-label {
      font-size: 0.8rem;
      color: var(--muted);
    }
    .alert-banner {
      background: rgba(249, 115, 22, 0.2);
      border: 1px solid rgba(249, 115, 22, 0.4);
      padding: 10px;
      border-radius: var(--radius);
      margin-bottom: 15px;
    }
    .alert-banner.critical {
      background: rgba(244, 63, 94, 0.2);
      border-color: rgba(244, 63, 94, 0.4);
    }
    
    /* Novos estilos para a melhoria */
    .pneu-image {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    .image-upload-container {
      border: 2px dashed rgba(148, 163, 184, 0.3);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
      margin-bottom: 15px;
      cursor: pointer;
      transition: border-color 0.3s;
    }
    .image-upload-container:hover {
      border-color: var(--accent);
    }
    .image-upload-container img {
      max-width: 100%;
      max-height: 200px;
      border-radius: var(--radius);
    }
    .image-preview {
      display: none;
      margin-top: 10px;
    }
    .estoque-baixo {
      background: rgba(244, 63, 94, 0.1);
      border-left: 3px solid var(--danger);
    }
    .full-width {
      grid-column: 1 / -1;
    }
    .pneu-card {
      display: flex;
      align-items: center;
      gap: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>üöö Transportes Canarinho - Controle de Pneus</h1>
  </header>
  
  <main>
	 <div class="tabs">
	  <button class="tab-btn active" data-tab="estoque">Estoque</button>
	  <button class="tab-btn" data-tab="fogo">Controle por Fogo</button>
	  <button class="tab-btn" data-tab="recapagem">Recapagem</button>
	  <button class="tab-btn" data-tab="descarte">Descarte</button>
	  <button class="tab-btn" data-tab="venda">Vendas</button>
	  <button class="tab-btn" data-tab="saidas">Sa√≠das</button>
	  <button class="tab-btn" data-tab="alertas">Alertas</button>
	</div>

    <!-- ALERTAS -->
    <div id="tab-alertas" class="hidden">
      <div class="card">
        <div style="padding: 15px;">
          <h3>Alertas do Sistema</h3>
          <div id="alertsContainer"></div>
        </div>
      </div>
    </div>

    <!-- ESTOQUE -->
    <div id="tab-estoque">
      <div class="stats-grid" id="statsContainer"></div>

      <div class="toolbar">
        <input type="text" id="searchInput" class="input" placeholder="Buscar por ID, medida, DOT..." style="flex:1;">
        <select id="statusFilter" class="input">
          <option value="">Todos status</option>
          <option value="Novo">Novo</option>
          <option value="Usado">Usado</option>
          <option value="Reformado">Reformado</option>
        </select>
        <button id="addItemBtn">+ Novo Pneu</button>
      </div>

      <div class="card">
        <div style="padding: 15px;">
          <h3>Estoque de Pneus</h3>
          <div id="itemsCount" style="color: var(--muted); font-size: 0.9rem; margin-bottom: 10px;"></div>
        </div>
        <div style="overflow-x: auto;">
          <table>
            <thead>
              <tr>
                <th>Imagem</th>
                <th>ID</th>
                <th>Medida</th>
                <th>Marca/Modelo</th>
                <th>DOT</th>
                <th>Sulco</th>
                <th>Status</th>
                <th>Qtd</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
	
	<!-- CONTROLE POR FOGO -->
	<div id="tab-fogo" class="hidden">
	  <div class="toolbar">
		<input type="text" id="searchFogo" class="input" placeholder="Buscar por fogo, marca, modelo..." style="flex:1;">
		<button id="addFogoBtn">+ Novo Pneu Individual</button>
	  </div>

	  <div class="card">
		<div style="padding: 15px;">
		  <h3>Controle Individual por Fogo</h3>
		  <div id="fogoCount" style="color: var(--muted); font-size: 0.9rem; margin-bottom: 10px;"></div>
		</div>
		<div style="overflow-x: auto;">
		  <table>
			<thead>
			  <tr>
				<th>Fogo</th>
				<th>Marca</th>
				<th>Modelo</th>
				<th>Medida</th>
				<th>Valor (R$)</th>
				<th>Status</th>
				<th>A√ß√µes</th>
			  </tr>
			</thead>
			<tbody id="fogoBody"></tbody>
		  </table>
		</div>
	  </div>
	</div>

	<!-- RECAPAGEM -->
	<div id="tab-recapagem" class="hidden">
	  <div class="toolbar">
		<input type="text" id="searchRecapagem" class="input" placeholder="Buscar por fogo, recapadora..." style="flex:1;">
		<button id="addRecapagemBtn">+ Nova Recapagem</button>
	  </div>

	  <div class="card">
		<div style="padding: 15px;">
		  <h3>Controle de Recapagem</h3>
		</div>
		<div style="overflow-x: auto;">
		  <table>
			<thead>
			  <tr>
				<th>Data</th>
				<th>Fogo</th>
				<th>Marca/Modelo</th>
				<th>Medida</th>
				<th>Borracha</th>
				<th>Recapadora</th>
				<th>Observa√ß√£o</th>
				<th>A√ß√µes</th>
			  </tr>
			</thead>
			<tbody id="recapagemBody"></tbody>
		  </table>
		</div>
	  </div>
	</div>

	<!-- DESCARTE -->
	<div id="tab-descarte" class="hidden">
	  <div class="toolbar">
		<input type="text" id="searchDescarte" class="input" placeholder="Buscar por fogo, motivo..." style="flex:1;">
		<button id="addDescarteBtn">+ Novo Descarte</button>
	  </div>

	  <div class="card">
		<div style="padding: 15px;">
		  <h3>Controle de Descarte</h3>
		</div>
		<div style="overflow-x: auto;">
		  <table>
			<thead>
			  <tr>
				<th>Data</th>
				<th>Fogo</th>
				<th>Marca/Modelo</th>
				<th>Medida</th>
				<th>Motivo</th>
				<th>A√ß√µes</th>
			  </tr>
			</thead>
			<tbody id="descarteBody"></tbody>
		  </table>
		</div>
	  </div>
	</div>

	<!-- VENDAS -->
	<div id="tab-venda" class="hidden">
	  <div class="toolbar">
		<input type="text" id="searchVenda" class="input" placeholder="Buscar por fogo, comprador..." style="flex:1;">
		<button id="addVendaBtn">+ Nova Venda</button>
	  </div>

	  <div class="card">
		<div style="padding: 15px;">
		  <h3>Controle de Vendas</h3>
		</div>
		<div style="overflow-x: auto;">
		  <table>
			<thead>
			  <tr>
				<th>Data</th>
				<th>Fogo</th>
				<th>Marca/Modelo</th>
				<th>Medida</th>
				<th>Tipo</th>
				<th>Comprador</th>
				<th>CPF/CNPJ</th>
				<th>Valor (R$)</th>
				<th>A√ß√µes</th>
			  </tr>
			</thead>
			<tbody id="vendaBody"></tbody>
		  </table>
		</div>
	  </div>
	</div>

    <!-- SA√çDAS -->
    <div id="tab-saidas" class="hidden">
      <div class="toolbar">
        <input type="text" id="filterPlaca" class="input" placeholder="Filtrar por placa..." style="flex:1;">
        <input type="text" id="filterPeca" class="input" placeholder="Filtrar por medida...">
      </div>
      
      <div class="card">
        <div style="padding: 15px;">
          <h3>Hist√≥rico de Sa√≠das</h3>
        </div>
        <div style="overflow-x: auto;">
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Pneu</th>
                <th>Medida</th>
                <th>Qtd</th>
                <th>Ve√≠culo</th>
                <th>Posi√ß√£o</th>
                <th>Motorista</th>
              </tr>
            </thead>
            <tbody id="movementsBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- Modal Sa√≠da de Pneu -->
  <div class="modal-backdrop" id="pneuSaidaModal">
    <div class="modal">
      <h2>Sa√≠da de Pneu</h2>
      <div id="pneuSaidaLabel" style="color: var(--muted); margin-bottom: 15px;"></div>
      
      <div style="display: flex; flex-direction: column; gap: 10px;">
        <div>
          <label>Ve√≠culo/Placa *</label>
          <input type="text" id="saidaPlaca" class="input" placeholder="ABC1D23" style="width: 100%;">
        </div>
        
        <div>
          <label>Posi√ß√£o no ve√≠culo *</label>
          <select id="saidaPosicao" class="input" style="width: 100%;">
            <option value="">Selecionar posi√ß√£o</option>
            <option value="Dianteira Esquerda">Dianteira Esquerda</option>
            <option value="Dianteira Direita">Dianteira Direita</option>
            <option value="Traseira Externa Esq">Traseira Externa Esq</option>
            <option value="Traseira Externa Dir">Traseira Externa Dir</option>
            <option value="Step">Step (Soco)</option>
          </select>
        </div>

        <div class="field-row">
          <div>
            <label>Motorista</label>
            <input type="text" id="saidaMotorista" class="input">
          </div>
          <div>
            <label>KM do Ve√≠culo</label>
            <input type="number" id="saidaKm" class="input">
          </div>
        </div>

        <div>
          <label>Observa√ß√£o</label>
          <textarea id="saidaObs" class="input" placeholder="Motivo da troca..." style="width: 100%; height: 60px;"></textarea>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-xs" onclick="closePneuSaidaModal()">Cancelar</button>
        <button onclick="confirmPneuSaida()">Confirmar Sa√≠da</button>
      </div>
    </div>
  </div>

  <!-- Modal Editar Pneu (ATUALIZADO) -->
  <div class="modal-backdrop" id="editModal">
    <div class="modal">
      <h2 id="editTitle">Novo Pneu</h2>
      
      <div style="display: flex; flex-direction: column; gap: 10px;">
        <!-- Upload de Imagem -->
        <div class="full-width">
          <label>Imagem do Pneu</label>
          <div class="image-upload-container" onclick="document.getElementById('imageInput').click()">
            <div id="imageUploadText">Clique para adicionar imagem</div>
            <div class="image-preview" id="imagePreview">
              <img id="previewImage" src="" alt="Preview">
            </div>
          </div>
          <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="previewImage(event)">
        </div>

        <div class="field-row">
          <div>
            <label>C√≥digo/Fogo *</label>
            <input type="text" id="editId" class="input" placeholder="C√≥digo √∫nico do pneu">
          </div>
          <div>
            <label>Medida *</label>
            <input type="text" id="editMedida" class="input" placeholder="295/80 R22.5">
          </div>
        </div>

        <div class="field-row">
          <div>
            <label>Marca *</label>
            <input type="text" id="editMarca" class="input" placeholder="Michelin">
          </div>
          <div>
            <label>Modelo *</label>
            <input type="text" id="editModelo" class="input" placeholder="X Line Energy">
          </div>
        </div>

        <div class="field-row">
          <div>
            <label>DOT</label>
            <input type="text" id="editDot" class="input" placeholder="4321">
          </div>
          <div>
            <label>Sulco (mm)</label>
            <input type="number" id="editSulco" class="input" step="0.1" min="0" max="20" value="0">
          </div>
        </div>

        <div class="field-row">
          <div>
            <label>Status</label>
            <select id="editStatus" class="input">
              <option value="Novo">Novo</option>
              <option value="Usado">Usado</option>
              <option value="Reformado">Reformado</option>
            </select>
          </div>
          <div>
            <label>Quantidade em Estoque *</label>
            <input type="number" id="editQty" class="input" min="0" value="0">
          </div>
        </div>

        <div class="field-row">
          <div>
            <label>Ponto de Reposi√ß√£o</label>
            <input type="number" id="editReorderPoint" class="input" min="0" value="5">
            <small style="color: var(--muted);">Alerta quando estoque ficar abaixo deste valor</small>
          </div>
          <div>
            <label>Pre√ßo (R$)</label>
            <input type="number" id="editPreco" class="input" step="0.01" min="0" placeholder="0.00">
          </div>
        </div>

        <div class="full-width">
          <label>Observa√ß√µes</label>
          <textarea id="editObservacoes" class="input" placeholder="Observa√ß√µes adicionais..." style="width: 100%; height: 60px;"></textarea>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-xs" onclick="closeEditModal()">Cancelar</button>
        <button onclick="saveItem()">Salvar Pneu</button>
      </div>
    </div>
  </div>
	  
	  <!-- Modal Fogo Individual -->
	<div class="modal-backdrop" id="fogoModal">
	  <div class="modal">
		<h2 id="fogoTitle">Novo Pneu Individual</h2>
		<div style="display: flex; flex-direction: column; gap: 10px;">
		  <div class="field-row">
			<div>
			  <label>N√∫mero do Fogo *</label>
			  <input type="text" id="fogoNumero" class="input" placeholder="Fogo √∫nico do pneu">
			</div>
			<div>
			  <label>Valor (R$) *</label>
			  <input type="number" id="fogoValor" class="input" step="0.01" min="0" placeholder="0.00">
			</div>
		  </div>
		  <div class="field-row">
			<div>
			  <label>Marca *</label>
			  <input type="text" id="fogoMarca" class="input" placeholder="Michelin">
			</div>
			<div>
			  <label>Modelo *</label>
			  <input type="text" id="fogoModelo" class="input" placeholder="X Line Energy">
			</div>
		  </div>
		  <div class="field-row">
			<div>
			  <label>Medida *</label>
			  <input type="text" id="fogoMedida" class="input" placeholder="295/80 R22.5">
			</div>
			<div>
			  <label>Status</label>
			  <select id="fogoStatus" class="input">
				<option value="Estoque">Em Estoque</option>
				<option value="Em uso">Em Uso</option>
				<option value="Recapando">Recapando</option>
				<option value="Vendido">Vendido</option>
				<option value="Descartado">Descartado</option>
			  </select>
			</div>
		  </div>
		</div>
		<div class="modal-actions">
		  <button class="btn-xs" onclick="closeFogoModal()">Cancelar</button>
		  <button onclick="saveFogo()">Salvar</button>
		</div>
	  </div>
	</div>

	<!-- Modal Recapagem -->
	<div class="modal-backdrop" id="recapagemModal">
	  <div class="modal">
		<h2>Nova Recapagem</h2>
		<div style="display: flex; flex-direction: column; gap: 10px;">
		  <div class="field-row">
			<div>
			  <label>Fogo do Pneu *</label>
			  <input type="text" id="recapagemFogo" class="input" placeholder="N√∫mero do fogo">
			</div>
			<div>
			  <label>Data da Recapagem</label>
			  <input type="date" id="recapagemData" class="input">
			</div>
		  </div>
		  <div class="field-row">
			<div>
			  <label>Borracha Utilizada *</label>
			  <input type="text" id="recapagemBorracha" class="input" placeholder="Tipo de borracha">
			</div>
			<div>
			  <label>Recapadora *</label>
			  <input type="text" id="recapagemRecapadora" class="input" placeholder="Nome da recapadora">
			</div>
		  </div>
		  <div>
			<label>Observa√ß√µes</label>
			<textarea id="recapagemObs" class="input" placeholder="Observa√ß√µes da recapagem..." style="width: 100%; height: 60px;"></textarea>
		  </div>
		</div>
		<div class="modal-actions">
		  <button class="btn-xs" onclick="closeRecapagemModal()">Cancelar</button>
		  <button onclick="saveRecapagem()">Salvar</button>
		</div>
	  </div>
	</div>

	<!-- Modal Descarte -->
	<div class="modal-backdrop" id="descarteModal">
	  <div class="modal">
		<h2>Novo Descarte</h2>
		<div style="display: flex; flex-direction: column; gap: 10px;">
		  <div class="field-row">
			<div>
			  <label>Fogo do Pneu *</label>
			  <input type="text" id="descarteFogo" class="input" placeholder="N√∫mero do fogo">
			</div>
			<div>
			  <label>Data do Descarte</label>
			  <input type="date" id="descarteData" class="input">
			</div>
		  </div>
		  <div>
			<label>Motivo do Descarte *</label>
			<select id="descarteMotivo" class="input" style="width: 100%;">
			  <option value="">Selecionar motivo</option>
			  <option value="Sulco esgotado">Sulco esgotado</option>
			  <option value="Danificado">Danificado</option>
			  <option value="Reparo imposs√≠vel">Reparo imposs√≠vel</option>
			  <option value="Vida √∫til esgotada">Vida √∫til esgotada</option>
			  <option value="Outro">Outro</option>
			</select>
		  </div>
		  <div>
			<label>Observa√ß√µes</label>
			<textarea id="descarteObs" class="input" placeholder="Detalhes do descarte..." style="width: 100%; height: 60px;"></textarea>
		  </div>
		</div>
		<div class="modal-actions">
		  <button class="btn-xs" onclick="closeDescarteModal()">Cancelar</button>
		  <button onclick="saveDescarte()">Salvar</button>
		</div>
	  </div>
	</div>

	<!-- Modal Venda -->
	<div class="modal-backdrop" id="vendaModal">
	  <div class="modal">
		<h2>Nova Venda</h2>
		<div style="display: flex; flex-direction: column; gap: 10px;">
		  <div class="field-row">
			<div>
			  <label>Fogo do Pneu *</label>
			  <input type="text" id="vendaFogo" class="input" placeholder="N√∫mero do fogo">
			</div>
			<div>
			  <label>Data da Venda</label>
			  <input type="date" id="vendaData" class="input">
			</div>
		  </div>
		  <div class="field-row">
			<div>
			  <label>Comprador *</label>
			  <input type="text" id="vendaComprador" class="input" placeholder="Nome do comprador">
			</div>
			<div>
			  <label>CPF/CNPJ *</label>
			  <input type="text" id="vendaDocumento" class="input" placeholder="CPF ou CNPJ">
			</div>
		  </div>
		  <div class="field-row">
			<div>
			  <label>Tipo do Pneu</label>
			  <select id="vendaTipo" class="input">
				<option value="Novo">Novo</option>
				<option value="Usado">Usado</option>
				<option value="Reformado">Reformado</option>
			  </select>
			</div>
			<div>
			  <label>Valor da Venda (R$) *</label>
			  <input type="number" id="vendaValor" class="input" step="0.01" min="0" placeholder="0.00">
			</div>
		  </div>
		</div>
		<div class="modal-actions">
		  <button class="btn-xs" onclick="closeVendaModal()">Cancelar</button>
		  <button onclick="saveVenda()">Salvar</button>
		</div>
	  </div>
	</div>

  <script>
    // Dados iniciais
    let items = JSON.parse(localStorage.getItem('tc_pneus')) || [
      { 
        id: "PNEU-001", 
        medida: "295/80 R22.5",
        marca: "Michelin",
        modelo: "X Line Energy",
        dot: "4321",
        sulco: 8.5,
        status: "Novo",
        qty: 8,
        reorderPoint: 5,
        preco: 1250.00,
        observacoes: "",
        imagem: null
      },
      { 
        id: "PNEU-002", 
        medida: "11R22.5",
        marca: "Bridgestone", 
        modelo: "R194",
        dot: "1234",
        sulco: 4.2,
        status: "Usado",
        qty: 3,
        reorderPoint: 5,
        preco: 850.00,
        observacoes: "Pneu reformado",
        imagem: null
      }
    ];

    let movements = JSON.parse(localStorage.getItem('tc_movements')) || [];
    let currentItem = null;
    let currentImageFile = null;
	let fogos = JSON.parse(localStorage.getItem('tc_fogos')) || [];
	let recapagens = JSON.parse(localStorage.getItem('tc_recapagens')) || [];
	let descartes = JSON.parse(localStorage.getItem('tc_descartes')) || [];
	let vendas = JSON.parse(localStorage.getItem('tc_vendas')) || [];

    // Elementos da interface
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');
    const tableBody = document.getElementById('tableBody');
    const itemsCount = document.getElementById('itemsCount');
    const movementsBody = document.getElementById('movementsBody');

    // Inicializa√ß√£o
	function init() {
	  renderTable();
	  renderStats();
	  renderAlerts();
	  renderMovements();
	  renderFogos();
	  renderRecapagens();
	  renderDescartes();
	  renderVendas();
	  setupEventListeners();
	}

    function setupEventListeners() {
      // Tabs
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('[id^="tab-"]').forEach(tab => tab.classList.add('hidden'));
          btn.classList.add('active');
          document.getElementById('tab-' + btn.dataset.tab).classList.remove('hidden');
        });
      });

      // Filtros
      searchInput.addEventListener('input', renderTable);
      statusFilter.addEventListener('change', renderTable);

      // Bot√£o novo item
      document.getElementById('addItemBtn').addEventListener('click', () => openEditModal());

		  // Filtros de sa√≠da
		  document.getElementById('filterPlaca').addEventListener('input', renderMovements);
		  document.getElementById('filterPeca').addEventListener('input', renderMovements);

		  // ==== NOVOS EVENT LISTENERS - ADICIONE ESTA PARTE ====
		  document.getElementById('addFogoBtn').addEventListener('click', () => openFogoModal());
		  document.getElementById('addRecapagemBtn').addEventListener('click', openRecapagemModal);
		  document.getElementById('addDescarteBtn').addEventListener('click', openDescarteModal);
		  document.getElementById('addVendaBtn').addEventListener('click', openVendaModal);
		  
		  document.getElementById('searchFogo').addEventListener('input', renderFogos);
		  document.getElementById('searchRecapagem').addEventListener('input', renderRecapagens);
		  document.getElementById('searchDescarte').addEventListener('input', renderDescartes);
		  document.getElementById('searchVenda').addEventListener('input', renderVendas);
    }

    function renderTable() {
      const searchTerm = searchInput.value.toLowerCase();
      const statusTerm = statusFilter.value;

      const filtered = items.filter(item => {
        const matchSearch = item.id.toLowerCase().includes(searchTerm) ||
                          item.medida.toLowerCase().includes(searchTerm) ||
                          (item.dot && item.dot.toLowerCase().includes(searchTerm)) ||
                          item.marca.toLowerCase().includes(searchTerm) ||
                          item.modelo.toLowerCase().includes(searchTerm);
        const matchStatus = !statusTerm || item.status === statusTerm;
        return matchSearch && matchStatus;
      });

      tableBody.innerHTML = filtered.map(item => {
        const sulcoClass = item.sulco < 3.0 ? "sulco-critico" : 
                          item.sulco < 5.0 ? "sulco-alerta" : "sulco-ok";
        const needsReorder = item.qty <= item.reorderPoint;
        const rowClass = needsReorder ? 'estoque-baixo' : '';
        
        // Imagem do pneu ou placeholder
        const imagemSrc = item.imagem || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiByeD0iNiIgZmlsbD0icmdiYSgxNSwgMjMsIDQyLCAwLjYpIi8+CjxwYXRoIGQ9Ik0zOCAyNkMzOCAyOC4yMDkxIDM2LjIwOTEgMzAgMzQgMzBDMzEuNzkwOSAzMCAzMCAyOC4yMDkxIDMwIDI2QzMwIDIzLjc5MDkgMzEuNzkwOSAyMiAzNCAyMkMzNi4yMDkxIDIyIDM4IDIzLjc5MDkgMzggMjZaIiBmaWxsPSJyZ2JhKDE0OCwgMTYzLCAxODQsIDAuNCkiLz4KPHBhdGggZD0iTTQyIDM4SDE4QzE2Ljg5NTQgMzggMTYgMzcuMTA0NiAxNiAzNlYyNEMxNiAyMi44OTU0IDE2Ljg5NTQgMjIgMTggMjJINDJDNDMuMTA0NiAyMiA0NCAyMi44OTU0IDQ0IDI0VjM2QzQ0IDM3LjEwNDYgNDMuMTA0NiAzOCA0MiAzOFpNMTggMjRWMzZINDJWMjRIMThaIiBmaWxsPSJyZ2JhKDE0OCwgMTYzLCAxODQsIDAuNCkiLz4KPC9zdmc+';
        
        return `
          <tr class="${rowClass}">
            <td><img src="${imagemSrc}" class="pneu-image" alt="${item.id}"></td>
            <td><strong>${item.id}</strong></td>
            <td>${item.medida}</td>
            <td>${item.marca}<br><small style="color: var(--muted);">${item.modelo}</small></td>
            <td>${item.dot || '-'}</td>
            <td><span class="badge ${sulcoClass}">${item.sulco}mm</span></td>
            <td><span class="badge">${item.status}</span></td>
            <td>
              <span class="badge ${needsReorder ? 'qty-low' : ''}">${item.qty}</span>
              ${needsReorder ? '<br><small style="color: var(--danger);">Estoque baixo!</small>' : ''}
            </td>
            <td>
              <div class="actions">
                <button class="btn-xs btn-success" onclick="openPneuSaidaModal('${item.id}')">Sa√≠da</button>
                <button class="btn-xs" onclick="openEditModal('${item.id}')">Editar</button>
                <button class="btn-xs" style="background: rgba(244, 63, 94, 0.2); color: #ffe4e6;" onclick="deleteItem('${item.id}')">Excluir</button>
              </div>
            </td>
          </tr>
        `;
      }).join('');

      itemsCount.textContent = `${filtered.length} pneu(s) encontrado(s)`;
    }

    function renderStats() {
      const totalPneus = items.reduce((sum, item) => sum + item.qty, 0);
      const pneusNovos = items.filter(item => item.status === "Novo").reduce((sum, item) => sum + item.qty, 0);
      const pneusBaixoEstoque = items.filter(item => item.qty <= item.reorderPoint).reduce((sum, item) => sum + item.qty, 0);
      const pneusSulcoCritico = items.filter(item => item.sulco < 3.0).reduce((sum, item) => sum + item.qty, 0);

      document.getElementById('statsContainer').innerHTML = `
        <div class="stat-card">
          <div class="stat-value">${totalPneus}</div>
          <div class="stat-label">Total em Estoque</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${pneusNovos}</div>
          <div class="stat-label">Pneus Novos</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${pneusBaixoEstoque}</div>
          <div class="stat-label">Baixo Estoque</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${pneusSulcoCritico}</div>
          <div class="stat-label">Sulco Cr√≠tico</div>
        </div>
      `;
    }

    function renderAlerts() {
      const alerts = [];
      
      items.forEach(pneu => {
        if (pneu.sulco < 3.0) {
          alerts.push({
            type: "CRITICO",
            message: `${pneu.id} - Sulco cr√≠tico: ${pneu.sulco}mm`
          });
        }
        if (pneu.qty <= pneu.reorderPoint) {
          alerts.push({
            type: "ALERTA",
            message: `${pneu.id} - Estoque baixo: ${pneu.qty} unidade(s) (m√≠nimo: ${pneu.reorderPoint})`
          });
        }
      });

      const container = document.getElementById('alertsContainer');
      if (alerts.length === 0) {
        container.innerHTML = '<div class="alert-banner">‚úÖ Todos os pneus est√£o em condi√ß√µes normais</div>';
      } else {
        container.innerHTML = alerts.map(alert => `
          <div class="alert-banner ${alert.type === 'CRITICO' ? 'critical' : ''}">
            <strong>${alert.type === 'CRITICO' ? 'üö® CR√çTICO' : '‚ö†Ô∏è ALERTA'}:</strong> ${alert.message}
          </div>
        `).join('');
      }
    }

    function renderMovements() {
      const placaFilter = document.getElementById('filterPlaca').value.toLowerCase();
      const pecaFilter = document.getElementById('filterPeca').value.toLowerCase();

      const filtered = movements.filter(move => {
        const matchPlaca = !placaFilter || (move.placa && move.placa.toLowerCase().includes(placaFilter));
        const matchPeca = !pecaFilter || 
                         move.itemId.toLowerCase().includes(pecaFilter) ||
                         move.medida.toLowerCase().includes(pecaFilter);
        return matchPlaca && matchPeca;
      });

      movementsBody.innerHTML = filtered.map(move => `
        <tr>
          <td>${move.date}</td>
          <td>${move.itemId}</td>
          <td>${move.medida}</td>
          <td>${move.qty}</td>
          <td>${move.placa}</td>
          <td>${move.posicao}</td>
          <td>${move.motorista || '-'}</td>
        </tr>
      `).join('');
    }

    // Fun√ß√µes para manipula√ß√£o de imagens
    function previewImage(event) {
      const input = event.target;
      const preview = document.getElementById('previewImage');
      const previewContainer = document.getElementById('imagePreview');
      const uploadText = document.getElementById('imageUploadText');
      
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          preview.src = e.target.result;
          previewContainer.style.display = 'block';
          uploadText.style.display = 'none';
        }
        
        reader.readAsDataURL(input.files[0]);
        currentImageFile = input.files[0];
      }
    }

    function imageToBase64(file, callback) {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = function () {
        callback(reader.result);
      };
      reader.onerror = function (error) {
        console.log('Error converting image: ', error);
        callback(null);
      };
    }

    function openPneuSaidaModal(itemId) {
      currentItem = items.find(item => item.id === itemId);
      if (!currentItem) return;

      document.getElementById('pneuSaidaLabel').textContent = 
        `${currentItem.id} - ${currentItem.medida} (${currentItem.marca})`;
      
      // Limpar campos
      document.getElementById('saidaPlaca').value = '';
      document.getElementById('saidaPosicao').value = '';
      document.getElementById('saidaMotorista').value = '';
      document.getElementById('saidaKm').value = '';
      document.getElementById('saidaObs').value = '';

      document.getElementById('pneuSaidaModal').style.display = 'flex';
    }

    function closePneuSaidaModal() {
      document.getElementById('pneuSaidaModal').style.display = 'none';
      currentItem = null;
    }

    function confirmPneuSaida() {
      const placa = document.getElementById('saidaPlaca').value.trim();
      const posicao = document.getElementById('saidaPosicao').value;
      const motorista = document.getElementById('saidaMotorista').value.trim();
      const km = document.getElementById('saidaKm').value;
      const obs = document.getElementById('saidaObs').value.trim();

      if (!placa || !posicao) {
        alert('Placa e posi√ß√£o s√£o obrigat√≥rios!');
        return;
      }

      if (currentItem.qty <= 0) {
        alert('Estoque insuficiente!');
        return;
      }

      // Registrar sa√≠da
      const now = new Date();
      movements.unshift({
        date: now.toLocaleDateString('pt-BR') + ' ' + now.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'}),
        itemId: currentItem.id,
        medida: currentItem.medida,
        qty: 1,
        placa: placa,
        posicao: posicao,
        motorista: motorista,
        km: km,
        observacao: obs
      });

      // Atualizar estoque
      currentItem.qty--;

      // Salvar e atualizar
      saveData();
      renderTable();
      renderStats();
      renderAlerts();
      renderMovements();
      closePneuSaidaModal();

      alert('Sa√≠da registrada com sucesso!');
    }

    function openEditModal(itemId = null) {
      currentItem = itemId ? items.find(item => item.id === itemId) : null;
      currentImageFile = null;
      
      // Resetar preview de imagem
      document.getElementById('imagePreview').style.display = 'none';
      document.getElementById('imageUploadText').style.display = 'block';
      document.getElementById('imageInput').value = '';
      
      if (currentItem) {
        document.getElementById('editTitle').textContent = 'Editar Pneu';
        document.getElementById('editId').value = currentItem.id;
        document.getElementById('editMedida').value = currentItem.medida;
        document.getElementById('editMarca').value = currentItem.marca || '';
        document.getElementById('editModelo').value = currentItem.modelo || '';
        document.getElementById('editDot').value = currentItem.dot || '';
        document.getElementById('editSulco').value = currentItem.sulco;
        document.getElementById('editStatus').value = currentItem.status;
        document.getElementById('editQty').value = currentItem.qty;
        document.getElementById('editReorderPoint').value = currentItem.reorderPoint || 5;
        document.getElementById('editPreco').value = currentItem.preco || '';
        document.getElementById('editObservacoes').value = currentItem.observacoes || '';
        
        // Mostrar imagem atual se existir
        if (currentItem.imagem) {
          document.getElementById('previewImage').src = currentItem.imagem;
          document.getElementById('imagePreview').style.display = 'block';
          document.getElementById('imageUploadText').style.display = 'none';
        }
      } else {
        document.getElementById('editTitle').textContent = 'Novo Pneu';
        document.getElementById('editId').value = '';
        document.getElementById('editMedida').value = '';
        document.getElementById('editMarca').value = '';
        document.getElementById('editModelo').value = '';
        document.getElementById('editDot').value = '';
        document.getElementById('editSulco').value = '';
        document.getElementById('editStatus').value = 'Novo';
        document.getElementById('editQty').value = '';
        document.getElementById('editReorderPoint').value = 5;
        document.getElementById('editPreco').value = '';
        document.getElementById('editObservacoes').value = '';
      }

      document.getElementById('editModal').style.display = 'flex';
    }

    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
      currentItem = null;
      currentImageFile = null;
    }

    function saveItem() {
      const id = document.getElementById('editId').value.trim();
      const medida = document.getElementById('editMedida').value.trim();
      const marca = document.getElementById('editMarca').value.trim();
      const modelo = document.getElementById('editModelo').value.trim();
      const qty = parseInt(document.getElementById('editQty').value) || 0;

      if (!id || !medida || !marca || !modelo) {
        alert('C√≥digo, Medida, Marca e Modelo s√£o obrigat√≥rios!');
        return;
      }

      // Processar imagem se houver
      const processImage = (callback) => {
        if (currentImageFile) {
          imageToBase64(currentImageFile, (base64) => {
            callback(base64);
          });
        } else {
          callback(currentItem ? currentItem.imagem : null);
        }
      };

      processImage((imagemData) => {
        const itemData = {
          id: id,
          medida: medida,
          marca: marca,
          modelo: modelo,
          dot: document.getElementById('editDot').value.trim(),
          sulco: parseFloat(document.getElementById('editSulco').value) || 0,
          status: document.getElementById('editStatus').value,
          qty: qty,
          reorderPoint: parseInt(document.getElementById('editReorderPoint').value) || 5,
          preco: parseFloat(document.getElementById('editPreco').value) || 0,
          observacoes: document.getElementById('editObservacoes').value.trim(),
          imagem: imagemData
        };

        if (currentItem) {
          // Editar - manter imagem atual se n√£o foi alterada
          if (!currentImageFile && currentItem.imagem) {
            itemData.imagem = currentItem.imagem;
          }
          Object.assign(currentItem, itemData);
        } else {
          // Novo item - verificar se ID j√° existe
          if (items.some(item => item.id === id)) {
            alert('J√° existe um pneu com este ID!');
            return;
          }
          items.push(itemData);
        }

        saveData();
        renderTable();
        renderStats();
        renderAlerts();
        closeEditModal();

        alert('Pneu salvo com sucesso!');
      });
    }

    function deleteItem(itemId) {
      if (!confirm('Tem certeza que deseja excluir este pneu?')) return;
      
      items = items.filter(item => item.id !== itemId);
      saveData();
      renderTable();
      renderStats();
      renderAlerts();
    }

    function saveData() {
      localStorage.setItem('tc_pneus', JSON.stringify(items));
      localStorage.setItem('tc_movements', JSON.stringify(movements));
    }
		
		// ===== FUN√á√ïES PARA CONTROLE POR FOGO =====
	function openFogoModal(fogoNumero = null) {
	  const modal = document.getElementById('fogoModal');
	  const currentFogo = fogoNumero ? fogos.find(f => f.numero === fogoNumero) : null;
	  
	  if (currentFogo) {
		document.getElementById('fogoTitle').textContent = 'Editar Pneu Individual';
		document.getElementById('fogoNumero').value = currentFogo.numero;
		document.getElementById('fogoMarca').value = currentFogo.marca;
		document.getElementById('fogoModelo').value = currentFogo.modelo;
		document.getElementById('fogoMedida').value = currentFogo.medida;
		document.getElementById('fogoValor').value = currentFogo.valor;
		document.getElementById('fogoStatus').value = currentFogo.status;
	  } else {
		document.getElementById('fogoTitle').textContent = 'Novo Pneu Individual';
		document.getElementById('fogoNumero').value = '';
		document.getElementById('fogoMarca').value = '';
		document.getElementById('fogoModelo').value = '';
		document.getElementById('fogoMedida').value = '';
		document.getElementById('fogoValor').value = '';
		document.getElementById('fogoStatus').value = 'Estoque';
	  }
	  
	  modal.style.display = 'flex';
	}

	function closeFogoModal() {
	  document.getElementById('fogoModal').style.display = 'none';
	}

	function saveFogo() {
	  const numero = document.getElementById('fogoNumero').value.trim();
	  const marca = document.getElementById('fogoMarca').value.trim();
	  const modelo = document.getElementById('fogoModelo').value.trim();
	  const medida = document.getElementById('fogoMedida').value.trim();
	  const valor = parseFloat(document.getElementById('fogoValor').value) || 0;
	  const status = document.getElementById('fogoStatus').value;

	  if (!numero || !marca || !modelo || !medida) {
		alert('Fogo, Marca, Modelo e Medida s√£o obrigat√≥rios!');
		return;
	  }

	  const fogoData = {
		numero,
		marca,
		modelo,
		medida,
		valor,
		status,
		dataCadastro: new Date().toLocaleDateString('pt-BR')
	  };

	  const existingIndex = fogos.findIndex(f => f.numero === numero);
	  
	  if (existingIndex >= 0) {
		fogos[existingIndex] = fogoData;
	  } else {
		fogos.push(fogoData);
	  }

	  localStorage.setItem('tc_fogos', JSON.stringify(fogos));
	  renderFogos();
	  closeFogoModal();
	  alert('Pneu individual salvo com sucesso!');
	}

	function renderFogos() {
	  const searchTerm = document.getElementById('searchFogo').value.toLowerCase();
	  const filtered = fogos.filter(fogo => 
		fogo.numero.toLowerCase().includes(searchTerm) ||
		fogo.marca.toLowerCase().includes(searchTerm) ||
		fogo.modelo.toLowerCase().includes(searchTerm)
	  );

	  document.getElementById('fogoBody').innerHTML = filtered.map(fogo => `
		<tr>
		  <td><strong>${fogo.numero}</strong></td>
		  <td>${fogo.marca}</td>
		  <td>${fogo.modelo}</td>
		  <td>${fogo.medida}</td>
		  <td>R$ ${fogo.valor.toFixed(2)}</td>
		  <td><span class="badge">${fogo.status}</span></td>
		  <td>
			<div class="actions">
			  <button class="btn-xs" onclick="openFogoModal('${fogo.numero}')">Editar</button>
			  <button class="btn-xs" style="background: rgba(244, 63, 94, 0.2); color: #ffe4e6;" onclick="deleteFogo('${fogo.numero}')">Excluir</button>
			</div>
		  </td>
		</tr>
	  `).join('');

	  document.getElementById('fogoCount').textContent = `${filtered.length} pneu(s) individual(is) encontrado(s)`;
	}

	function deleteFogo(numero) {
	  if (!confirm('Tem certeza que deseja excluir este pneu individual?')) return;
	  fogos = fogos.filter(f => f.numero !== numero);
	  localStorage.setItem('tc_fogos', JSON.stringify(fogos));
	  renderFogos();
	}

	// ===== FUN√á√ïES PARA RECAPAGEM =====
	function openRecapagemModal() {
	  document.getElementById('recapagemModal').style.display = 'flex';
	  document.getElementById('recapagemData').value = new Date().toISOString().split('T')[0];
	}

	function closeRecapagemModal() {
	  document.getElementById('recapagemModal').style.display = 'none';
	}

	function saveRecapagem() {
	  const fogo = document.getElementById('recapagemFogo').value.trim();
	  const data = document.getElementById('recapagemData').value;
	  const borracha = document.getElementById('recapagemBorracha').value.trim();
	  const recapadora = document.getElementById('recapagemRecapadora').value.trim();
	  const observacoes = document.getElementById('recapagemObs').value.trim();

	  if (!fogo || !borracha || !recapadora) {
		alert('Fogo, Borracha e Recapadora s√£o obrigat√≥rios!');
		return;
	  }

	  const recapagemData = {
		id: Date.now().toString(),
		fogo,
		data: data || new Date().toLocaleDateString('pt-BR'),
		borracha,
		recapadora,
		observacoes,
		dataRegistro: new Date().toLocaleDateString('pt-BR')
	  };

	  recapagens.unshift(recapagemData);
	  localStorage.setItem('tc_recapagens', JSON.stringify(recapagens));
	  renderRecapagens();
	  closeRecapagemModal();
	  alert('Recapagem registrada com sucesso!');
	}

	function renderRecapagens() {
	  const searchTerm = document.getElementById('searchRecapagem').value.toLowerCase();
	  const filtered = recapagens.filter(recap => 
		recap.fogo.toLowerCase().includes(searchTerm) ||
		recap.recapadora.toLowerCase().includes(searchTerm)
	  );

	  document.getElementById('recapagemBody').innerHTML = filtered.map(recap => `
		<tr>
		  <td>${recap.data}</td>
		  <td><strong>${recap.fogo}</strong></td>
		  <td>${getMarcaModeloByFogo(recap.fogo)}</td>
		  <td>${getMedidaByFogo(recap.fogo)}</td>
		  <td>${recap.borracha}</td>
		  <td>${recap.recapadora}</td>
		  <td>${recap.observacoes || '-'}</td>
		  <td>
			<button class="btn-xs" style="background: rgba(244, 63, 94, 0.2); color: #ffe4e6;" onclick="deleteRecapagem('${recap.id}')">Excluir</button>
		  </td>
		</tr>
	  `).join('');
	}

	function deleteRecapagem(id) {
	  if (!confirm('Tem certeza que deseja excluir este registro de recapagem?')) return;
	  recapagens = recapagens.filter(r => r.id !== id);
	  localStorage.setItem('tc_recapagens', JSON.stringify(recapagens));
	  renderRecapagens();
	}

	// ===== FUN√á√ïES PARA DESCARTE =====
	function openDescarteModal() {
	  document.getElementById('descarteModal').style.display = 'flex';
	  document.getElementById('descarteData').value = new Date().toISOString().split('T')[0];
	}

	function closeDescarteModal() {
	  document.getElementById('descarteModal').style.display = 'none';
	}

	function saveDescarte() {
	  const fogo = document.getElementById('descarteFogo').value.trim();
	  const data = document.getElementById('descarteData').value;
	  const motivo = document.getElementById('descarteMotivo').value;
	  const observacoes = document.getElementById('descarteObs').value.trim();

	  if (!fogo || !motivo) {
		alert('Fogo e Motivo s√£o obrigat√≥rios!');
		return;
	  }

	  const descarteData = {
		id: Date.now().toString(),
		fogo,
		data: data || new Date().toLocaleDateString('pt-BR'),
		motivo,
		observacoes,
		dataRegistro: new Date().toLocaleDateString('pt-BR')
	  };

	  descartes.unshift(descarteData);
	  localStorage.setItem('tc_descartes', JSON.stringify(descartes));
	  renderDescartes();
	  closeDescarteModal();
	  alert('Descarte registrado com sucesso!');
	}

	function renderDescartes() {
	  const searchTerm = document.getElementById('searchDescarte').value.toLowerCase();
	  const filtered = descartes.filter(descarte => 
		descarte.fogo.toLowerCase().includes(searchTerm) ||
		descarte.motivo.toLowerCase().includes(searchTerm)
	  );

	  document.getElementById('descarteBody').innerHTML = filtered.map(descarte => `
		<tr>
		  <td>${descarte.data}</td>
		  <td><strong>${descarte.fogo}</strong></td>
		  <td>${getMarcaModeloByFogo(descarte.fogo)}</td>
		  <td>${getMedidaByFogo(descarte.fogo)}</td>
		  <td>${descarte.motivo}</td>
		  <td>${descarte.observacoes || '-'}</td>
		  <td>
			<button class="btn-xs" style="background: rgba(244, 63, 94, 0.2); color: #ffe4e6;" onclick="deleteDescarte('${descarte.id}')">Excluir</button>
		  </td>
		</tr>
	  `).join('');
	}

	function deleteDescarte(id) {
	  if (!confirm('Tem certeza que deseja excluir este registro de descarte?')) return;
	  descartes = descartes.filter(d => d.id !== id);
	  localStorage.setItem('tc_descartes', JSON.stringify(descartes));
	  renderDescartes();
	}

	// ===== FUN√á√ïES PARA VENDAS =====
	function openVendaModal() {
	  document.getElementById('vendaModal').style.display = 'flex';
	  document.getElementById('vendaData').value = new Date().toISOString().split('T')[0];
	}

	function closeVendaModal() {
	  document.getElementById('vendaModal').style.display = 'none';
	}

	function saveVenda() {
	  const fogo = document.getElementById('vendaFogo').value.trim();
	  const data = document.getElementById('vendaData').value;
	  const comprador = document.getElementById('vendaComprador').value.trim();
	  const documento = document.getElementById('vendaDocumento').value.trim();
	  const tipo = document.getElementById('vendaTipo').value;
	  const valor = parseFloat(document.getElementById('vendaValor').value) || 0;

	  if (!fogo || !comprador || !documento || !valor) {
		alert('Fogo, Comprador, Documento e Valor s√£o obrigat√≥rios!');
		return;
	  }

	  const vendaData = {
		id: Date.now().toString(),
		fogo,
		data: data || new Date().toLocaleDateString('pt-BR'),
		comprador,
		documento,
		tipo,
		valor,
		dataRegistro: new Date().toLocaleDateString('pt-BR')
	  };

	  vendas.unshift(vendaData);
	  localStorage.setItem('tc_vendas', JSON.stringify(vendas));
	  renderVendas();
	  closeVendaModal();
	  alert('Venda registrada com sucesso!');
	}

	function renderVendas() {
	  const searchTerm = document.getElementById('searchVenda').value.toLowerCase();
	  const filtered = vendas.filter(venda => 
		venda.fogo.toLowerCase().includes(searchTerm) ||
		venda.comprador.toLowerCase().includes(searchTerm)
	  );

	  document.getElementById('vendaBody').innerHTML = filtered.map(venda => `
		<tr>
		  <td>${venda.data}</td>
		  <td><strong>${venda.fogo}</strong></td>
		  <td>${getMarcaModeloByFogo(venda.fogo)}</td>
		  <td>${getMedidaByFogo(venda.fogo)}</td>
		  <td>${venda.tipo}</td>
		  <td>${venda.comprador}</td>
		  <td>${venda.documento}</td>
		  <td>R$ ${venda.valor.toFixed(2)}</td>
		  <td>
			<button class="btn-xs" style="background: rgba(244, 63, 94, 0.2); color: #ffe4e6;" onclick="deleteVenda('${venda.id}')">Excluir</button>
		  </td>
		</tr>
	  `).join('');
	}

	function deleteVenda(id) {
	  if (!confirm('Tem certeza que deseja excluir este registro de venda?')) return;
	  vendas = vendas.filter(v => v.id !== id);
	  localStorage.setItem('tc_vendas', JSON.stringify(vendas));
	  renderVendas();
	}

	// ===== FUN√á√ïES AUXILIARES =====
	function getMarcaModeloByFogo(fogoNumero) {
	  const fogo = fogos.find(f => f.numero === fogoNumero);
	  return fogo ? `${fogo.marca} / ${fogo.modelo}` : 'N√£o encontrado';
	}

	function getMedidaByFogo(fogoNumero) {
	  const fogo = fogos.find(f => f.numero === fogoNumero);
	  return fogo ? fogo.medida : 'N√£o encontrado';
	}

    // Iniciar aplica√ß√£o
    init();
  </script>
</body>
</html>
