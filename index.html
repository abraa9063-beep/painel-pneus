<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Estoque de Pneus - Base</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --panel-light: #1f2937;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --danger: #f43f5e;
      --r: 14px;
    }
    * { box-sizing: border-box; font-family: "Segoe UI", system-ui, sans-serif; }
    body {
      margin: 0;
      background: #020617;
      color: var(--text);
      min-height: 100vh;
    }
    header {
      background: #020617;
      border-bottom: 1px solid rgba(148,163,184,.15);
      padding: 14px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-icon {
      width: 38px;
      height: 38px;
      object-fit: contain;
    }
    .header-txt h1 {
      margin: 0;
      font-size: 1rem;
    }
    .header-txt small {
      color: var(--muted);
      font-size: .7rem;
    }
    .header-title {
      margin-left: auto;
      font-size: .75rem;
      text-transform: uppercase;
      border: 1px solid rgba(148,163,184,.2);
      border-radius: 999px;
      padding: 3px 10px;
    }
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 16px 50px;
    }
    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 12px;
    }
    .tab-btn {
      background: rgba(15,23,42,.2);
      border: 1px solid transparent;
      color: var(--muted);
      padding: 6px 14px;
      border-radius: 999px;
      font-size: .7rem;
      cursor: pointer;
    }
    .tab-btn.active {
      background: rgba(56,189,248,.1);
      border-color: rgba(56,189,248,.3);
      color: var(--text);
    }
    .toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .input {
      background: rgba(15,23,42,.5);
      border: 1px solid rgba(148,163,184,.2);
      border-radius: 999px;
      padding: 7px 12px;
      color: var(--text);
      outline: none;
    }
    .btn {
      background: #0ea5e9;
      border: none;
      color: #020617;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: .75rem;
      font-weight: 600;
      cursor: pointer;
    }
    .card {
      background: rgba(2,6,23,.5);
      border: 1px solid rgba(148,163,184,.05);
      border-radius: 14px;
      overflow: hidden;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    thead { background: rgba(15,23,42,.3); }
    th, td {
      text-align: left;
      padding: 9px 12px;
      font-size: .75rem;
    }
    tbody tr { border-bottom: 1px solid rgba(148,163,184,.04); }
    tbody tr:hover { background: rgba(15,23,42,.25); }
    .btn-xs {
      background: rgba(15,23,42,.4);
      border: 1px solid rgba(148,163,184,.1);
      border-radius: 999px;
      color: var(--text);
      font-size: .65rem;
      padding: 3px 8px;
      cursor: pointer;
    }
    .btn-danger {
      background: rgba(244,63,94,.1);
      border-color: rgba(244,63,94,.4);
      color: #ffe4e6;
    }
    .hidden { display: none; }

    /* modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(2,6,23,.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    .modal-backdrop.show { display: flex; }
    .modal {
      background: #0f172a;
      border: 1px solid rgba(148,163,184,.2);
      border-radius: 16px;
      padding: 16px;
      width: min(100% - 40px, 700px);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .modal h2 { margin: 0; }
    .modal .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }
    .modal label {
      font-size: .65rem;
      color: var(--muted);
    }
    .modal input, .modal select {
      width: 100%;
      background: rgba(15,23,42,.3);
      border: 1px solid rgba(148,163,184,.2);
      border-radius: 9px;
      padding: 5px 7px;
      color: var(--text);
      font-size: .72rem;
    }
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo-canarinhos2.png" class="logo-icon" alt="logo" />
    <div class="header-txt">
      <h1>Transportes Canarinho</h1>
      <small>Buscando entregar o melhor com qualidade.</small>
    </div>
    <div class="header-title">ESTOQUE DE PNEUS</div>
  </header>

  <main>
    <div class="tabs">
      <button class="tab-btn active" data-tab="estoque">Estoque</button>
      <button class="tab-btn" data-tab="saidas">Saídas</button>
      <button class="tab-btn" data-tab="recapagem">Recapagem</button>
      <button class="tab-btn" data-tab="descarte">Descarte</button>
    </div>

    <!-- ESTOQUE -->
    <div id="tab-estoque">
      <div class="toolbar">
        <input id="searchInput" class="input" placeholder="Buscar por FOGO ou nome" />
        <select id="categoryFilter" class="input">
          <option value="">Todas as categorias</option>
        </select>
        <button class="btn" id="newItemBtn">+ Novo pneu</button>
      </div>
      <div class="card">
        <table>
          <thead>
            <tr>
              <th>FOGO</th>
              <th>Nome</th>
              <th>Categoria</th>
              <th>Marca</th>
              <th>Modelo</th>
              <th>Tam.</th>
              <th>Qtd</th>
              <th>Reposição</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="itemsBody"></tbody>
        </table>
      </div>
    </div>

    <!-- SAÍDAS -->
    <div id="tab-saidas" class="hidden">
      <div class="card">
        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th>Item</th>
              <th>Qtd</th>
              <th>Placa</th>
              <th>Obs</th>
              <th>Ação</th>
            </tr>
          </thead>
          <tbody id="movesBody"></tbody>
        </table>
      </div>
    </div>

    <!-- RECAPAGEM -->
    <div id="tab-recapagem" class="hidden">
      <p style="color: var(--muted);">(base) aqui só mostramos a lista depois</p>
      <div class="card">
        <table>
          <thead><tr><th>Data</th><th>FOGO</th><th>Qtd</th><th>Status</th></tr></thead>
          <tbody id="recapBody"></tbody>
        </table>
      </div>
    </div>

    <!-- DESCARTE -->
    <div id="tab-descarte" class="hidden">
      <p style="color: var(--muted);">(base) aqui só mostramos a lista depois</p>
      <div class="card">
        <table>
          <thead><tr><th>Data</th><th>FOGO</th><th>Qtd</th><th>Motivo</th></tr></thead>
          <tbody id="descBody"></tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- MODAL ITEM -->
  <div class="modal-backdrop" id="itemModal">
    <div class="modal">
      <h2 id="itemModalTitle">Novo pneu</h2>
      <div class="grid">
        <div>
          <label for="mId">FOGO</label>
          <input id="mId" type="text">
        </div>
        <div>
          <label for="mName">Nome</label>
          <input id="mName" type="text">
        </div>
        <div>
          <label for="mCategory">Categoria</label>
          <input id="mCategory" type="text" value="Pneu">
        </div>
        <div>
          <label for="mMarca">Marca</label>
          <select id="mMarca"></select>
        </div>
        <div>
          <label for="mModelo">Modelo</label>
          <select id="mModelo"></select>
        </div>
        <div>
          <label for="mTamanho">Tamanho</label>
          <input id="mTamanho" type="text" value="295/80">
        </div>
        <div>
          <label for="mQty">Quantidade</label>
          <input id="mQty" type="number" value="0" min="0">
        </div>
        <div>
          <label for="mReorder">Reposição</label>
          <input id="mReorder" type="number" value="0" min="0">
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn-xs" onclick="closeItemModal()">Cancelar</button>
        <button class="btn" onclick="saveItem()">Salvar</button>
      </div>
    </div>
  </div>

  <script>
    /* ====== DADOS FIXOS DE MARCA/MODELO ====== */
    const TIRE_DATA = {
      "Michelin": [
        { model: "X Multi Z", size: "295/80" },
        { model: "X Multi D", size: "295/80" }
      ],
      "Pirelli": [
        { model: "FG-01 MISTO", size: "295/80" }
      ],
      "Goodyear": [
        { model: "Kmax D", size: "295/80" }
      ]
    };

    /* ====== ESTADO ====== */
    const LS_ITEMS = "pneus_base_items";
    const LS_MOVES  = "pneus_base_moves";

    let items = loadLS(LS_ITEMS, [
      { id: "F-001", name: "Pneu 295/80", category: "Pneu", marca: "Michelin", modelo: "X Multi Z", tamanho: "295/80", qty: 9, reorderPoint: 3 },
      { id: "F-002", name: "Pneu 295/80", category: "Pneu", marca: "Pirelli",  modelo: "FG-01 MISTO", tamanho: "295/80", qty: 4, reorderPoint: 2 }
    ]);
    let moves = loadLS(LS_MOVES, []);
    let editTarget = null;

    function loadLS(key, fallback){
      const raw = localStorage.getItem(key);
      if(!raw) return fallback;
      try { return JSON.parse(raw); } catch(e){ return fallback; }
    }
    function saveLS(){
      localStorage.setItem(LS_ITEMS, JSON.stringify(items));
      localStorage.setItem(LS_MOVES, JSON.stringify(moves));
    }

    /* ====== RENDER ====== */
    function renderItems(){
      const tbody = document.getElementById("itemsBody");
      const term = document.getElementById("searchInput").value.toLowerCase();
      const cat = document.getElementById("categoryFilter").value;
      tbody.innerHTML = "";
      items
        .filter(it => {
          let ok = true;
          if(term){
            ok = (it.id && it.id.toLowerCase().includes(term)) ||
                 (it.name && it.name.toLowerCase().includes(term));
          }
          if(ok && cat){
            ok = (it.category || "") === cat;
          }
          return ok;
        })
        .forEach(it => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${it.id}</td>
            <td>${it.name || ""}</td>
            <td>${it.category || ""}</td>
            <td>${it.marca || ""}</td>
            <td>${it.modelo || ""}</td>
            <td>${it.tamanho || ""}</td>
            <td>${it.qty ?? 0}</td>
            <td>${it.reorderPoint ?? 0}</td>
            <td>
              <button class="btn-xs" onclick="openItemModal('${it.id}')">Editar</button>
              <button class="btn-xs" onclick="openAdjust('${it.id}')">Ajustar</button>
              <button class="btn-xs btn-danger" onclick="deleteItem('${it.id}')">Excluir</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
    }

    function renderMoves(){
      const tbody = document.getElementById("movesBody");
      tbody.innerHTML = "";
      moves.forEach(m => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${m.date}</td>
          <td>${m.itemId}</td>
          <td>${m.qty}</td>
          <td>${m.plate || ""}</td>
          <td>${m.notes || ""}</td>
          <td><button class="btn-xs btn-danger" onclick="removeMove('${m.id}')">Voltar</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    /* ====== MODAL ITEM ====== */
    function openItemModal(id){
      const modal = document.getElementById("itemModal");
      fillMarcaSelect(document.getElementById("mMarca"));
      // padrão: primeira marca
      const firstMarca = document.getElementById("mMarca").value;
      fillModeloSelect(document.getElementById("mModelo"), firstMarca);

      if(id){
        editTarget = items.find(i => i.id === id);
        document.getElementById("itemModalTitle").textContent = "Editar pneu";
        document.getElementById("mId").value = editTarget.id;
        document.getElementById("mName").value = editTarget.name || "";
        document.getElementById("mCategory").value = editTarget.category || "Pneu";
        document.getElementById("mMarca").value = editTarget.marca || firstMarca;
        fillModeloSelect(document.getElementById("mModelo"), document.getElementById("mMarca").value);
        document.getElementById("mModelo").value = editTarget.modelo || "";
        document.getElementById("mTamanho").value = editTarget.tamanho || "295/80";
        document.getElementById("mQty").value = editTarget.qty ?? 0;
        document.getElementById("mReorder").value = editTarget.reorderPoint ?? 0;
      } else {
        editTarget = null;
        document.getElementById("itemModalTitle").textContent = "Novo pneu";
        document.getElementById("mId").value = "";
        document.getElementById("mName").value = "";
        document.getElementById("mCategory").value = "Pneu";
        document.getElementById("mMarca").value = firstMarca;
        fillModeloSelect(document.getElementById("mModelo"), firstMarca);
        document.getElementById("mTamanho").value = "295/80";
        document.getElementById("mQty").value = 0;
        document.getElementById("mReorder").value = 0;
      }
      modal.classList.add("show");
    }
    function closeItemModal(){
      document.getElementById("itemModal").classList.remove("show");
    }
    function saveItem(){
      const id = document.getElementById("mId").value.trim();
      if(!id){ alert("Informe o FOGO"); return; }
      const obj = {
        id,
        name: document.getElementById("mName").value.trim(),
        category: document.getElementById("mCategory").value.trim() || "Pneu",
        marca: document.getElementById("mMarca").value,
        modelo: document.getElementById("mModelo").value,
        tamanho: document.getElementById("mTamanho").value.trim() || "295/80",
        qty: parseInt(document.getElementById("mQty").value || "0",10),
        reorderPoint: parseInt(document.getElementById("mReorder").value || "0",10)
      };
      if(editTarget){
        Object.assign(editTarget, obj);
      } else {
        items.push(obj);
        refreshCategoryFilter();
      }
      saveLS();
      renderItems();
      closeItemModal();
    }

    /* ====== AJUSTE RÁPIDO ====== */
    function openAdjust(id){
      const it = items.find(i => i.id === id);
      if(!it) return;
      const qtd = parseInt(prompt("Quantidade (use número negativo para saída):", "1") || "0", 10);
      if(!qtd) return;
      it.qty = (it.qty || 0) + qtd;
      if(qtd < 0){
        moves.push({
          id: "mov_" + Date.now(),
          date: new Date().toLocaleString("pt-BR"),
          itemId: it.id,
          qty: Math.abs(qtd)
        });
      }
      saveLS();
      renderItems();
      renderMoves();
    }
    function removeMove(mid){
      const m = moves.find(m => m.id === mid);
      if(!m) return;
      const it = items.find(i => i.id === m.itemId);
      if(it) it.qty = (it.qty || 0) + (m.qty || 0);
      moves = moves.filter(m => m.id !== mid);
      saveLS();
      renderItems();
      renderMoves();
    }

    /* ====== DELETE ====== */
    function deleteItem(id){
      if(!confirm("Excluir este pneu?")) return;
      items = items.filter(i => i.id !== id);
      saveLS();
      refreshCategoryFilter();
      renderItems();
    }

    /* ====== SELECTS DE MARCA/MODELO ====== */
    function fillMarcaSelect(sel){
      sel.innerHTML = "";
      Object.keys(TIRE_DATA).forEach(m => {
        const op = document.createElement("option");
        op.value = m;
        op.textContent = m;
        sel.appendChild(op);
      });
    }
    function fillModeloSelect(sel, marca){
      sel.innerHTML = "";
      const arr = TIRE_DATA[marca] || [];
      if(arr.length === 0){
        const op = document.createElement("option");
        op.value = "";
        op.textContent = "Modelo livre";
        sel.appendChild(op);
      } else {
        arr.forEach(obj => {
          const op = document.createElement("option");
          op.value = obj.model;
          op.textContent = obj.model;
          sel.appendChild(op);
        });
      }
    }

    /* ====== CATEGORIAS ====== */
    function refreshCategoryFilter(){
      const sel = document.getElementById("categoryFilter");
      const current = sel.value;
      const cats = [...new Set(items.map(i => i.category).filter(Boolean))];
      sel.innerHTML = `<option value="">Todas as categorias</option>`;
      cats.forEach(c => {
        const op = document.createElement("option");
        op.value = c;
        op.textContent = c;
        sel.appendChild(op);
      });
      if(cats.includes(current)) sel.value = current;
    }

    /* ====== TABS ====== */
    document.addEventListener("DOMContentLoaded", () => {
      // tabs
      document.querySelectorAll(".tab-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          const tab = btn.dataset.tab;
          document.querySelectorAll("main > div[id^='tab-']").forEach(div => {
            div.classList.toggle("hidden", div.id !== "tab-" + tab);
          });
        });
      });

      document.getElementById("newItemBtn").addEventListener("click", () => openItemModal(null));
      document.getElementById("searchInput").addEventListener("input", renderItems);
      document.getElementById("categoryFilter").addEventListener("change", renderItems);

      refreshCategoryFilter();
      renderItems();
      renderMoves();

      // quando troca marca no modal
      document.addEventListener("change", (e) => {
        if(e.target.id === "mMarca"){
          fillModeloSelect(document.getElementById("mModelo"), e.target.value);
        }
      });
    });

    // expõe funções
    window.openItemModal = openItemModal;
    window.closeItemModal = closeItemModal;
    window.saveItem = saveItem;
    window.openAdjust = openAdjust;
    window.deleteItem = deleteItem;
    window.removeMove = removeMove;
  </script>
</body>
</html>
