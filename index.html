<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Transportes Canarinho - Controle de Pneus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0f172a" />
<meta name="apple-mobile-web-app-capable" content="yes">
<<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- APENAS 3 √çCONES ESSENCIAIS -->
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="192x192" href="android-icon-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --accent: #38bdf8;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --danger: #f43f5e;
      --warn: #f97316;
      --success: #10b981;
      --radius: 12px;
    }
    * {
      box-sizing: border-box;
      font-family: "Segoe UI", system-ui, sans-serif;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 70px;
      overflow-x: hidden;
    }
    header {
      padding: 16px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.12);
      background: rgba(2, 6, 23, 0.78);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    header h1 {
      margin: 0;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    main {
      padding: 15px;
    }
    
    /* Navega√ß√£o por tabs - Mobile */
    .tabs-container {
      position: sticky;
      top: 60px;
      background: var(--bg);
      z-index: 90;
      padding: 10px 0;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }
    .tabs-scroll {
      display: flex;
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding: 0 15px;
      gap: 8px;
    }
    .tabs-scroll::-webkit-scrollbar {
      display: none;
    }
    .tab-btn {
      background: rgba(15, 23, 42, 0.3);
      border: 1px solid rgba(148, 163, 184, 0.2);
      color: var(--text);
      padding: 10px 16px;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
      flex-shrink: 0;
      font-size: 0.9rem;
    }
    .tab-btn.active {
      background: var(--accent);
      color: #020617;
    }
    .hidden {
      display: none !important;
    }
    
    /* Toolbar mobile */
    .toolbar {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }
    .toolbar-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .input, select, button {
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(15, 23, 42, 0.6);
      color: var(--text);
      font-size: 1rem;
    }
    button {
      background: var(--accent);
      color: #020617;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    /* Cards e listas mobile */
    .card {
      background: rgba(2, 6, 23, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 15px;
    }
    .card-header {
      padding: 15px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }
    .card-body {
      padding: 0;
    }
    
    /* Lista mobile para itens */
    .item-list {
      display: flex;
      flex-direction: column;
    }
    .item-row {
      display: flex;
      padding: 15px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      align-items: center;
      gap: 12px;
    }
    .item-row:last-child {
      border-bottom: none;
    }
    .item-image {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      flex-shrink: 0;
    }
    .item-details {
      flex: 1;
      min-width: 0;
    }
    .item-title {
      font-weight: 600;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .item-subtitle {
      color: var(--muted);
      font-size: 0.85rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .item-meta {
      display: flex;
      gap: 8px;
      margin-top: 6px;
      flex-wrap: wrap;
    }
    .badge {
      background: rgba(15, 23, 42, 0.6);
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      display: inline-block;
    }
    .qty-low {
      background: rgba(244, 63, 94, 0.2);
      color: #ffe4e6;
    }
    .actions {
      display: flex;
      gap: 5px;
      flex-shrink: 0;
    }
    .btn-xs {
      padding: 6px 10px;
      font-size: 0.8rem;
      background: rgba(15, 23, 42, 0.4);
      color: var(--text);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-danger {
      background: rgba(244, 63, 94, 0.2);
      color: #ffe4e6;
    }
    
    /* Stats grid mobile */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    .stat-card {
      background: rgba(15, 23, 42, 0.4);
      padding: 15px;
      border-radius: var(--radius);
      text-align: center;
      border: 1px solid rgba(148, 163, 184, 0.1);
    }
    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .stat-label {
      font-size: 0.75rem;
      color: var(--muted);
      font-weight: 500;
    }
    .stat-novo {
      color: #38bdf8;
    }
    .stat-recapado {
      color: #10b981;
    }
    .stat-usado {
      color: #f97316;
    }
    .stat-total {
      color: #818cf8;
    }
    
    /* Container buttons mobile */
    .container-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding: 5px 0;
    }
    .container-buttons::-webkit-scrollbar {
      display: none;
    }
    .container-btn {
      flex: 1;
      min-width: 100px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.2);
      color: var(--text);
      padding: 12px;
      border-radius: var(--radius);
      cursor: pointer;
      text-align: center;
      transition: all 0.3s;
      white-space: nowrap;
    }
    .container-btn.active {
      background: var(--accent);
      color: #020617;
      border-color: var(--accent);
    }
    
    /* Modais mobile */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(2, 6, 23, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 15px;
    }
    .modal {
      background: var(--bg);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: var(--radius);
      padding: 20px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal h2 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.3rem;
    }
    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 15px;
    }
    .field-row {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 10px;
    }
    .field-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    label {
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    /* Notifica√ß√µes mobile */
    .notification {
      position: fixed;
      top: 20px;
      left: 15px;
      right: 15px;
      padding: 12px 20px;
      border-radius: var(--radius);
      color: white;
      z-index: 1001;
      animation: slideIn 0.3s ease;
      text-align: center;
    }
    .notification.success { background: var(--success); }
    .notification.error { background: var(--danger); }
    .notification.warning { background: var(--warn); }
    @keyframes slideIn {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* Status de conex√£o mobile */
    .connection-status {
      position: fixed;
      bottom: 70px;
      right: 15px;
      padding: 8px 12px;
      border-radius: var(--radius);
      font-size: 0.7rem;
      z-index: 1000;
    }
    .connection-online {
      background: var(--success);
      color: white;
    }
    .connection-offline {
      background: var(--danger);
      color: white;
    }
    .sync-indicator {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      margin-right: 5px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    /* Barra de navega√ß√£o inferior mobile */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(2, 6, 23, 0.9);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(148, 163, 184, 0.1);
      display: flex;
      padding: 10px 15px;
      z-index: 99;
    }
    .nav-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      background: none;
      border: none;
      color: var(--muted);
      padding: 8px 0;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    .nav-btn.active {
      color: var(--accent);
    }
    .nav-icon {
      font-size: 1.2rem;
    }
    
    /* Checkbox mobile */
    .checkbox-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .fogo-checkbox {
      width: 18px;
      height: 18px;
    }
    
    /* Sele√ß√£o de fogos */
    .selected-count {
      background: rgba(56, 189, 248, 0.2);
      padding: 10px;
      border-radius: var(--radius);
      margin-bottom: 10px;
      text-align: center;
    }
    
    /* Bot√µes de a√ß√£o flutuantes */
    .fab {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--accent);
      color: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      z-index: 98;
      transition: all 0.3s;
    }
    
    /* Mensagem de lista vazia */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 15px;
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <header>
    <h1>üöö Transportes Canarinho</h1>
    <div id="connectionStatus" class="connection-status hidden">
      <span class="sync-indicator"></span>
      <span id="connectionText">Conectado</span>
    </div>
  </header>
  
  <div class="tabs-container">
    <div class="tabs-scroll">
      <button class="tab-btn active" data-tab="container">Container</button>
      <button class="tab-btn" data-tab="fogo">Fogos</button>
      <button class="tab-btn" data-tab="recapagem">Recapagem</button>
      <button class="tab-btn" data-tab="saidas">Sa√≠das</button>
      <button class="tab-btn" data-tab="alertas">Alertas</button>
    </div>
  </div>

  <main>
    <!-- CONTAINER -->
    <div id="tab-container" class="tab-content">
      <!-- Estat√≠sticas -->
      <div class="stats-grid" id="statsContainer">
        <div class="stat-card">
          <div class="stat-value stat-total">0</div>
          <div class="stat-label">ESTOQUE</div>
        </div>
        <div class="stat-card">
          <div class="stat-value stat-novo">0</div>
          <div class="stat-label">COM FOGO</div>
        </div>
        <div class="stat-card">
          <div class="stat-value stat-recapado">0</div>
          <div class="stat-label">RECAPADOS</div>
        </div>
        <div class="stat-card">
          <div class="stat-value stat-usado">0</div>
          <div class="stat-label">USADOS</div>
        </div>
      </div>

      <!-- Container buttons -->
      <div class="container-buttons">
        <button class="container-btn active" data-container="container1">Container 1</button>
        <button class="container-btn" data-container="container2">Container 2</button>
        <button class="container-btn" data-container="container3">Container 3</button>
      </div>

      <!-- Toolbar -->
      <div class="toolbar">
        <div class="toolbar-row">
          <input type="text" id="searchInput" class="input" placeholder="Buscar..." style="flex:1;">
          <select id="statusFilter" class="input">
            <option value="">Todos</option>
            <option value="Novo">Novo</option>
            <option value="Usado">Usado</option>
            <option value="Reformado">Reformado</option>
          </select>
        </div>
        <div class="toolbar-row">
          <button onclick="exportData()" class="btn-xs" style="background: rgba(16, 185, 129, 0.2); color: #d1fae5;">Exportar</button>
          <button onclick="exportToExcel()" class="btn-xs" style="background: rgba(147, 51, 234, 0.2); color: #e9d5ff;">Excel</button>
          <label for="importInput" class="btn-xs" style="background: rgba(249, 115, 22, 0.2); color: #ffedd5; cursor: pointer;">
            Importar
            <input type="file" id="importInput" accept=".json" style="display: none;" onchange="importData(event)">
          </label>
        </div>
      </div>

      <!-- Container 1 -->
      <div id="container1-content" class="container-content">
        <div class="card">
          <div class="card-header">
            <h3>Container 1</h3>
            <div id="itemsCount" style="color: var(--muted); font-size: 0.9rem;">0 pneu(s)</div>
          </div>
          <div class="card-body">
            <div class="item-list" id="tableBody">
              <div class="empty-state">
                <div class="empty-state-icon">üõû</div>
                <p>Nenhum pneu cadastrado</p>
                <p style="font-size: 0.8rem; margin-top: 10px;">Toque no bot√£o + para adicionar</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Container 2 -->
      <div id="container2-content" class="container-content hidden">
        <div class="card">
          <div class="card-header">
            <h3>Container 2</h3>
            <div id="itemsCount2" style="color: var(--muted); font-size: 0.9rem;">0 pneu(s)</div>
          </div>
          <div class="card-body">
            <div class="item-list" id="tableBody2">
              <div class="empty-state">
                <div class="empty-state-icon">üõû</div>
                <p>Nenhum pneu cadastrado</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Container 3 -->
      <div id="container3-content" class="container-content hidden">
        <div class="card">
          <div class="card-header">
            <h3>Container 3</h3>
            <div id="itemsCount3" style="color: var(--muted); font-size: 0.9rem;">0 pneu(s)</div>
          </div>
          <div class="card-body">
            <div class="item-list" id="tableBody3">
              <div class="empty-state">
                <div class="empty-state-icon">üõû</div>
                <p>Nenhum pneu cadastrado</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CONTROLE POR FOGO -->
    <div id="tab-fogo" class="tab-content hidden">
      <div class="toolbar">
        <input type="text" id="fogoSearchInput" class="input" placeholder="Buscar fogos..." style="flex:1;">
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3>Controle por Fogo</h3>
          <div id="fogoCount" style="color: var(--muted); font-size: 0.9rem;">0 fogo(s)</div>
        </div>
        <div class="card-body">
          <div class="item-list" id="fogoTableBody">
            <div class="empty-state">
              <div class="empty-state-icon">üî•</div>
              <p>Nenhum fogo cadastrado</p>
              <p style="font-size: 0.8rem; margin-top: 10px;">Transfira pneus do container</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- OUTRAS ABAS (simplificadas para mobile) -->
    <div id="tab-recapagem" class="tab-content hidden">
      <div class="empty-state">
        <div class="empty-state-icon">üîÑ</div>
        <p>M√≥dulo de Recapagem</p>
        <p style="font-size: 0.8rem; margin-top: 10px;">Em desenvolvimento</p>
      </div>
    </div>

    <div id="tab-saidas" class="tab-content hidden">
      <div class="empty-state">
        <div class="empty-state-icon">üì§</div>
        <p>Controle de Sa√≠das</p>
        <p style="font-size: 0.8rem; margin-top: 10px;">Use a aba Fogos para registrar sa√≠das</p>
      </div>
    </div>

    <div id="tab-alertas" class="tab-content hidden">
      <div class="empty-state">
        <div class="empty-state-icon">‚ö†Ô∏è</div>
        <p>Alertas do Sistema</p>
        <p style="font-size: 0.8rem; margin-top: 10px;">Em desenvolvimento</p>
      </div>
    </div>

    <!-- Bot√£o de a√ß√£o flutuante -->
    <div class="fab" id="fabButton" onclick="openEditModal()">
      +
    </div>
  </main>

  <!-- Barra de navega√ß√£o inferior -->
  <div class="bottom-nav">
    <button class="nav-btn active" data-tab="container">
      <span class="nav-icon">üì¶</span>
      <span>Container</span>
    </button>
    <button class="nav-btn" data-tab="fogo">
      <span class="nav-icon">üî•</span>
      <span>Fogos</span>
    </button>
    <button class="nav-btn" data-tab="recapagem">
      <span class="nav-icon">üîÑ</span>
      <span>Recapagem</span>
    </button>
    <button class="nav-btn" data-tab="saidas">
      <span class="nav-icon">üì§</span>
      <span>Sa√≠das</span>
    </button>
    <button class="nav-btn" data-tab="alertas">
      <span class="nav-icon">‚ö†Ô∏è</span>
      <span>Alertas</span>
    </button>
  </div>

  <!-- Modal Editar Pneu -->
  <div class="modal-backdrop" id="editModal">
    <div class="modal">
      <h2 id="editTitle">Novo Pneu</h2>
      
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div class="field-group">
          <label for="editMedida">Medida *</label>
          <input type="text" id="editMedida" class="input" placeholder="295/80 R22.5">
        </div>

        <div class="field-row">
          <div class="field-group">
            <label for="editMarca">Marca *</label>
            <input type="text" id="editMarca" class="input" placeholder="Michelin">
          </div>
          <div class="field-group">
            <label for="editModelo">Modelo *</label>
            <input type="text" id="editModelo" class="input" placeholder="X Line Energy">
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <label for="editDataEntrada">Data de Entrada *</label>
            <input type="date" id="editDataEntrada" class="input">
          </div>
          <div class="field-group">
            <label for="editQty">Quantidade *</label>
            <input type="number" id="editQty" class="input" min="0" value="0">
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <label for="editStatus">Status</label>
            <select id="editStatus" class="input">
              <option value="Novo">Novo</option>
              <option value="Usado">Usado</option>
              <option value="Reformado">Reformado</option>
            </select>
          </div>
          <div class="field-group">
            <label for="editContainer">Container</label>
            <select id="editContainer" class="input">
              <option value="container1">Container 1</option>
              <option value="container2">Container 2</option>
              <option value="container3">Container 3</option>
            </select>
          </div>
        </div>

        <div class="field-group">
          <label for="editPreco">Pre√ßo (R$)</label>
          <input type="number" id="editPreco" class="input" step="0.01" min="0" placeholder="0.00">
        </div>

        <div class="field-group">
          <label for="editObservacoes">Observa√ß√µes</label>
          <textarea id="editObservacoes" class="input" placeholder="Observa√ß√µes..." style="width: 100%; height: 60px;"></textarea>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-xs" onclick="closeEditModal()">Cancelar</button>
        <button onclick="saveItem()">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Modal Transferir para Fogo -->
  <div class="modal-backdrop" id="transferModal">
    <div class="modal">
      <h2>Transferir para Fogo</h2>
      
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div class="field-group">
          <label for="transferMedida">Medida</label>
          <input type="text" id="transferMedida" class="input" readonly>
        </div>

        <div class="field-row">
          <div class="field-group">
            <label for="transferMarca">Marca</label>
            <input type="text" id="transferMarca" class="input" readonly>
          </div>
          <div class="field-group">
            <label for="transferModelo">Modelo</label>
            <input type="text" id="transferModelo" class="input" readonly>
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <label for="transferData">Data</label>
            <input type="date" id="transferData" class="input">
          </div>
          <div class="field-group">
            <label for="transferQty">Quantidade</label>
            <input type="number" id="transferQty" class="input" min="1" value="1">
          </div>
        </div>

        <div class="field-group">
          <label for="startFogo">N√∫mero Inicial do Fogo</label>
          <input type="number" id="startFogo" class="input" min="1" value="23450" placeholder="Ex: 23450">
        </div>

        <div class="field-group">
          <label>Pneus a transferir:</label>
          <div style="max-height: 200px; overflow-y: auto; margin-top: 10px;">
            <div class="card">
              <div class="card-body">
                <div id="transferListBody">
                  <!-- Ser√° preenchido dinamicamente -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-xs" onclick="closeTransferModal()">Cancelar</button>
        <button onclick="confirmTransfer()">Transferir</button>
      </div>
    </div>
  </div>

  <!-- Modal Sa√≠da de Fogos -->
  <div class="modal-backdrop" id="saidaModal">
    <div class="modal">
      <h2>Sa√≠da de Fogos</h2>
      
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <div id="selectedFogosCount" class="selected-count">
          Nenhum fogo selecionado
        </div>

        <div class="field-row">
          <div class="field-group">
            <label for="saidaData">Data de Sa√≠da</label>
            <input type="date" id="saidaData" class="input">
          </div>
          <div class="field-group">
            <label for="saidaMotivo">Motivo</label>
            <select id="saidaMotivo" class="input">
              <option value="venda">Venda</option>
              <option value="uso">Uso em Ve√≠culo</option>
              <option value="descarte">Descarte</option>
              <option value="outro">Outro</option>
            </select>
          </div>
        </div>

        <div class="field-group">
          <label for="saidaObservacoes">Observa√ß√µes</label>
          <textarea id="saidaObservacoes" class="input" placeholder="Observa√ß√µes..." style="width: 100%; height: 60px;"></textarea>
        </div>

        <div class="field-group">
          <label>Fogos selecionados:</label>
          <div style="max-height: 200px; overflow-y: auto; margin-top: 10px;">
            <div class="card">
              <div class="card-body">
                <div id="saidaListBody">
                  <!-- Ser√° preenchido dinamicamente -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-xs" onclick="closeSaidaModal()">Cancelar</button>
        <button onclick="confirmSaida()" class="btn-danger">Confirmar Sa√≠da</button>
      </div>
    </div>
  </div>

  <script>
    // =============================================
    // CONFIGURA√á√ÉO DO FIREBASE
    // =============================================
    
    const firebaseConfig = {
      apiKey: "AIzaSyABu5q020yrtRvtZnyFg0-tSvQgsYwthpE",
      authDomain: "controlepneus-canarinho-27af6.firebaseapp.com",
      projectId: "controlepneus-canarinho-27af6",
      storageBucket: "controlepneus-canarinho-27af6.firebasestorage.app",
      messagingSenderId: "94971984157",
      appId: "1:94971984157:web:72b451a99a9ae39b65994"
    };

    // =============================================
    // INICIALIZA√á√ÉO DO FIREBASE
    // =============================================
    
    let db = null;
    let isOnline = false;

    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      isOnline = true;
      console.log('Firebase conectado com sucesso!');
      updateConnectionStatus(true);
    } catch (error) {
      console.log('Firebase n√£o configurado, usando localStorage:', error);
      isOnline = false;
      updateConnectionStatus(false);
    }

    // =============================================
    // DADOS INICIAIS
    // =============================================
    
    let items = [];
    let fogos = [];
    let currentItem = null;
    let currentContainer = "container1";
    let currentTransferItem = null;
    let selectedFogos = new Set();

    // =============================================
    // FUN√á√ïES DO BANCO DE DADOS
    // =============================================

    async function saveData() {
      const data = {
        items: items,
        fogos: fogos,
        lastUpdate: new Date().toISOString()
      };

      localStorage.setItem('tc_pneus', JSON.stringify(items));
      localStorage.setItem('tc_fogos', JSON.stringify(fogos));

      if (isOnline && db) {
        try {
          await db.collection('system').doc('pneusData').set(data);
          console.log('Dados salvos no Firebase');
        } catch (error) {
          console.error('Erro ao salvar no Firebase:', error);
        }
      }
    }

    async function loadData() {
      if (isOnline && db) {
        try {
          const doc = await db.collection('system').doc('pneusData').get();
          if (doc.exists) {
            const data = doc.data();
            items = data.items || [];
            fogos = data.fogos || [];
            console.log('Dados carregados do Firebase');
            return true;
          }
        } catch (error) {
          console.error('Erro ao carregar do Firebase:', error);
        }
      }

      const localItems = localStorage.getItem('tc_pneus');
      const localFogos = localStorage.getItem('tc_fogos');
      
      if (localItems) items = JSON.parse(localItems);
      if (localFogos) fogos = JSON.parse(localFogos);
      
      console.log('Dados carregados do localStorage');
      return false;
    }

    function setupRealtimeSync() {
      if (!isOnline || !db) return;

      db.collection('system').doc('pneusData')
        .onSnapshot((doc) => {
          if (doc.exists) {
            const data = doc.data();
            const currentData = JSON.stringify({ items, fogos });
            const newData = JSON.stringify({ 
              items: data.items || [], 
              fogos: data.fogos || [] 
            });
            
            if (currentData !== newData) {
              items = data.items || [];
              fogos = data.fogos || [];
              renderTable();
              renderStats();
              renderFogoTable();
              showNotification('Dados atualizados!', 'success');
            }
          }
        });
    }

    function updateConnectionStatus(online) {
      isOnline = online;
      const statusElement = document.getElementById('connectionStatus');
      const textElement = document.getElementById('connectionText');
      
      if (online) {
        statusElement.classList.remove('hidden', 'connection-offline');
        statusElement.classList.add('connection-online');
        textElement.textContent = 'Conectado';
      } else {
        statusElement.classList.remove('hidden', 'connection-online');
        statusElement.classList.add('connection-offline');
        textElement.textContent = 'Offline';
      }
    }

    // =============================================
    // FUN√á√ïES PRINCIPAIS DO SISTEMA
    // =============================================

    document.addEventListener('DOMContentLoaded', async function() {
      console.log('DOM carregado, inicializando...');
      await init();
    });

    async function init() {
      console.log('Inicializando aplica√ß√£o...');
      
      await loadData();
      
      if (items.length === 0 && fogos.length === 0) {
        items = [
          { 
            id: "PNEU-001", 
            medida: "295/80 R22.5",
            marca: "Michelin",
            modelo: "X Line Energy",
            dataEntrada: "2024-01-15",
            status: "Novo",
            qty: 8,
            preco: 1250.00,
            observacoes: "",
            container: "container1"
          }
        ];
        fogos = [];
        await saveData();
      }
      
      updateConnectionStatus(isOnline);
      setupEventListeners();
      renderTable();
      renderStats();
      renderFogoTable();
      setupRealtimeSync();
    }

    function setupEventListeners() {
      // Tabs superiores
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
          this.classList.add('active');
          document.getElementById('tab-' + this.dataset.tab).classList.remove('hidden');
          updateFabButton(this.dataset.tab);
        });
      });

      // Navega√ß√£o inferior
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
          
          this.classList.add('active');
          const tabName = this.dataset.tab;
          
          // Ativar tab correspondente
          document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');
          document.getElementById('tab-' + tabName).classList.remove('hidden');
          
          updateFabButton(tabName);
        });
      });

      // Containers
      document.querySelectorAll('.container-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.container-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.container-content').forEach(content => content.classList.add('hidden'));
          this.classList.add('active');
          document.getElementById(this.dataset.container + '-content').classList.remove('hidden');
          currentContainer = this.dataset.container;
          renderTable();
        });
      });

      // Filtros
      document.getElementById('searchInput').addEventListener('input', renderTable);
      document.getElementById('statusFilter').addEventListener('change', renderTable);
      document.getElementById('fogoSearchInput').addEventListener('input', renderFogoTable);

      // Transfer√™ncia
      document.getElementById('transferQty').addEventListener('input', updateTransferList);
      document.getElementById('startFogo').addEventListener('input', updateTransferList);
    }

    function updateFabButton(tabName) {
      const fab = document.getElementById('fabButton');
      
      switch(tabName) {
        case 'container':
          fab.innerHTML = '+';
          fab.onclick = () => openEditModal();
          break;
        case 'fogo':
          fab.innerHTML = 'üì§';
          fab.onclick = () => openSaidaModal();
          break;
        default:
          fab.innerHTML = '+';
          fab.onclick = () => showNotification('Funcionalidade em desenvolvimento', 'warning');
      }
    }

    function renderTable() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const statusTerm = document.getElementById('statusFilter').value;

      const filtered = items.filter(item => {
        const matchSearch = item.medida.toLowerCase().includes(searchTerm) ||
                          item.marca.toLowerCase().includes(searchTerm) ||
                          item.modelo.toLowerCase().includes(searchTerm);
        const matchStatus = !statusTerm || item.status === statusTerm;
        const matchContainer = item.container === currentContainer;
        return matchSearch && matchStatus && matchContainer;
      });

      let tableBodyElement, countElement;
      
      if (currentContainer === 'container1') {
        tableBodyElement = document.getElementById('tableBody');
        countElement = document.getElementById('itemsCount');
      } else if (currentContainer === 'container2') {
        tableBodyElement = document.getElementById('tableBody2');
        countElement = document.getElementById('itemsCount2');
      } else if (currentContainer === 'container3') {
        tableBodyElement = document.getElementById('tableBody3');
        countElement = document.getElementById('itemsCount3');
      }

      if (filtered.length === 0) {
        tableBodyElement.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üõû</div>
            <p>Nenhum pneu encontrado</p>
          </div>
        `;
      } else {
        tableBodyElement.innerHTML = filtered.map(item => {
          const needsReorder = item.qty <= 5;
          const dataEntradaFormatada = item.dataEntrada ? 
            new Date(item.dataEntrada).toLocaleDateString('pt-BR') : '-';
          
          const imagemSrc = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiByeD0iNiIgZmlsbD0icmdiYSgxNSwgMjMsIDQyLCAwLjYpIi8+CjxwYXRoIGQ9Ik0zOCAyNkMzOCAyOC4yMDkxIDM2LjIwOTEgMzAgMzQgMzBDMzEuNzkwOSAzMCAzMCAyOC4yMDkxIDMwIDI2QzMwIDIzLjc5MDkgMzEuNzkwOSAyMiAzNCAyMkMzNi4yMDkxIDIyIDM4IDIzLjc5MDkgMzggMjZaIiBmaWxsPSJyZ2JhKDE0OCwgMTYzLCAxODQsIDAuNCkiLz4KPHBhdGggZD0iTTQyIDM4SDE4QzE2Ljg5NTQgMzggMTYgMzcuMTA0NiAxNiAzNlYyNEMxNiAyMi44OTU0IDE2Ljg5NTQgMjIgMTggMjJINDJDNDMuMTA0NiAyMiA0NCAyMi44OTU0IDQ0IDI0VjM2QzQ0IDM3LjEwNDYgNDMuMTA0NiAzOCA0MiAzOFpNMTggMjRWMzZINDJWMjRIMThaIiBmaWxsPSJyZ2JhKDE0OCwgMTYzLCAxODQsIDAuNCkiLz4KPC9zdmc+';
          
          return `
            <div class="item-row" onclick="openItemOptions('${item.id}')">
              <img src="${imagemSrc}" class="item-image" alt="${item.medida}">
              <div class="item-details">
                <div class="item-title">${item.medida}</div>
                <div class="item-subtitle">${item.marca} ‚Ä¢ ${item.modelo}</div>
                <div class="item-meta">
                  <span class="badge">${item.status}</span>
                  <span class="badge ${needsReorder ? 'qty-low' : ''}">Qtd: ${item.qty}</span>
                  <span class="badge">${dataEntradaFormatada}</span>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }

      countElement.textContent = `${filtered.length} pneu(s)`;
    }

    function renderFogoTable() {
      const searchTerm = document.getElementById('fogoSearchInput').value.toLowerCase();
      
      const filtered = fogos.filter(fogo => {
        return fogo.fogo.includes(searchTerm) ||
               fogo.medida.toLowerCase().includes(searchTerm) ||
               fogo.marca.toLowerCase().includes(searchTerm) ||
               fogo.modelo.toLowerCase().includes(searchTerm);
      });

      const tableBody = document.getElementById('fogoTableBody');
      const countElement = document.getElementById('fogoCount');

      if (filtered.length === 0) {
        tableBody.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üî•</div>
            <p>Nenhum fogo encontrado</p>
          </div>
        `;
      } else {
        tableBody.innerHTML = filtered.map(fogo => {
          const dataEntradaFormatada = fogo.dataEntrada ? 
            new Date(fogo.dataEntrada).toLocaleDateString('pt-BR') : '-';
          const isSelected = selectedFogos.has(fogo.id);
          
          return `
            <div class="item-row" onclick="toggleFogoSelection('${fogo.id}', ${!isSelected})">
              <div class="checkbox-container">
                <input type="checkbox" class="fogo-checkbox" ${isSelected ? 'checked' : ''} 
                       onchange="toggleFogoSelection('${fogo.id}', this.checked)">
              </div>
              <div class="item-details">
                <div class="item-title">Fogo ${fogo.fogo}</div>
                <div class="item-subtitle">${fogo.medida} ‚Ä¢ ${fogo.marca}</div>
                <div class="item-meta">
                  <span class="badge">${fogo.status}</span>
                  <span class="badge">${dataEntradaFormatada}</span>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }

      countElement.textContent = `${filtered.length} fogo(s)`;
      updateSelectedCount();
    }

    function renderStats() {
      // Calcular totais
      const estoqueContainer = items.reduce((sum, item) => sum + item.qty, 0);
      const pneusComFogo = fogos.length;
      const pneusRecapados = items.filter(item => item.status === "Reformado").reduce((sum, item) => sum + item.qty, 0);
      const pneusUsados = items.filter(item => item.status === "Usado").reduce((sum, item) => sum + item.qty, 0);

      // Atualizar os valores na interface
      document.getElementById('statsContainer').innerHTML = `
        <div class="stat-card">
          <div class="stat-value stat-total">${estoqueContainer}</div>
          <div class="stat-label">ESTOQUE</div>
        </div>
        <div class="stat-card">
          <div class="stat-value stat-novo">${pneusComFogo}</div>
          <div class="stat-label">COM FOGO</div>
        </div>
        <div class="stat-card">
          <div class="stat-value stat-recapado">${pneusRecapados}</div>
          <div class="stat-label">RECAPADOS</div>
        </div>
        <div class="stat-card">
          <div class="stat-value stat-usado">${pneusUsados}</div>
          <div class="stat-label">USADOS</div>
        </div>
      `;
    }

    // =============================================
    // FUN√á√ïES DE INTERA√á√ÉO MOBILE
    // =============================================

    function openItemOptions(itemId) {
      const item = items.find(item => item.id === itemId);
      if (!item) return;

      // Criar menu de a√ß√µes
      const actionMenu = `
        <div class="modal-backdrop" id="itemOptionsModal" style="display: flex; align-items: flex-end; justify-content: center;">
          <div class="modal" style="width: 100%; max-width: 100%; border-radius: 20px 20px 0 0; margin: 0;">
            <h3>${item.medida}</h3>
            <p style="color: var(--muted); margin-bottom: 20px;">${item.marca} ${item.modelo}</p>
            
            <div style="display: flex; flex-direction: column; gap: 10px;">
              <button class="btn-xs" style="padding: 15px; text-align: left;" onclick="openEditModal('${item.id}'); closeItemOptions()">
                ‚úèÔ∏è Editar Pneu
              </button>
              <button class="btn-xs" style="padding: 15px; text-align: left; background: rgba(249, 115, 22, 0.2); color: #ffedd5;" 
                      onclick="openTransferModal('${item.id}'); closeItemOptions()">
                üì§ Transferir para Fogo
              </button>
              <button class="btn-xs" style="padding: 15px; text-align: left; background: rgba(244, 63, 94, 0.2); color: #ffe4e6;" 
                      onclick="deleteItem('${item.id}'); closeItemOptions()">
                üóëÔ∏è Excluir Pneu
              </button>
              <button class="btn-xs" style="padding: 15px; text-align: left; margin-top: 10px;" onclick="closeItemOptions()">
                Cancelar
              </button>
            </div>
          </div>
        </div>
      `;
      
      // Remover menu anterior se existir
      const existingMenu = document.getElementById('itemOptionsModal');
      if (existingMenu) existingMenu.remove();
      
      // Adicionar novo menu
      document.body.insertAdjacentHTML('beforeend', actionMenu);
    }

    function closeItemOptions() {
      const modal = document.getElementById('itemOptionsModal');
      if (modal) modal.remove();
    }

    // =============================================
    // FUN√á√ïES DE SELE√á√ÉO DE FOGOS
    // =============================================

    function toggleFogoSelection(fogoId, isSelected) {
      if (isSelected) {
        selectedFogos.add(fogoId);
      } else {
        selectedFogos.delete(fogoId);
      }
      renderFogoTable();
    }

    function updateSelectedCount() {
      const countElement = document.getElementById('selectedFogosCount');
      const count = selectedFogos.size;
      
      if (count === 0) {
        countElement.textContent = 'Nenhum fogo selecionado';
        countElement.style.background = 'rgba(148, 163, 184, 0.2)';
      } else {
        countElement.textContent = `${count} fogo(s) selecionado(s)`;
        countElement.style.background = 'rgba(56, 189, 248, 0.2)';
      }
    }

    // =============================================
    // FUN√á√ïES EXISTENTES (adaptadas para mobile)
    // =============================================

    function openEditModal(itemId = null) {
      currentItem = itemId ? items.find(item => item.id === itemId) : null;
      
      const dataAtual = new Date().toISOString().split('T')[0];
      
      if (currentItem) {
        document.getElementById('editTitle').textContent = 'Editar Pneu';
        document.getElementById('editMedida').value = currentItem.medida;
        document.getElementById('editMarca').value = currentItem.marca;
        document.getElementById('editModelo').value = currentItem.modelo;
        document.getElementById('editDataEntrada').value = currentItem.dataEntrada || dataAtual;
        document.getElementById('editStatus').value = currentItem.status;
        document.getElementById('editQty').value = currentItem.qty;
        document.getElementById('editContainer').value = currentItem.container;
        document.getElementById('editPreco').value = currentItem.preco || '';
        document.getElementById('editObservacoes').value = currentItem.observacoes || '';
      } else {
        document.getElementById('editTitle').textContent = 'Novo Pneu';
        document.getElementById('editMedida').value = '';
        document.getElementById('editMarca').value = '';
        document.getElementById('editModelo').value = '';
        document.getElementById('editDataEntrada').value = dataAtual;
        document.getElementById('editStatus').value = 'Novo';
        document.getElementById('editQty').value = '';
        document.getElementById('editContainer').value = currentContainer;
        document.getElementById('editPreco').value = '';
        document.getElementById('editObservacoes').value = '';
      }

      document.getElementById('editModal').style.display = 'flex';
    }

    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
      currentItem = null;
    }

    function openTransferModal(itemId) {
      currentTransferItem = items.find(item => item.id === itemId);
      
      if (!currentTransferItem) {
        showNotification('Pneu n√£o encontrado!', 'error');
        return;
      }

      const dataAtual = new Date().toISOString().split('T')[0];
      
      document.getElementById('transferMedida').value = currentTransferItem.medida;
      document.getElementById('transferMarca').value = currentTransferItem.marca;
      document.getElementById('transferModelo').value = currentTransferItem.modelo;
      document.getElementById('transferData').value = dataAtual;
      document.getElementById('transferQty').value = 1;
      document.getElementById('transferQty').max = currentTransferItem.qty;
      
      const ultimoFogo = fogos.reduce((max, fogo) => {
        const num = parseInt(fogo.fogo);
        return num > max ? num : max;
      }, 23449);
      
      document.getElementById('startFogo').value = ultimoFogo + 1;
      
      updateTransferList();
      document.getElementById('transferModal').style.display = 'flex';
    }

    function closeTransferModal() {
      document.getElementById('transferModal').style.display = 'none';
      currentTransferItem = null;
    }

    function updateTransferList() {
      const qty = parseInt(document.getElementById('transferQty').value) || 0;
      const startFogo = parseInt(document.getElementById('startFogo').value) || 23450;
      const listBody = document.getElementById('transferListBody');
      
      let html = '';
      for (let i = 0; i < qty; i++) {
        const fogoNum = startFogo + i;
        html += `
          <div class="item-row">
            <div class="item-details">
              <div class="item-title">Fogo ${fogoNum}</div>
              <div class="item-subtitle">${currentTransferItem.medida} ‚Ä¢ ${currentTransferItem.marca}</div>
            </div>
          </div>
        `;
      }
      
      listBody.innerHTML = html;
    }

    async function confirmTransfer() {
      const qty = parseInt(document.getElementById('transferQty').value) || 0;
      const startFogo = parseInt(document.getElementById('startFogo').value) || 23450;
      const dataTransferencia = document.getElementById('transferData').value;
      
      if (!dataTransferencia) {
        showNotification('Informe a data de transfer√™ncia!', 'error');
        return;
      }
      
      if (qty > currentTransferItem.qty) {
        showNotification('Quantidade solicitada maior que o estoque dispon√≠vel!', 'error');
        return;
      }
      
      for (let i = 0; i < qty; i++) {
        const fogoNum = startFogo + i;
        const fogoId = `FOGO-${fogoNum}`;
        
        fogos.push({
          id: fogoId,
          fogo: fogoNum.toString(),
          medida: currentTransferItem.medida,
          marca: currentTransferItem.marca,
          modelo: currentTransferItem.modelo,
          dataEntrada: dataTransferencia,
          status: currentTransferItem.status,
          containerOrigem: currentTransferItem.container,
          pneuId: currentTransferItem.id
        });
      }
      
      currentTransferItem.qty -= qty;
      
      if (currentTransferItem.qty <= 0) {
        items = items.filter(item => item.id !== currentTransferItem.id);
      }
      
      await saveData();
      renderTable();
      renderStats();
      renderFogoTable();
      closeTransferModal();
      
      showNotification(`${qty} pneu(s) transferido(s) para controle por fogo com sucesso!`);
    }

    function openSaidaModal() {
      if (selectedFogos.size === 0) {
        showNotification('Selecione pelo menos um fogo!', 'warning');
        return;
      }

      const dataAtual = new Date().toISOString().split('T')[0];
      document.getElementById('saidaData').value = dataAtual;
      
      // Preencher lista com fogos selecionados
      const listBody = document.getElementById('saidaListBody');
      const selectedFogosList = Array.from(selectedFogos).map(id => fogos.find(f => f.id === id)).filter(f => f);
      
      listBody.innerHTML = selectedFogosList.map(fogo => `
        <div class="item-row">
          <div class="item-details">
            <div class="item-title">Fogo ${fogo.fogo}</div>
            <div class="item-subtitle">${fogo.medida} ‚Ä¢ ${fogo.marca}</div>
          </div>
        </div>
      `).join('');
      
      document.getElementById('saidaModal').style.display = 'flex';
    }

    function closeSaidaModal() {
      document.getElementById('saidaModal').style.display = 'none';
    }

    async function confirmSaida() {
      const dataSaida = document.getElementById('saidaData').value;
      const motivo = document.getElementById('saidaMotivo').value;
      const observacoes = document.getElementById('saidaObservacoes').value.trim();

      if (!dataSaida) {
        showNotification('Informe a data de sa√≠da!', 'error');
        return;
      }

      const selectedFogosList = Array.from(selectedFogos);
      
      // Registrar sa√≠da (aqui voc√™ pode adaptar para salvar em um hist√≥rico)
      const saidas = selectedFogosList.map(fogoId => {
        const fogo = fogos.find(f => f.id === fogoId);
        return {
          fogoId: fogoId,
          fogo: fogo.fogo,
          medida: fogo.medida,
          marca: fogo.marca,
          modelo: fogo.modelo,
          dataSaida: dataSaida,
          motivo: motivo,
          observacoes: observacoes
        };
      });

      // Remover fogos do estoque
      fogos = fogos.filter(fogo => !selectedFogos.has(fogo.id));
      
      await saveData();
      renderFogoTable();
      renderStats();
      closeSaidaModal();
      selectedFogos.clear();
      updateSelectedCount();
      
      showNotification(`${saidas.length} fogo(s) removido(s) do estoque com sucesso!`);
    }

    async function saveItem() {
      const medida = document.getElementById('editMedida').value.trim();
      const marca = document.getElementById('editMarca').value.trim();
      const modelo = document.getElementById('editModelo').value.trim();
      const dataEntrada = document.getElementById('editDataEntrada').value;
      const qty = parseInt(document.getElementById('editQty').value) || 0;
      const container = document.getElementById('editContainer').value;

      if (!medida || !marca || !modelo || !dataEntrada) {
        showNotification('Medida, Marca, Modelo e Data de Entrada s√£o obrigat√≥rios!', 'error');
        return;
      }

      const id = currentItem ? currentItem.id : generateUniqueId(medida, marca, modelo);

      const itemData = {
        id: id,
        medida: medida,
        marca: marca,
        modelo: modelo,
        dataEntrada: dataEntrada,
        status: document.getElementById('editStatus').value,
        qty: qty,
        container: container,
        preco: parseFloat(document.getElementById('editPreco').value) || 0,
        observacoes: document.getElementById('editObservacoes').value.trim()
      };

      if (currentItem) {
        Object.assign(currentItem, itemData);
        showNotification('Pneu atualizado com sucesso!');
      } else {
        items.push(itemData);
        showNotification('Pneu cadastrado com sucesso!');
      }

      await saveData();
      renderTable();
      renderStats();
      closeEditModal();
    }

    async function deleteItem(itemId) {
      const item = items.find(item => item.id === itemId);
      if (!item) return;

      const confirmMessage = `Tem certeza que deseja excluir o pneu?\n\n` +
                            `Medida: ${item.medida}\n` +
                            `Marca/Modelo: ${item.marca} ${item.modelo}\n` +
                            `Quantidade: ${item.qty} unidades`;
      
      if (!confirm(confirmMessage)) return;
      
      items = items.filter(item => item.id !== itemId);
      await saveData();
      renderTable();
      renderStats();
      showNotification('Pneu exclu√≠do com sucesso!', 'warning');
    }

    async function deleteFogo(fogoId) {
      const fogo = fogos.find(f => f.id === fogoId);
      if (!fogo) return;

      if (!confirm(`Tem certeza que deseja excluir o fogo ${fogo.fogo}?`)) return;
      
      fogos = fogos.filter(f => f.id !== fogoId);
      await saveData();
      renderFogoTable();
      showNotification('Fogo exclu√≠do com sucesso!', 'warning');
    }

    function generateUniqueId(medida, marca, modelo) {
      const baseId = `${medida.replace(/\s+/g, '-')}-${marca}-${modelo}`.toUpperCase();
      const existingIds = items.filter(item => item.id.startsWith(baseId)).map(item => item.id);
      
      if (existingIds.length === 0) return baseId;
      
      let counter = 1;
      let newId = `${baseId}-${counter}`;
      
      while (existingIds.includes(newId)) {
        counter++;
        newId = `${baseId}-${counter}`;
      }
      
      return newId;
    }

    function showNotification(message, type = 'success') {
      const existingNotifications = document.querySelectorAll('.notification');
      existingNotifications.forEach(notif => notif.remove());
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, 3000);
    }

    function exportData() {
      const data = {
        items: items,
        fogos: fogos,
        exportDate: new Date().toISOString(),
        version: '1.0'
      };
      
      const dataStr = JSON.stringify(data, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `backup-pneus-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      showNotification('Backup exportado com sucesso!');
    }

    function exportToExcel() {
      // Criar dados formatados para Excel
      const excelData = [];
      
      // Cabe√ßalho do relat√≥rio
      excelData.push(['RELAT√ìRIO DE PNEUS - TRANSPORTES CANARINHO']);
      excelData.push(['Exportado em:', new Date().toLocaleDateString('pt-BR')]);
      excelData.push([]);
      
      // CONTAINER 1
      excelData.push(['CONTAINER 1']);
      excelData.push(['ID', 'Medida', 'Marca', 'Modelo', 'Status', 'Quantidade', 'Data Entrada', 'Pre√ßo (R$)', 'Observa√ß√µes']);
      
      const container1Items = items.filter(item => item.container === 'container1');
      container1Items.forEach(item => {
          excelData.push([
              item.id,
              item.medida,
              item.marca,
              item.modelo,
              item.status,
              item.qty,
              new Date(item.dataEntrada).toLocaleDateString('pt-BR'),
              item.preco ? `R$ ${item.preco.toFixed(2)}` : 'R$ 0.00',
              item.observacoes || ''
          ]);
      });
      
      // Total Container 1
      const totalContainer1 = container1Items.reduce((sum, item) => sum + item.qty, 0);
      excelData.push([]);
      excelData.push(['TOTAL CONTAINER 1:', totalContainer1, '', '', '', '', '', '', '']);
      
      // Espa√ßamento
      excelData.push([]);
      excelData.push([]);
      
      // CONTAINER 2
      excelData.push(['CONTAINER 2']);
      excelData.push(['ID', 'Medida', 'Marca', 'Modelo', 'Status', 'Quantidade', 'Data Entrada', 'Pre√ßo (R$)', 'Observa√ß√µes']);
      
      const container2Items = items.filter(item => item.container === 'container2');
      container2Items.forEach(item => {
          excelData.push([
              item.id,
              item.medida,
              item.marca,
              item.modelo,
              item.status,
              item.qty,
              new Date(item.dataEntrada).toLocaleDateString('pt-BR'),
              item.preco ? `R$ ${item.preco.toFixed(2)}` : 'R$ 0.00',
              item.observacoes || ''
          ]);
      });
      
      // Total Container 2
      const totalContainer2 = container2Items.reduce((sum, item) => sum + item.qty, 0);
      excelData.push([]);
      excelData.push(['TOTAL CONTAINER 2:', totalContainer2, '', '', '', '', '', '', '']);
      
      // Espa√ßamento
      excelData.push([]);
      excelData.push([]);
      
      // CONTAINER 3
      excelData.push(['CONTAINER 3']);
      excelData.push(['ID', 'Medida', 'Marca', 'Modelo', 'Status', 'Quantidade', 'Data Entrada', 'Pre√ßo (R$)', 'Observa√ß√µes']);
      
      const container3Items = items.filter(item => item.container === 'container3');
      container3Items.forEach(item => {
          excelData.push([
              item.id,
              item.medida,
              item.marca,
              item.modelo,
              item.status,
              item.qty,
              new Date(item.dataEntrada).toLocaleDateString('pt-BR'),
              item.preco ? `R$ ${item.preco.toFixed(2)}` : 'R$ 0.00',
              item.observacoes || ''
          ]);
      });
      
      // Total Container 3
      const totalContainer3 = container3Items.reduce((sum, item) => sum + item.qty, 0);
      excelData.push([]);
      excelData.push(['TOTAL CONTAINER 3:', totalContainer3, '', '', '', '', '', '', '']);
      
      // Total Geral
      const totalGeral = totalContainer1 + totalContainer2 + totalContainer3;
      excelData.push([]);
      excelData.push(['TOTAL GERAL CONTAINERS:', totalGeral, '', '', '', '', '', '', '']);
      
      // Espa√ßamento
      excelData.push([]);
      excelData.push([]);
      
      // CONTROLE POR FOGO
      excelData.push(['CONTROLE POR FOGO']);
      excelData.push(['N√∫mero Fogo', 'Medida', 'Marca', 'Modelo', 'Status', 'Data Entrada', 'Container Origem', 'ID Pneu Origem']);
      
      fogos.forEach(fogo => {
          excelData.push([
              fogo.fogo,
              fogo.medida,
              fogo.marca,
              fogo.modelo,
              fogo.status,
              new Date(fogo.dataEntrada).toLocaleDateString('pt-BR'),
              fogo.containerOrigem,
              fogo.pneuId
          ]);
      });
      
      // Total Fogos
      excelData.push([]);
      excelData.push(['TOTAL PNEUS COM FOGO:', fogos.length, '', '', '', '', '', '']);
      
      // Criar CSV formatado corretamente para Excel
      const csvContent = excelData.map(row => 
          row.map(cell => {
              // Se o cell for n√∫mero ou data, n√£o coloca aspas
              if (cell === null || cell === undefined) return '';
              if (typeof cell === 'number') return cell.toString();
              if (!isNaN(cell) && cell.trim() !== '') return cell;
              // Para textos, coloca entre aspas e escapa aspas internas
              return `"${cell.toString().replace(/"/g, '""')}"`;
          }).join(',')
      ).join('\n');
      
      const blob = new Blob(['\uFEFF' + csvContent], { 
          type: 'text/csv;charset=utf-8;' 
      });
      
      const url = URL.createObjectURL(blob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = `relatorio-pneus-${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
      
      URL.revokeObjectURL(url);
      showNotification('Planilha Excel exportada com sucesso!');
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = async function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          if (confirm(`Importar ${data.items?.length || 0} pneus e ${data.fogos?.length || 0} fogos? Isso substituir√° os dados atuais.`)) {
            items = data.items || [];
            fogos = data.fogos || [];
            await saveData();
            renderTable();
            renderStats();
            renderFogoTable();
            showNotification('Dados importados com sucesso!');
          }
        } catch (error) {
          showNotification('Erro ao importar arquivo!', 'error');
          console.error('Erro na importa√ß√£o:', error);
        }
      };
      reader.readAsText(file);
      event.target.value = '';
    }

    // Fun√ß√µes globais
    window.openEditModal = openEditModal;
    window.closeEditModal = closeEditModal;
    window.saveItem = saveItem;
    window.deleteItem = deleteItem;
    window.openTransferModal = openTransferModal;
    window.closeTransferModal = closeTransferModal;
    window.updateTransferList = updateTransferList;
    window.confirmTransfer = confirmTransfer;
    window.deleteFogo = deleteFogo;
    window.exportData = exportData;
    window.exportToExcel = exportToExcel;
    window.importData = importData;
    window.toggleFogoSelection = toggleFogoSelection;
    window.openSaidaModal = openSaidaModal;
    window.closeSaidaModal = closeSaidaModal;
    window.confirmSaida = confirmSaida;
    window.openItemOptions = openItemOptions;
    window.closeItemOptions = closeItemOptions;
  </script>
</body>
</html>
